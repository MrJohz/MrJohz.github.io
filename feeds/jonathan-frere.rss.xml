<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Johz</title><link>http://www.johz.me/</link><description></description><atom:link href="http://www.johz.me/feeds/jonathan-frere.rss.xml" rel="self"></atom:link><lastBuildDate>Sat, 19 Sep 2015 12:26:20 +0100</lastBuildDate><item><title>Meet Figtree</title><link>http://www.johz.me/posts/2015/Sep/19/meet-figtree/</link><description>&lt;p&gt;You know sometimes you do a stupid thing and it turns out to be so much more fun than doing the sensible thing that you really can't seem to shake it?&lt;/p&gt;
&lt;p&gt;Meet &lt;a href="https://github.com/MrJohz/figtree"&gt;Figtree&lt;/a&gt;, my latest stupid thing.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;figtree_is {&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;noded&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;configuration&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;it looks&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;a bit like JSON&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

    &lt;span class="n"&gt;except {&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;for&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;these random blocks everywhere&amp;quot;&lt;/span&gt;

        &lt;span class="c1"&gt;// plus a few other details, not least the fact that, what with comments and&lt;/span&gt;
        &lt;span class="c1"&gt;// everything, it&amp;#39;s actually somewhat readable without too much effort.&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;What is Figtree&lt;/h2&gt;
&lt;p&gt;Figtree, as the example says, is a noded configuration file format.  By "noded", I mean that it allows configuration values to sorted into sections ("nodes"), and ensures that those nodes are syntactically distinct from simple nested data.  As a configuration file format, as opposed to a general data format, I tried to make it expressive and easy-to-read, on the basis that the people who might actually need to read and write Figtree files should be able to pick it up and use it easily.&lt;/p&gt;
&lt;p&gt;Nodes are made up from an identifier and a brace block, so they look a lot like function definitions or block structures in most C-like languages.  Identifiers use the same rules as Swift, because I liked the idea of emoji winding everyone up all the time, but mainly because those rules seemed fairly sane.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Rules of Swift&lt;/strong&gt;:
Identifiers begin with an uppercase or lowercase letter A through Z, an underscore (_), a noncombining alphanumeric Unicode character in the Basic Multilingual Plane, or a character outside the Basic Multilingual Plane that isnâ€™t in a Private Use Area. After the first character, digits and combining Unicode characters are also allowed.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;On the basis that there may be some circumstances where that wasn't enough, it's also possible to use arbitrary strings as identifiers, by enclosing them with &lt;code&gt;`backticks`&lt;/code&gt;.  These "quoted idents" can't contain raw newlines (although you can include newlines using &lt;code&gt;\n&lt;/code&gt; if you need), but otherwise follow the same rules for strings.&lt;/p&gt;
&lt;p&gt;Nodes can contain subnodes, but they can also contain key-value pairs known as "attributes".  In Figtree, keys are &lt;em&gt;always&lt;/em&gt; strings.  This is a limitation, but I suspect there aren't many circumstances where non-key strings are needed.  Using only strings makes the resultant structure much easier to use in statically-typed languages, and also significantly simpler to parse.&lt;/p&gt;
&lt;p&gt;Attribute pairs must be separated by commas, and may optionally (i.e. almost always should) have a trailing comma at the end.  You don't need a comma between an attribute and a node, and you can't have a comma after a node (much like how you don't have semicolons after brace-blocks in most braced languages).&lt;/p&gt;
&lt;p&gt;Values are either simple, or complex.  Simple values are strings, integers, floats, booleans, the null value, and identifiers, while complex values are lists and dicts, that contain sub-values inside them.&lt;/p&gt;
&lt;p&gt;Strings are roughly like JSON strings, except for a few of features.  Firstly, they are multiline by default, as opposed to JSON strings which can only include newlines using the escape sequence &lt;code&gt;\n&lt;/code&gt;.  Secondly, they can use either single (&lt;code&gt;'&lt;/code&gt;) or double (&lt;code&gt;"&lt;/code&gt;) quotes.  Thirdly, all the rules for JSON strings can be liberally ignored using raw strings, which are strings that are preceded by the letter &lt;code&gt;r&lt;/code&gt;, as in &lt;code&gt;r"this is a raw string"&lt;/code&gt;.  Raw strings use both the standard quote characters, but can also use &lt;code&gt;/slashes/&lt;/code&gt;, &lt;code&gt;$dollar signs$&lt;/code&gt;, &lt;code&gt;%percent signs%&lt;/code&gt;, &lt;code&gt;|pipe signs|&lt;/code&gt;, or &lt;code&gt;#hashes#&lt;/code&gt;.  Inside raw strings, no backslash-escapes can be used.  To allow for the use of the quote character inside a raw string, it's possible to repeat the number of quote characters multiple times, and the string will only close when the same number of quote characters happens again in sequence.  For example, &lt;code&gt;r$$$this string can contain up to two $ signs ($$) because the outer quote uses three signs$$$&lt;/code&gt; will be parsed as one string.&lt;/p&gt;
&lt;p&gt;For string values (although not for keys) whenever multiple strings are found with no separator, they will be concatenated (as in Python).  This makes it possible to write relatively long prose without having to worry about excess whitespace.&lt;/p&gt;
&lt;p&gt;Integers are fairly simple, they can either be the standard decimal, optionally preceded by a positive or negative sign, or a hexadecimal, octal, decimal, or binary number, preceded by a &lt;code&gt;0x&lt;/code&gt;, &lt;code&gt;0o&lt;/code&gt;, &lt;code&gt;0d&lt;/code&gt;, or &lt;code&gt;0b&lt;/code&gt; respectively.  0[xdob] numbers can't be signed - this may change in future, but I can't really think of a good reason for them to be signed.&lt;/p&gt;
&lt;p&gt;Floats, likewise, follow fairly standard rules.  There must be at least one decimal point and at least one integer on one side or the other of that point.  There can be a sign at the start, and an exponent at the end.&lt;/p&gt;
&lt;p&gt;Booleans can be either &lt;code&gt;true&lt;/code&gt; or &lt;code&gt;false&lt;/code&gt;.  They must be entirely lowercase.  I'm potentially considering expanding this to include &lt;code&gt;on&lt;/code&gt;/&lt;code&gt;off&lt;/code&gt;, &lt;code&gt;yes&lt;/code&gt;/&lt;code&gt;no&lt;/code&gt;, and perhaps even &lt;code&gt;enabled&lt;/code&gt;/&lt;code&gt;disabled&lt;/code&gt;, for much the same reasons that YAML interprets all of these values as boolean.  Unlike YAML, these tokens can't be parsed as implicit strings - currently, their use is a syntax error - so this is a relatively painless addition to the parser.&lt;/p&gt;
&lt;p&gt;The null value is simply the literal value &lt;code&gt;null&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The sixth basic datatype is, I suspect, more unique: the identifier type.  This is a bang (exclamation point, &lt;code&gt;!&lt;/code&gt;), followed by an identifier, using the same rules for identifiers here as when they're part of the node name.&lt;/p&gt;
&lt;p&gt;Identifiers are essentially another kind of string, but they're specifically designed to represent identifiers and values in code.  For example, the configuration for the CherryPy framework requires the user to specify the class to use for routing as a raw module path to that class.  In Figtree, that might be represented with the value &lt;code&gt;!`cherrypy.routing.SpecificRouter()`&lt;/code&gt;.  The code that loads this configuration would then have the duty of loading the correct value from the identifier path.&lt;/p&gt;
&lt;p&gt;This is a compromise regarding YAML's ability to arbitrarily load any function or class available.  While that is a useful and powerful tool, having it be on-by-default when loading YAML files can cause security issues - indeed it has done, multiple times.  Figtree identifiers are designed to be able to do useful things like this, but only when specifically asked to by the developer using a Figtree library.  This seems like a fair compromise to me.&lt;/p&gt;
&lt;p&gt;Here's a full example of as much syntax as I could cram into one document.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;root_node {&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;keys&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;must always be strings&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;values&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;can be a lot of things&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

    &lt;span class="n"&gt;value_types {&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;list&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;contains&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;individual&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;values&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;dict&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;basic&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;mapping&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;  &lt;span class="c1"&gt;// both container types can be nested&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;string&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
            &lt;span class="s"&gt;&amp;quot;double quotes&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="s"&gt;&amp;#39;single quotes&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="s"&gt;&amp;quot;quotes&amp;quot;&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;together&amp;quot;&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;are&amp;quot;&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;concatenated&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="s"&gt;&amp;quot;quotes&lt;/span&gt;
&lt;span class="s"&gt;            can contain newlines&amp;quot;&lt;/span&gt;
            &lt;span class="s"&gt;r/raw string/&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="cm"&gt;/* can also use &amp;#39;&amp;quot;|$%# */&lt;/span&gt;
            &lt;span class="s"&gt;r$$use multiple quote characters to contain $ quotes$$&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;],&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;integer&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
            &lt;span class="mi"&gt;+394&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;-343&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="cm"&gt;/* standard decimal */&lt;/span&gt;
            &lt;span class="mh"&gt;0xDEADBEEF&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="cm"&gt;/* hexadecimal*/&lt;/span&gt;
            &lt;span class="mi"&gt;0d444&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="cm"&gt;/* nonstandard decimal */&lt;/span&gt;
            &lt;span class="mb"&gt;0b0100_0110&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="cm"&gt;/* binary, note all integers can contain underscores */&lt;/span&gt;
            &lt;span class="mo"&gt;0o34&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="cm"&gt;/* octal */&lt;/span&gt;
        &lt;span class="p"&gt;],&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;float&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
            &lt;span class="mf"&gt;34.53&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;+34.53&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;-34.53&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="cm"&gt;/* bog standard */&lt;/span&gt;
            &lt;span class="mf"&gt;34.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;.53&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="cm"&gt;/* leave bits off */&lt;/span&gt;
            &lt;span class="mf"&gt;34.e-34&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="cm"&gt;/* and e-notation */&lt;/span&gt;
        &lt;span class="p"&gt;],&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;boolean&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
            &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="cm"&gt;/* only lowercase, only these two literals allowed */&lt;/span&gt;
        &lt;span class="p"&gt;],&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;null value&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;identifiers&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
            &lt;span class="nv"&gt;!hjef&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="cm"&gt;/* follow the same rules as identifiers for nodes */&lt;/span&gt;
            &lt;span class="nv"&gt;!includes_underscores&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="cm"&gt;/* but always preceded by a &amp;#39;!&amp;#39; token */&lt;/span&gt;
            &lt;span class="nv"&gt;!`can have quoted idents`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="cm"&gt;/* uses same escaping as strings, but can&amp;#39;t contain newlines */&lt;/span&gt;
        &lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="n"&gt;multiple_roots_allowed_in_one_document {&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;key&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;  &lt;span class="c1"&gt;// note trailing comma here&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Some quick comparisons&lt;/h2&gt;
&lt;p&gt;I've enjoyed writing Figtree largely as a hobby project, but at this point I'm convinced it actually offers some benefits over a few existing configuration formats.  This may be the late-night madness kicking in, but I'll explain my comparisons here for you to judge.&lt;/p&gt;
&lt;h3&gt;INI&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;INI &lt;code&gt;[sections]&lt;/code&gt; are very similar to Figtree nodes, although, depending on the parser, it isn't always possible to nest sections, or escape characters in the section name.&lt;/li&gt;
&lt;li&gt;INI values tend to just be strings, while Figtree has a full range of datatypes, included collections.&lt;/li&gt;
&lt;li&gt;Figtree has a concrete, absolute syntax that has been standardised.  There isn't even a standardised file extension for INI files, let alone a standard syntax for values.  This isn't necessarily a bad thing, but it does mean that people can be absolutely clear how to write a Figtree file and can expect it to work pretty much anywhere where there's a parser.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;JSON&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;JSON doesn't have sections.  This means that &lt;code&gt;{"a": {"b": true}}&lt;/code&gt; could be setting the value of setting &lt;code&gt;a.b&lt;/code&gt; to &lt;code&gt;true&lt;/code&gt;, or it could be setting the value of &lt;code&gt;a&lt;/code&gt; to &lt;code&gt;{"b": true}&lt;/code&gt;.  Figtree makes a distinction between these two cases.&lt;/li&gt;
&lt;li&gt;JSON and Figtree share a lot of value types, although Figtree usually has more ways to express any particular value, depending on the user's need.  The one big new addition is Figtree's identifier type, which has no equivalent in JSON.&lt;/li&gt;
&lt;li&gt;JSON is fairly limiting as a configuration language - the specification is strict, and disallows comments and trailing commas, only allows double-quoted strings, and doesn't allow for non-decimal integers.  Figtree allows all of those things to ensure the user can write out a configuration that they can hopefully understand in six months' time.&lt;/li&gt;
&lt;li&gt;JSON is ubiquitous, and can even be evaluated as Javascript.  Figtree has one library in Rust.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;YAML&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;YAML is designed to be used by humans, as has Figtree.  They've both take very different paths to get there, but they share the same goal.&lt;/li&gt;
&lt;li&gt;YAML uses whitespace, Figtree uses braces, and this probably shouldn't matter to anyone.&lt;/li&gt;
&lt;li&gt;Like JSON, YAML does not differentiate between sections and mappings.  A YAML user could write sections using one syntax and maps using another, but the parser will treat them both the same.&lt;/li&gt;
&lt;li&gt;The YAML parser does a few things implicitly.  One of these is implicit strings, where if an unquoted value can't be parsed as another type, and it doesn't contain any special characters, the parser will assume it to be a string.  This can cause subtle bugs.  Figtree distinguishes each value type and unambiguously parses each one separately.&lt;/li&gt;
&lt;li&gt;The YAML parser also automatically loads classes, modules, and functions when asked to by the file.  This is safe in most circumstances if you use YAML only for private configuration, but it has caused security risks and breaches in the past.  Figtree replaces this autoload functionality with identifiers, which must be loaded manually be the developer if they so wish.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;TOML&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;TOML looks like it has sections like INI files, but in reality has key-value maps like JSON and YAML.  Worse, these sections don't visibly nest, and the structure of the parsed data can vary depending on the order of the sections.  Figtree attempts to keep things as simple as possible.&lt;/li&gt;
&lt;li&gt;TOML arrays cannot contain mixed types.  Figtree arrays probably &lt;em&gt;shouldn't&lt;/em&gt; contain mixed types, but assume that if the user wants to do that then they probably know bet.&lt;/li&gt;
&lt;li&gt;TOML uses semi-syntactically significant whitespace, and can just about be parsed by a fairly simple line-based parser.  Figtree has a much more complex syntax, which means it can't be parsed as easily, but can be formatted in any way the user wants.  This may or may not be a positive for Figtree...&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Why shouldn't you use Figtree?&lt;/h2&gt;
&lt;p&gt;I always think the best way to show you understand a tool is to be able to come up with good reasons not to use it.  Figtree is great, but it isn't perfect by any means.  For a start, there's one library that can parse Figtree files, in Rust, and I am currently the sole contributor.  The wider Figtree specification - aside from not having been written down formally yet - may well change at will.  As I said earlier, I'm currently considering adding new boolean literals.  I'm also vaguely working on an idea to add the ability to reference the values of other nodes/attributes.  Neither of those changes will break old Figtree files, but they will make new files unparseable in old parsers.&lt;/p&gt;
&lt;p&gt;Aside from the "it just isn't ready" argument, Figtree is specifically designed for nested-section configuration.  It's pretty inefficient for message passing, data representation, and other needs that you might use JSON or XML for.  It's also more complex than other languages commonly used for config files - not all configuration needs a distinction between mappings and sections.  It is probably worth sticking with a fairly simple, widely-used format if you know you don't need all that Figtree offers.&lt;/p&gt;
&lt;p&gt;Figtree is also specifically about configuration, and I've no plans to evolve it into a full scripting language like Lua.  If all you need is configuration, then Figtree will be fine, but in some circumstances you need a format that can describe more than just predefined behaviours.  A this point scripting may be a more viable option - code can often be better than overly complex configuration.&lt;/p&gt;
&lt;h2&gt;Using Figtree&lt;/h2&gt;
&lt;p&gt;Currently, Figtree can be used via Rust using the &lt;a href="https://github.com/MrJohz/figtree"&gt;figtree&lt;/a&gt; library that currently doesn't even have a crates page.  There is library documentation available &lt;a href="http://www.johz.me/figtree"&gt;here&lt;/a&gt;.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jonathan Frere</dc:creator><pubDate>Sat, 19 Sep 2015 12:26:20 +0100</pubDate><guid>tag:www.johz.me,2015-09-19:posts/2015/Sep/19/meet-figtree/</guid><category>rust</category><category>coding</category><category>configuration</category></item><item><title>Shell Completion in Fish</title><link>http://www.johz.me/posts/2015/Aug/14/completion-in-fish/</link><description>&lt;p&gt;I use the &lt;a href="http://fishshell.com/"&gt;fish shell&lt;/a&gt; as my go-to shell.  It's fun, it's colourful, it's full of features, and I'd highly recommend it.  One of those features is a shell-completion mechanism in the form of the &lt;code&gt;complete&lt;/code&gt; command.  Now many other shells have completion, but for now I'm just going to play with the fish version, and then see if I can apply it to other shells later on, perhaps in a future post.&lt;/p&gt;
&lt;p&gt;I'm interested in shell completions because I got bored the other day and started learning &lt;a href="http://rust-lang.org/"&gt;Rust&lt;/a&gt;, and now I'm trying to build a program that, given an input definition, will output a shell script to define the shell completions for that input.  Yesterday I got to the point that I could just about comprehend the Rust part (if in doubt, stick another "&lt;code&gt;&amp;amp;&lt;/code&gt;" in front of it&lt;sup id="fnref:rust-advice"&gt;&lt;a class="footnote-ref" href="#fn:rust-advice" rel="footnote"&gt;1&lt;/a&gt;&lt;/sup&gt;), and realised that actually the new difficulty was that I didn't really know how to do shell completion.&lt;/p&gt;
&lt;h2&gt;First steps - just options&lt;/h2&gt;
&lt;p&gt;The best place to start is with a program to define the completions for.  Starting as simple as possible, here's one defined in a sort-of-docopt-y form.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;USAGE:
    my-favourite-program [OPTIONS]

OPTIONS:
    -a, --all               Do all the favourite things
    -u                      Only use unsigned integers
    -w, -weird              Weird &amp;quot;old-style&amp;quot; option
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Only options, but three different kinds.  There's short options (&lt;code&gt;-x&lt;/code&gt;), long options (&lt;code&gt;--long-opt&lt;/code&gt;) and also weird single-dashed long options that fish calls "old-style".  The example given in the fish shell docs is &lt;code&gt;-Wall&lt;/code&gt;, but then I've always understood that to be "-W, with the argument 'all'".  Regardless, how do you complete this different options?&lt;/p&gt;
&lt;p&gt;The full signature of a program can't be given in one single definition, instead each option is given separately.  The &lt;code&gt;complete&lt;/code&gt; command starts by defining what command the completion applies to using the &lt;code&gt;--command&lt;/code&gt; option.  This is followed by all of the alternatives for each option, using the &lt;code&gt;--short-option&lt;/code&gt; flag for short options, the &lt;code&gt;--long-option&lt;/code&gt; flag for long options, and the &lt;code&gt;--old-option&lt;/code&gt; flag for old options.  Finally, an optional description can be attached using the &lt;code&gt;--description&lt;/code&gt; flag.&lt;/p&gt;
&lt;p&gt;The order of the flags passed to &lt;code&gt;complete&lt;/code&gt; don't actually matter as far as I can tell, but doing it in the same order each time makes it much easier to read the command, so I'll do it that way.  All in all, that means the completion file might look something like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;complete&lt;/span&gt; --command &lt;span class="s1"&gt;&amp;#39;my-favourite-program&amp;#39;&lt;/span&gt; --short-option &lt;span class="s1"&gt;&amp;#39;a&amp;#39;&lt;/span&gt; --long-option &lt;span class="s1"&gt;&amp;#39;all&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --description &lt;span class="s1"&gt;&amp;#39;Do all the favourite things&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;complete&lt;/span&gt; --command &lt;span class="s1"&gt;&amp;#39;my-favourite-program&amp;#39;&lt;/span&gt; --short-option &lt;span class="s1"&gt;&amp;#39;u&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --description &lt;span class="s1"&gt;&amp;#39;Only use unsigned integers&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;complete&lt;/span&gt; --command &lt;span class="s1"&gt;&amp;#39;my-favourite-program&amp;#39;&lt;/span&gt; --short-option &lt;span class="s1"&gt;&amp;#39;w&amp;#39;&lt;/span&gt; --old-option &lt;span class="s1"&gt;&amp;#39;weird&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --description &lt;span class="s1"&gt;&amp;#39;Weird &amp;quot;old-style&amp;quot; option&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To test that this works, run those commands in a fish shell, then type &lt;code&gt;my-favourite-program -&amp;lt;tab&amp;gt;&lt;/code&gt;.  You should get something that looks a bit like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;$&lt;/span&gt; my-favourite-program -&amp;lt;tab&amp;gt;
&lt;span class="go"&gt;--all  (Do all the favourite things)  -u  (Only use unsigned integers)  -weird  (Weird &amp;quot;old-style&amp;quot; option)&lt;/span&gt;
&lt;span class="go"&gt;-a     (Do all the favourite things)  -w    (Weird &amp;quot;old-style&amp;quot; option)&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; my-favourite-program -weird
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Getting more complex - adding arguments&lt;/h2&gt;
&lt;p&gt;This is all okay, but it's a bit boring.  Many options require an argument of some kind.  How does that work?&lt;/p&gt;
&lt;p&gt;Fish has a couple of different switches here.  Firstly, option arguments can be specified using the &lt;code&gt;--arguments&lt;/code&gt; option.  &lt;code&gt;--arguments&lt;/code&gt; takes a single parameter that takes "a space-separated list of possible option-arguments, which may contain subshells".&lt;/p&gt;
&lt;p&gt;There's also some extra switches that specify particulars about how the argument should be treated.  For example, the &lt;code&gt;--require-parameter&lt;/code&gt; switch tells fish that a particular argument must have an argument.  This means, among other things, that it can't be used in the middle of a set of short options.  For example, given a command with options &lt;code&gt;-a -b -c&lt;/code&gt; where &lt;code&gt;-b&lt;/code&gt; has a required parameter, fish shell knows that &lt;code&gt;-ac&lt;/code&gt; can still be followed by another option, but that &lt;code&gt;-ab&lt;/code&gt; cannot be followed by the &lt;code&gt;-c&lt;/code&gt; option, it will be followed by an argument.&lt;/p&gt;
&lt;p&gt;Additionally, by default fish will assume that the files in the current directory can always be passed as arguments to the current option.  To prevent this, the &lt;code&gt;--no-files&lt;/code&gt; switch can be passed.  &lt;code&gt;--no-files&lt;/code&gt; can be combined with &lt;code&gt;--require-parameter&lt;/code&gt; using the &lt;code&gt;--exclusive&lt;/code&gt; switch.&lt;/p&gt;
&lt;p&gt;Let's go back to the original program definition, change it so some of the commands take arguments, and try to fill those arguments in.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;USAGE:
    my-favourite-program [OPTIONS]

OPTIONS:
    -f, --file FILE         Include FILE in program
    -x, --extra on|off      Turns extra on or off
    -c, --command COMMAND   The cargo command to execute beforehand
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Okay, so this program is getting more and more contrived.  I've added a few different options to play with to try out different things.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;--file&lt;/code&gt; option is probably the easiest one to start with.  It takes any file - that's fish's default anyway.  It is also a required parameter, so the &lt;code&gt;--require-parameter&lt;/code&gt; option can be added in.  This is what it looks like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;complete&lt;/span&gt; --command &lt;span class="s1"&gt;&amp;#39;my-favourite-program&amp;#39;&lt;/span&gt; --short-option &lt;span class="s1"&gt;&amp;#39;f&amp;#39;&lt;/span&gt; --long-option &lt;span class="s1"&gt;&amp;#39;file&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --require-parameter &lt;span class="se"&gt;\&lt;/span&gt;
    --description &lt;span class="s1"&gt;&amp;#39;Include FILE in program&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The second option, &lt;code&gt;--extra&lt;/code&gt; is also fairly simple.  It takes either 'on' or 'off' and nothing else.  As there's a required option, and files aren't allowed, this deserves the &lt;code&gt;--exclusive&lt;/code&gt; switch, as well as the argument specification.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;complete&lt;/span&gt; --command &lt;span class="s1"&gt;&amp;#39;my-favourite-program&amp;#39;&lt;/span&gt; --short-option &lt;span class="s1"&gt;&amp;#39;x&amp;#39;&lt;/span&gt; --long-option &lt;span class="s1"&gt;&amp;#39;extra&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --exclusive --arguments &lt;span class="s1"&gt;&amp;#39;on off&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --description &lt;span class="s1"&gt;&amp;#39;Turns extra on or off&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;You can try both of those fairly easily, although the first one doesn't really do all that much.  The last option, &lt;code&gt;--command&lt;/code&gt;, is the most interesting.  It takes a cargo command.  This could be produced by manually typing out all the different cargo commands, but dammit this is the future, and if we aren't allowed hoverboards and ray-guns we might as well use what we have got.&lt;/p&gt;
&lt;p&gt;What we have is subshells.  Interestingly, in fish, subshells aren't expanded inside strings as one might expect, which means that the &lt;code&gt;complete&lt;/code&gt; command can use them to define short functions that list the available arguments dynamically.  This particular feature isn't necessarily all that useful for listing cargo commands, as those commands are unlikely to change very often, but it is pretty neat and comes in handy elsewhere.&lt;/p&gt;
&lt;p&gt;To get a list of cargo commands, I've used &lt;code&gt;cargo --list&lt;/code&gt;, removed all of the spaces, and cut off the first line.  It probably isn't the most efficient, but it works.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;complete&lt;/span&gt; --command &lt;span class="s1"&gt;&amp;#39;my-favourite-program&amp;#39;&lt;/span&gt; --short-option &lt;span class="s1"&gt;&amp;#39;c&amp;#39;&lt;/span&gt; --long-option &lt;span class="s1"&gt;&amp;#39;command&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --exclusive --arguments &lt;span class="s2"&gt;&amp;quot;(cargo --list | tr -d &amp;#39; &amp;#39; | sed &amp;#39;1d&amp;#39;)&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --description &lt;span class="s1"&gt;&amp;#39;The cargo command to execute beforehand&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Originally, I thought that the &lt;code&gt;--arguments&lt;/code&gt; option only applied to options.  It doesn't - this also works for general arguments.  Assuming &lt;code&gt;my-favourite-program&lt;/code&gt; now takes files as arguments, but only accepts files with no 's' in them in the local directory, you might get something like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;complete&lt;/span&gt; --command &lt;span class="s1"&gt;&amp;#39;my-favourite-program&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --exclusive --arguments &lt;span class="s2"&gt;&amp;quot;(ls -p | grep -v &amp;#39;/&amp;#39; | grep -v &amp;#39;s&amp;#39;)&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --description &lt;span class="s1"&gt;&amp;#39;Argument!&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;$&lt;/span&gt; ls
&lt;span class="go"&gt;cache/      develop_server.sh*  Makefile        pelicanconf.pyc  publishconf.py   requirements.txt  theme2/&lt;/span&gt;
&lt;span class="go"&gt;content/    fabfile.py          output/         pelican.pid      publishconf.pyc  srv.pid&lt;/span&gt;
&lt;span class="go"&gt;crowsfoot/  fabfile.pyc         pelicanconf.py  plugins/         __pycache__/     theme/&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; my-favourite-program &amp;lt;tab&amp;gt;
&lt;span class="go"&gt;fabfile.py   (Argument!)  Makefile     (Argument!)  pelicanconf.py   (Argument!)&lt;/span&gt;
&lt;span class="go"&gt;fabfile.pyc  (Argument!)  pelican.pid  (Argument!)  pelicanconf.pyc  (Argument!)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Screw it all - subcommands&lt;/h2&gt;
&lt;p&gt;So far, the quest for fish completion has been pretty simple.  Generally there's been an option to pass to the &lt;code&gt;complete&lt;/code&gt; command that has taken care of any trouble.  If something more complex has been required, it's generally been just a subshell away.&lt;/p&gt;
&lt;p&gt;Unfortunately, that all goes away when subcommands turn up.  Fish's autocomplete doesn't have any concept of subcommands, just different arguments, so there's no single switch that can declare the exact syntax of the command.  A naive attempt might be to use multiple &lt;code&gt;--command&lt;/code&gt; options, but that just applies the same completion to different top-level commands.  I also tried using a command with spaces in (e.g. &lt;code&gt;--command 'git status'&lt;/code&gt;) but that just set  up the completions for the command &lt;code&gt;git\ status&lt;/code&gt;.  Which is basically exactly what I expected, but it's nice to at least hope once to be able to use the easy option...&lt;/p&gt;
&lt;p&gt;What is there, then?  Well, one of the options for &lt;code&gt;complete&lt;/code&gt; is &lt;code&gt;--condition&lt;/code&gt;.  This option takes a string indicating a function to call.  Every time a particular command is tab-completed, fish will call the condition-function for each completion, and if that condition returns &lt;code&gt;0&lt;/code&gt; or true, it will display that completion.&lt;/p&gt;
&lt;p&gt;Additionally, fish also provides a function for retrieving the current "buffer" - the text written so far at the prompt.  In theory, it should be possible to work out which subcommand's completions are needed by working out what subcommands are currently in that buffer.&lt;/p&gt;
&lt;p&gt;As an example, and to show that this applies to literally any form of the completion that we've seen so far, let's consider a command that, if the string &lt;code&gt;'opt'&lt;/code&gt; is given on the commandline - anywhere at all - the option &lt;code&gt;--mytest&lt;/code&gt; can be completed.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;# first, we need to define this function
# also it turns out that pygments doesn&amp;#39;t support fish, and my computer doesn&amp;#39;t like
# pretending that this is any other shell language, so no highlighting, sorry.  :/

function __fish_complete_test
    set cmd (commandline -opc) # gets the current buffer
    if contains &amp;#39;opt&amp;#39; $cmd
        return 0 # can completion
    end
    return 1 # cannot complete
end
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Now define the completion&lt;/span&gt;
&lt;span class="c"&gt;# For the curious, this can be highlighted as sh because it doesn&amp;#39;t contain&lt;/span&gt;
&lt;span class="c"&gt;# any if-end blocks.&lt;/span&gt;
&lt;span class="nb"&gt;complete&lt;/span&gt; --command &lt;span class="s1"&gt;&amp;#39;my-favourite-program&amp;#39;&lt;/span&gt; --long &lt;span class="s1"&gt;&amp;#39;mytest&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --condition &lt;span class="s1"&gt;&amp;#39;__fish_complete_test&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --description &lt;span class="s1"&gt;&amp;#39;defies description&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;That works, but now the value that the command is looking for is hardcoded.  That's an easy problem to solve - functions can take parameters, just as they can elsewhere in the fish shell.  To test it, if the shell contains &lt;code&gt;'opt'&lt;/code&gt;, it will give the mytest option, but if it contains &lt;code&gt;'arg'&lt;/code&gt;, it will have the mytest argument.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;function __fish_complete_test
    set cmd (commandline -opc) # gets the current buffer
    set needle $argv[1]
    if contains $needle $cmd
        return 0 # can completion
    end
    return 1 # cannot complete
end
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;complete&lt;/span&gt; --command &lt;span class="s1"&gt;&amp;#39;my-favourite-program&amp;#39;&lt;/span&gt; --long &lt;span class="s1"&gt;&amp;#39;mytest&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --condition &lt;span class="s1"&gt;&amp;#39;__fish_complete_test opt&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --description &lt;span class="s1"&gt;&amp;#39;defies description&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;complete&lt;/span&gt; --command &lt;span class="s1"&gt;&amp;#39;my-favourite-program&amp;#39;&lt;/span&gt; --arguments &lt;span class="s1"&gt;&amp;#39;mytest&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --condition &lt;span class="s1"&gt;&amp;#39;__fish_complete_test arg&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --description &lt;span class="s1"&gt;&amp;#39;defies description&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And that works as well!  However, there's another snag here.  &lt;code&gt;'opt'&lt;/code&gt; and &lt;code&gt;'arg'&lt;/code&gt; could be anywhere in the command, not just in the correct places.  But subcommands rely on an order or hierarchy, from the base command through each subcommand to the final leaf subcommand that is executed.  That can still be determined, it just requires a bit more effort.  Given a list of subcommands with a certain depth, the simplest way that I can come up with without hardcoding too much is to loop through each of the subcommands and check that the token on the buffer at that position equals the subcommand at that level.&lt;/p&gt;
&lt;p&gt;An example will probably explain this better.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;function __fish_at_level
  set cmd (commandline -opc)
  set subcommands $argv
  set subcommands_len (count $subcommands)
  if [ (count $cmd) -eq $subcommands_len ]
    for i in (seq $subcommands_len)
      if [ $subcommands[$i] != $cmd[$i] ]
        return 1
      end
    end
    return 0
  end

  return 1
end
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;complete&lt;/span&gt; --command &lt;span class="s1"&gt;&amp;#39;my-favourite-program&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --condition &lt;span class="s1"&gt;&amp;#39;__fish_at_level my-favourite-program&amp;#39;&lt;/span&gt;
    --arguments &lt;span class="s1"&gt;&amp;#39;open close&amp;#39;&lt;/span&gt; --exclusive
&lt;span class="nb"&gt;complete&lt;/span&gt; --command &lt;span class="s1"&gt;&amp;#39;my-favourite-program&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --condition &lt;span class="s1"&gt;&amp;#39;__fish_at_level my-favourite-program subcommand&amp;#39;&lt;/span&gt;
    --arguments &lt;span class="s1"&gt;&amp;#39;yes no&amp;#39;&lt;/span&gt; --exclusive
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If the prompt starts with just &lt;code&gt;my-favourite-program&lt;/code&gt;, autocomplete will produce &lt;code&gt;'open'&lt;/code&gt; or &lt;code&gt;'close'&lt;/code&gt;.  On the other hand, if the prompt reads &lt;code&gt;my-favourite-program subcommand&lt;/code&gt;, then autocomplete will suggest &lt;code&gt;'yes'&lt;/code&gt; and &lt;code&gt;'no'&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This doesn't work perfectly.  There are two big issues with it that I can see.  Firstly, it pins the name of the command being completed.  The fish shell has a concept of "wrapping" commands that allows one command to inherit another's completions.  However, the condition function defined here pins the command down - another command wrapping this would never pass the condition because it wouldn't have the same first token on the buffer.&lt;/p&gt;
&lt;p&gt;The other big issue is that this allows for one, and only one completion for each subcommand.  That is, if the input so far has been "myprog foo --opt=arg", then the condition won't select any arguments for the command foo, because &lt;code&gt;--opt=arg&lt;/code&gt; already exists on the buffer.&lt;/p&gt;
&lt;p&gt;I'm not going to work through the solutions for these right here, because they're complicated, and I'm not entirely sure my solution is all that brilliant.  Bear in mind that I'm looking for a generic solution I write out as a header to all of my Rust program's completion scripts - in general, it may (read will) be far more efficient to tailor the condition function to the command you're writing a completion for.&lt;/p&gt;
&lt;p&gt;However, to finish, I'll show the finished condition function, and link to a &lt;a href="https://github.com/MrJohz/completist/blob/2a120d8174c58ae85f87123844ae8988e39e9a47/samples/fish_completion.fish"&gt;file on Github&lt;/a&gt; that demonstrates how to use it, and provides completions for a basic imaginary command.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;function __fish_at_level
  # set useful variables
  set cmd (commandline -opc)
  set subcmd_index (contains --index &amp;#39;&amp;#39; $argv)
  if [ $subcmd_index -eq 1 ]
    set subcommands # empty list
  else
    set subcommands $argv[1..(math $subcmd_index - 1)]
  end
  if [ $subcmd_index -eq (count $argv) ]
    set ignore_commands # empty list
  else
    set ignore_commands $argv[(math $subcmd_index + 1)..-1]
  end
  set subcommands_len (count $subcommands)

  # Test that the initial subcommands are always equal
  if [ (count $cmd) -le $subcommands_len ]
    return 1
  end
  for i in (seq $subcommands_len)
    if [ $subcommands[$i] != $cmd[(math $i + 1)] ]
      return 1
    end
  end

  # Test that the most recent command isn&amp;#39;t a further subcommand
  for i in $ignore_commands
    if [ (count $cmd) -lt (math $subcommands_len + 2) ]
      return 0
    else if [ $cmd[(math $subcommands_len + 2)] = $i ]
      return 1
    end
  end

  return 0
end
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="footnote"&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id="fn:rust-advice"&gt;
&lt;p&gt;This is not true&amp;#160;&lt;a class="footnote-backref" href="#fnref:rust-advice" rev="footnote" title="Jump back to footnote 1 in the text"&gt;[back]&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jonathan Frere</dc:creator><pubDate>Fri, 14 Aug 2015 14:50:04 +0100</pubDate><guid>tag:www.johz.me,2015-08-14:posts/2015/Aug/14/completion-in-fish/</guid><category>fish-shell</category><category>coding</category></item><item><title>A Collection of Benchmarks that I Found Useful</title><link>http://www.johz.me/posts/2015/Jan/17/get-benched/</link><description>&lt;p&gt;As Donald Knuth once explained, 97% of a programmer's time should be spent making their code as fast as possible.  (The other 3% is waiting for the code to compile.)  Most programmers have a host of shortcuts, tricks, and clever codes up their sleeves to ensure that their code runs as fast as it possibly can.  For example, in JavaScript, many developers have spent years studying the secret arts of the for-loop to determine how to loop through arbitrary numbers most quickly.  (The answer to this particular question is actually an inverse-backwards while-never-done-loop, where the first character on each line is an 'a', and where the programmer chants hymns worshipping Azathoth.)  The faster their code works, the more web-scale their &lt;del&gt;node.js&lt;/del&gt; io.js programs will be.&lt;/p&gt;
&lt;p&gt;There are lots of myths, legends, and rumours about optimization, and it's often very difficult to sort out the truth from the lies.  However, to help us in our quest for absolute speed, good programmers should always use benchmarks.  Benchmarks are a way of comparing like-for-like speeds of two programs, each containing different ways of doing the same thing, to determine which method is the quickest, and should therefore be used in all circumstances.  Of course, true benchmarks are often extremely difficult, and so programmers are often forced to compare unlike-for-unlike.  However, the major differences between like-for-like and unlike-for-unlike are usually negligible, and so a good programmer can almost always simplify a complex comparison into a very straight race between two arbitrary pieces of code, and interpret the results correctly.  This simplification is done in much the same way that a physicist simplifies complex problems to simple ones using spherical cows in a vacuum.&lt;/p&gt;
&lt;h3&gt;The Importance of Whitespace&lt;/h3&gt;
&lt;p&gt;The first misconception that many programmers have is that whitespace makes no difference.  While in most cases, good compilers can optimize away whitespace, and sometimes even remove it entirely from the resulting binary, it can still make a large difference to compile-times, and as programmers need to spend at least 97% of their time optimising, decreasing the length of time that a programmer needs to wait to compile a program is always a good thing.  Of course, this is to say nothing of interpreted programs, where there is no compilation stage, and so the whitespace cannot ever be optimized away, and must remain during the final execution of the program.&lt;/p&gt;
&lt;p&gt;The best way to demonstrate this is with a benchmark.  Consider the programs fast.c and slow.c (these are available on Github &lt;a href="https://github.com/MrJohz/benchmarks/tree/master/whitespace"&gt;here&lt;/a&gt;, although I would encourage you not to actually open slow.c unless you like dealing with very large text files).  They both do the same thing - print out "Hello, World!".  However, they have radically different compile times because of the amount of whitespace involved.  If we run the &lt;code&gt;make&lt;/code&gt; command, we can get the output, which includes timings of individual portions as performed by &lt;code&gt;gcc&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;$&lt;/span&gt; make
&lt;span class="go"&gt;Fast implementation (no whitespace)&lt;/span&gt;
&lt;span class="go"&gt;wc -c fast.c&lt;/span&gt;
&lt;span class="go"&gt;104 fast.c&lt;/span&gt;
&lt;span class="go"&gt;gcc -time fast.c&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; cc1 0.02 0.00
&lt;span class="gp"&gt;#&lt;/span&gt; collect2 0.02 0.00

&lt;span class="go"&gt;Slow implementation (some whitespace)&lt;/span&gt;
&lt;span class="go"&gt;wc -c slow.c&lt;/span&gt;
&lt;span class="go"&gt;86124463 slow.c&lt;/span&gt;
&lt;span class="go"&gt;gcc -time slow.c&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; cc1 0.18 0.04
&lt;span class="gp"&gt;#&lt;/span&gt; collect2 0.02 0.00
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Here it is very easy to see that having to parse 83 thousand times the amount of bytes actually made the second implementation slightly slower to compile!  This is of huge importance in our files.  While we may not always notice the speed difference in our day-to-day programming experience, it is always good practice to use as little whitespace as possible when writing programs.  As I mentioned earlier, this applies to both compiled programs and interpreted programs, although the difference for the latter is much greater, as the performance hit will actually occur during runtime.  What you may not know (and what hasn't been demonstrated here, but is left as an exercise to the reader) is that this also applies to comments as well - this is in fact the main reason for the "self-documenting code" movement, as repeating the documentation both in the code itself, and in comments alongside the code, is known to slow down character-by-character file input by as much as 200% (for perfectly balanced code/comment combinations).&lt;/p&gt;
&lt;h3&gt;Interpreted vs Compiled&lt;/h3&gt;
&lt;p&gt;Another important area of concern for programmers is the debate between interpreted languages and compiled languages.  Essentially, interpreted programming languages do all of the work when they are run, whilst compiled programming languages do some work at compile-time, and some work at runtime.  This would suggest that compiled programming languages are generally faster when being run, as they have to do less work at runtime.  The issue with this naive understanding of programming is that it doesn't take into account the amount of work done at compile-time.  Proper benchmarking should include all stages of a program's execution, even the stages before it's actually started to execute.&lt;/p&gt;
&lt;p&gt;There is also a middle ground between compiling a programming and directly interpreting a program.  Many modern interpreters are actually "JIT" compilers, which do both compilation and interpretation at the same time, at runtime.  While they still have to do all of the work at runtime, they are able to do extra work making other parts of the program take less work.  The aim is that eventually the amount of work that is saved will be greater than the amount of extra work that is required, but it is doubtful if this will ever happen.  Many computer experts believe that JIT compilers will remain in the realm of fantasy and academia for many years to come.  However, in the interests of fairness, we will also use a JIT compiler in our benchmarking.&lt;/p&gt;
&lt;p&gt;Our test will be a simple "Hello, World!" example - that is, all three programs (compiled, interpreted and JIT-interpreted) should simply print out the phrase "Hello, World!".  While this is generally an extremely simple task, we will easily be able to extrapolate from the results any conclusion that we would like to draw.  The programming languages that we shall use will be C++ (compiled using "g++ (Ubuntu 4.8.2-19ubuntu1) 4.8.2", whatever that means); Python (interpreted using "CPython 3.4.2"); and Python again (this time JIT compiled using "Python 3.2.5").  As we said previously, a good benchmark should compare all parts of a program's lifetime, so we will measure the length of time it takes the C++ program to compile, as well as the execution time for all the programs.  As in the previous test, the test-code is available on &lt;a href="https://github.com/MrJohz/benchmarks/tree/master/int-comp"&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;$&lt;/span&gt; make
&lt;span class="go"&gt;C++ version&lt;/span&gt;
&lt;span class="go"&gt;../benchmarker.py -n20 &amp;quot;g++ helloworld.c -ohelloworld &amp;amp;&amp;amp; ./helloworld&amp;quot;&lt;/span&gt;

&lt;span class="go"&gt;------------------------------ &lt;/span&gt;
&lt;span class="go"&gt;   g++ helloworld.c -ohelloworld &amp;amp;&amp;amp; ./helloworld&lt;/span&gt;
&lt;span class="go"&gt; max/min:    0.07519780099755735     0.053425493999384344&lt;/span&gt;
&lt;span class="go"&gt; mean ave:   0.06308976999989682&lt;/span&gt;
&lt;span class="go"&gt; median ave:     0.06266852850058058&lt;/span&gt;
&lt;span class="go"&gt;------------------------------&lt;/span&gt;
&lt;span class="go"&gt;CPython version&lt;/span&gt;
&lt;span class="go"&gt;../benchmarker.py -n20 &amp;#39;python -c &amp;quot;print(\&amp;quot;Hello, World\&amp;quot;)&amp;quot;&amp;#39;&lt;/span&gt;

&lt;span class="go"&gt;------------------------------ &lt;/span&gt;
&lt;span class="go"&gt;   python -c &amp;quot;print(\&amp;quot;Hello, World\&amp;quot;)&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt; max/min:    0.0267868869996164      0.023469741001463262&lt;/span&gt;
&lt;span class="go"&gt; mean ave:   0.02465028059996257&lt;/span&gt;
&lt;span class="go"&gt; median ave:     0.02490398199915944&lt;/span&gt;
&lt;span class="go"&gt;------------------------------&lt;/span&gt;
&lt;span class="go"&gt;PyPy version&lt;/span&gt;
&lt;span class="go"&gt;../benchmarker.py -n20 &amp;#39;pypy -c &amp;quot;print(\&amp;quot;Hello, World\&amp;quot;)&amp;quot;&amp;#39;&lt;/span&gt;

&lt;span class="go"&gt;------------------------------ &lt;/span&gt;
&lt;span class="go"&gt;   pypy -c &amp;quot;print(\&amp;quot;Hello, World\&amp;quot;)&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt; max/min:    0.22487263600123697     0.16340099499939242&lt;/span&gt;
&lt;span class="go"&gt; mean ave:   0.20837249334999797&lt;/span&gt;
&lt;span class="go"&gt; median ave:     0.21045488100025977&lt;/span&gt;
&lt;span class="go"&gt;------------------------------&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The statistics here are extremely clear - interpreted programs actually run faster than compiled programs, if you include the compilation time.  What is interesting - albeit not necessarily unexpected - to note is that the pypy attempt took on average nearly ten times as long as the CPython attempt.  As I said earlier, JIT compilers are very much in the realm of academia currently, and we are unlikely to see one of these outperform a proper programming language implementation in the next decade.&lt;/p&gt;
&lt;p&gt;While not specifically tested in this particular test, it's also important to note that both of the Python programs were significantly shorter than the C++ program, and could indeed be sent to the interpreter as a single line.  On the other hand, the C++ program had to be written in a separate file, and even the command itself had more text on it.  The upshot of this is that the C++ program contains more whitespace - of course, in this benchmark that probably isn't a huge factor, but experience programmers should be wise to the fact that Python's terseness often offers a not insignificant speed bonus.&lt;/p&gt;
&lt;h3&gt;Direct Comparison&lt;/h3&gt;
&lt;p&gt;Of course, these are just specific features of individual programming languages that we have been comparing so far.  In many cases, we want to know how the overall program would perform in a real-life situation.  This will often require large and extensive benchmarks that compare a number of different programming languages.  One of the big pitfalls that many of these benchmarks fail to avoid is the use of idiomatic programming features.  In most languages, there is a "right" way to do things and a "wrong" way to do things.  For example, the Java JVM is extremely versatile when it comes to loops, as it can make these run as efficiently as possible.  However, many Java users fail to realise this, and there is a lot of lost potential in many Java programs.  For example, most naive Java users would write a method that adds two numbers like so:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;slowAdd&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;In actual fact, idiomatic Java would look much more like this.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;fastAdd&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;++;&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;++;&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This will work much faster, due to the JVM's affinity for looping constructs.&lt;/p&gt;
&lt;p&gt;Of course, the differences between programming languages often goes a lot further than the best way to add different numbers together.  Most programming languages were designed for completely different purposes, and as a result testing them all in exactly the same way is usually the wrong way to do benchmarks.  Instead, the challenges given to each programming languages (and the method used to complete the challenge) should be specifically designed for each programming language.  Of course, to maintain independence, each programming language should be measured in exactly the same way, otherwise the results would be incomparable.&lt;/p&gt;
&lt;p&gt;In our comparison, we'll test Python, Java, and Perl, attempting to write the most idiomatic code possible to ensure that each language has the best possible chance.  The source code for this test will not be on GitHub, as anyone fluent in these languages should be writing these things every day, and there really is no need to bombard you with thing that I'm sure you already know.&lt;/p&gt;
&lt;p&gt;In our Python program, we will be attempting to write the most commonly written Python program, &lt;code&gt;print("Hello, World!")&lt;/code&gt;.  Many people would question the use of such a basic test, but the huge number of people who demonstrate this piece of code as evidence of Python's simplicity and versatility in all things cannot be called into question.  Ultimately, if you can write the Hello, World! Python program, you can write any piece of Python code at all, as long as it solely involve printing out a string.  As a result, this is the benchmark code I will use.&lt;/p&gt;
&lt;p&gt;On the other hand, very serious people use Java to do very serious things, and so to trivialise the language to simply printing out a string would be to do the Java community a huge disservice.  Instead, our benchmark Java code will create a server, and wait indefinitely for a response.  This is basically the code that most Java experts write every day.  Unfortunately it will not be &lt;em&gt;truly&lt;/em&gt; idiomatic Java, as that would require a huge number of Java classes that I honestly can't be bothered to write just for the sake of a cheap shot, especially as it's been done &lt;a href="https://github.com/EnterpriseQualityCoding/FizzBuzzEnterpriseEdition"&gt;before&lt;/a&gt;.  It is arguable that the Java code will be unable to stop, as it will hang forever until it receives a quit signal at the terminal.  To be honest, I think this just makes it more and more clear how slow idiomatic Java code is.  Also buggy.  Java code is probably buggy too.  It's still cool to hate Java, right?&lt;/p&gt;
&lt;p&gt;Finally, we have our Perl program.  Perl is designed to be as quick as possible, by omitting any extraneous necessities like readability.  No-one is quite sure what idiomatic Perl programs should actually do, as it is difficult to remember the exact invocation syntax for that Perl script you wrote several years ago that you're quite sure did something with XML files, but you're not really sure &lt;em&gt;what&lt;/em&gt;.  Of course, you could just read the source, but to be honest it would probably be easier to rewrite the whole thing rather than dabble in that sort of black magic and wizardry.&lt;/p&gt;
&lt;p&gt;It turns out that the idiomatic Perl program doesn't actually work.  I'm 90% certain I wrote everything write, so I'm going to blame the Perl interpreter.  Perl is, after all, notoriously difficult to read, and everyone knows that computers are fairly stupid.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Basically, Python won.  Also Dumbledore dies at the end.  Spoiler." src="http://i.imgur.com/1kccxn5.png" /&gt;&lt;/p&gt;
&lt;p&gt;In the end, it appears that Python won both of the benchmarks that it was involved in, compared to C, and also compared to Java and Perl.  A basic interpretation of these results would suggest that, when writing programs that print out "Hello, World!", Python is extremely strong.  We can also quickly extrapolate from this that Python is probably the best language in the world for most of the world's problems.  Thankfully, as a Python programmer, I have basically just proved exactly what I knew already - I mean, it would be a bit shocking if it suddenly turned out I'd been wrong, eh?&lt;/p&gt;
&lt;p&gt;Thanks for reading this short, humble, but extremely accurate blog on proper benchmarking practice.  There are a lot of people on the internet who are producing very dangerous and misleading benchmarks, that encourage people down dangerous paths, such as trying silly languages, just because they appear to beat certain things on certain benchmarks.  As I have clearly shown here, there is a right way to interpret benchmark results, and a wrong way.  I encourage you to share this with your friends, family, and strangers that you meet on the street, and particularly with those who persist in producing irrelevant and silly benchmarks simply for the sake of comparison.&lt;/p&gt;
&lt;p&gt;Python for life!&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jonathan Frere</dc:creator><pubDate>Sat, 17 Jan 2015 12:02:32 +0000</pubDate><guid>tag:www.johz.me,2015-01-17:posts/2015/Jan/17/get-benched/</guid><category>coding</category><category>benchmarks</category><category>humour</category></item><item><title>The Definitive Guide to Copying and Pasting in JavaScript (the other kind...)</title><link>http://www.johz.me/posts/2014/Dec/19/the-definitive-guide-to-copying-and-pasting-in-javascript/</link><description>&lt;h2&gt;Step 1: Don't.&lt;/h2&gt;
&lt;p&gt;Stop.  You don't want flashing lights.  You don't want snowflake all over your page.  You don't want a trail of happy faces that will follow your cursor all around your page.  We left these things in decades past for a reason, dammit!  Keep them there, for all our sakes.  No copy and paste!  Ever!  No, no, no, no, no!&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;/p&gt;
&lt;p&gt;Well, yes, sometimes there is a reason to copy and paste text from the internet, particularly if you're learning.  Sometimes you're looking for a bit of advice on the perfect way to memoize some functions, or a quick and easy method to merge two objects, or even just a couple of basic string functions that you really wish had appeared in earlier EMCAScript specs.  In these cases, finding a quick "cookbook recipe" on the internet can be a great convenience.  Often, it's a really good way for newer developers to expand their understanding of some of the language shortcuts.  The question then is "how should I best learn from this recipe?"  For you, then, comes step two.&lt;/p&gt;
&lt;h2&gt;Step 2: Do it well.&lt;/h2&gt;
&lt;h3&gt;Never copy-and-paste, always rewrite.&lt;/h3&gt;
&lt;p&gt;I remember a book I once got given called &lt;em&gt;"Hello, World!"&lt;/em&gt;, written by Sande &amp;amp; Sande (a father and son duo).  It was a Python programming introduction for "Kids and other beginners".  Fairly near the start, they gave a listing for a program that was certainly larger than anything that I'd seen up until that point that would let you play the classic skiing game where you have to ski down the mountain without hitting into things.  Of course, this being the technical age, they also provided a download for all the programs featured in the book, but this one came with a special note.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The code for listing 10.1 is in the &lt;code&gt;\examples\skier&lt;/code&gt; folder, so if you get stuck or just don't want to type it all in, you can use that file.  But believe it or not, you'll learn more by typing it in than by just opening and looking at the listing.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So of course I typed the whole file in, and it came up with an error, because I wasn't very good at coding, and didn't understand what most of it actually did or meant&lt;sup id="fnref:pythonfailure"&gt;&lt;a class="footnote-ref" href="#fn:pythonfailure" rel="footnote"&gt;1&lt;/a&gt;&lt;/sup&gt;.  However, I did start to piece together what the thing was actually meant to do.  I could read the names and the comments in the sidebar, and together I could get a feel for what sort of magic a line like &lt;code&gt;pygame.image.load(image_file)&lt;/code&gt; might actually do.  (For the unitiated: it loads an image from an image file.  It's part of the pygame system.  This is not hard stuff, but when you're beginning it feels amazing...)&lt;/p&gt;
&lt;p&gt;What &lt;em&gt;"Hello, World!"&lt;/em&gt; had taught me in that small example was how to read code.  The way you read code is to go through each line individually.  This is probably not surprising for most well-practised developers, but in my various experiences of learning programming, reading code (and the sister-skill of thinking like a computer whilst doing so) are extremely under-taught.&lt;/p&gt;
&lt;p&gt;This is the same when you are trying to use that useful function from the internet.  You &lt;em&gt;could&lt;/em&gt; just copy and paste it.  That will work, and get you developing quickly, and you can go home, have a delicious dinner, watch some superb television, have the most beautiful dream, and then wake up next morning with everything going wrong because you didn't quite understand that function you used, and it turns out it's caught on an edge case that - as the case may be - is actually quite common in your circumstances.&lt;/p&gt;
&lt;p&gt;Of course, that's probably a rare example.  A lot of the functions that you paste are probably quite good, and will work quite well.  After all, StackOverflow is known for never ever being wrong ever.  However, it should always be on your mind that if you don't understand the code you're writing, it will always run the risk of jumping back at you and biting you.  When you write the function out, line-by-line, you'll quickly start to understand what cases this will deal with, and what cases this won't cope with.  You'll be able to see what guards exist, what format the function will return, and whatever other features the original creator put in but didn't document.&lt;/p&gt;
&lt;h3&gt;Always change at least one thing.&lt;/h3&gt;
&lt;p&gt;For me, this idea followed on quite easily from the previous piece of advice.  When you write out a piece of code, I find it relatively easy to just find little things that I want to change.  With JavaScript it's usually something as simple as turning snippets that extend an object's prototype into normal functions, as per &lt;a href="http://www.nczonline.net/blog/2010/03/02/maintainable-javascript-dont-modify-objects-you-down-own/"&gt;best practice&lt;/a&gt;.  With other languages, it might be something more complex, such as generalising a function designed for one case into a function designed for many cases.  You might dislike the specific formatting style that the example uses - change it.  Think you can use better variable names?  Use them.  Hell, if you're just copying in an algorithm that you're not entirely sure you grasp, try covering it in comments until you can see exactly what each line is there for.  (Admittedly, overuse of this particular example is probably a particularly bad idea, so if you find yourself doing this a lot, try finding less complex algorithms to do the same thing.  Alternatively, this might be the time you start looking for a well-maintained third-party library where someone else is doing all the legwork.)&lt;/p&gt;
&lt;p&gt;Take for example, this beautiful JavaScript function that returns a repeated string:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;// This version will actually work thanks to&lt;/span&gt;
&lt;span class="c1"&gt;// http://www.reddit.com/r/javascript/comments/2pwz7l/the_definitive_guide_to_copying_and_pasting_in/cn0z7lm&lt;/span&gt;
&lt;span class="c1"&gt;// Modified from http://stackoverflow.com/questions/1235179/simple-way-to-repeat-a-string-in-java&lt;/span&gt;
&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;times&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;times&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;times&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;repeat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;times&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;repeat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;Math&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;floor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;times&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Some things I can easily do.  For example, this is using prototypes, and it isn't even using them well.  It's also using the fact that &lt;code&gt;if&lt;/code&gt; can take a statement rather than a brace of statements.  Personally, I don't like that, except for rare cases, and I'm not of the opinion that this is a rare enough case.  If I want to make it a stand-alone function, I'll also need to change the name to make it clear that this is repeating a string.  Let's see what it looks like now:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;repeatStr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;times&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;times&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;times&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;repeatStr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;str&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;times&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;repeatStr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;times&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To me, that looks a bit better.  But I'm still not sure what this function actually does.  I know it repeats strings, but what sort of magic is there under the hood?&lt;sup id="fnref:obtuse"&gt;&lt;a class="footnote-ref" href="#fn:obtuse" rel="footnote"&gt;2&lt;/a&gt;&lt;/sup&gt;  This is the best time to start adding comments in.  Let's smother that function.  We'll also re-add the most important part of any copy-and-paste code: the attribution.  This is partly because your source clearly deserves the recognition, but mainly because - as with the rest of your code - you'll probably come back later and wonder why you were so stupid as to write that.  At least when you can attribute parts of your code to others, it's not your fault.  (We'll discuss attribution slightly more properly a bit later on.)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;// Modified from http://stackoverflow.com/questions/1235179/simple-way-to-repeat-a-string-in-java&lt;/span&gt;
&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;repeatStr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;times&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;times&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;  &lt;span class="c1"&gt;// if no times needed&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;     &lt;span class="c1"&gt;// return empty string&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;times&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;                 &lt;span class="c1"&gt;// if times is even&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;repeatStr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;str&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;times&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;  &lt;span class="c1"&gt;// divide time by two, double str&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;                                                          &lt;span class="c1"&gt;// if times is odd&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;repeatStr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;Math&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;floor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;times&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;  &lt;span class="c1"&gt;// divide time by two, double str, add str for remainder&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Do you begin to understand how it works a bit now?&lt;/p&gt;
&lt;h3&gt;Always find an alternative.&lt;/h3&gt;
&lt;p&gt;StackOverflow is a beautiful thing.  However, it is also a relatively fractured thing, and the sum of knowledge within it is built from many different parts, with opinions that can often appear to contradict each other.  This is the wonder of any system where opinions are crowd-sourced, and is why you should never trust the word of random blogs posted on link aggregation sites that claim to have all the answers.  There are always alternatives.&lt;/p&gt;
&lt;p&gt;This is a good thing, because it means you've got to think for a bit.  Say you find a function on the internet that claims to repeat a string.  Say you find two, or three, or many functions.  At some point you're going to need to decide between them.  And at that point you're going to need to understand how they work, and more specifically, why they may or may not be appropriate to you.&lt;/p&gt;
&lt;p&gt;The best example here is probably a for loop, not because it's something that people regularly need to copy into their code, but because it's something that's so ubiquitous when it comes to optimization.  The standard mantra is that reverse for loops are the fastest loops, because back when programming required intimate knowledge of how a computer would spend each clock cycle, it was possible to implement a number of tricks in the computer hardware that could decrease the number of instructions used in each loop.  When you're writing code that requires every last drop of performance from the CPU, and touching the bones of the computer to do so, each extra clock cycle can be a beautiful and valuable gift.&lt;/p&gt;
&lt;p&gt;Of course, none of this applies to JavaScript.  Despite this, there are a plethora of ways of looping available to budding web developers, each claiming to be the best, the fastest, the most optimised, and each providing their own set of benchmarks to back this up.  The question then becomes how to choose between them - which in turn becomes a question of what you're actually looking for in your for loops.&lt;/p&gt;
&lt;p&gt;Of course, this will depend on what you need your for loop for.  Most of the time it will be fairly simple.  Perhaps you don't need absolute blazing speed, but you do need the code to look clear and concise.  In that case, your solution might be a &lt;code&gt;for x in xs&lt;/code&gt; loop, or perhaps &lt;code&gt;xs.forEach&lt;/code&gt;.  Or perhaps you need backwards compatibility across all browsers currently in use, and all browsers not in use that your boss still demands compatibility for.  In that case, the humble &lt;code&gt;for (...) { }&lt;/code&gt; loop is probably your best bet, and may god have mercy on your soul.  Maybe you're developing an application that demands absolute blazing speed of a kind never before seen in an interpreted scripting language.  In that case, I have no idea what the perfect solution is, but it's probably the sort of thing you'll find out after a long time spent with a huge number of benchmarking suites.&lt;/p&gt;
&lt;p&gt;This in turn has parallels for finding recipes on the internet.  You want to use the best tool for the job, and to do that you need to understand what jobs any snippets you find are.  In my experience the best way to do that is to find alternatives, and to compare and contrast.  You won't be able to tell why snippet &lt;em&gt;a&lt;/em&gt; is so good unless you know about its direct competitor &lt;em&gt;b&lt;/em&gt;.  This way you'll be able to expand your knowledge, and understand more easily what the text you're copying into your code will actually do.&lt;/p&gt;
&lt;h2&gt;Step 3: ...Profit?&lt;/h2&gt;
&lt;p&gt;Of course, all this advice is given with the aim of learning how to be a better programmer.  Over time, if you are repeatedly copying the same pieces of code into your project, that there's probably a greater issue somewhere.  In some languages it might well be that you're using the wrong idioms (creating a map where an enum-type would be more helpful, or complex case statements where a map would be more useful).  In other languages where the problem is more the lack of a standard library, the solution might be to find a third-party library that you can use consistently.  With JavaScript, the latter case is often true, and it may well be that learning how to effectively use tools such as &lt;a href="https://lodash.com/"&gt;lodash&lt;/a&gt; and &lt;a href="http://underscorejs.org/"&gt;underscore&lt;/a&gt; will help you a lot.  However, for those who are taking early steps in a language, I'd argue that copying and pasting is not wrong - as long as you do it properly.&lt;/p&gt;
&lt;h2&gt;Step 4 and Step 0: Attributions!&lt;/h2&gt;
&lt;p&gt;&lt;a href="http://www.reddit.com/user/jimschubert"&gt;/u/jimschubert&lt;/a&gt; reminded me in the discussion on this post on Reddit that one important thing to do that I didn't properly emphasise is to attribute your stuff properly (and even determine if you're allowed to use it).  I did briefly mention when I talked about changing the code that it's always good to put a comment saying where you got the code from, but proper attribution is an interesting legal issue.  For many things (particularly in web-development and Java applications), you'll probably find your snippets from Stack Overflow.  Stack Overflow puts everything it hosts under the Creative Commons &lt;a href="http://creativecommons.org/licenses/by-sa/3.0/"&gt;CC BY-SA 3.0&lt;/a&gt; license.  Generally, this allows you to do with the content what you like, as long as you give "appropriate credit" (indicating if you changed it), and distribute any modifications under the same (or a compatible) license.&lt;/p&gt;
&lt;p&gt;The other big source of snippets is blog posts and technical articles.  If the article is an "official source" (for example examples on the Mozilla JS docs), or a large enough software organisation they will probably have a note at the bottom of the page that gives you the official state of licensing for any information on that site.  (In the case of the MDN pages, code samples are either under the MIT license, or in public domain, while the rest of the text is under the CC BY-SA 2.5 license.)  For smaller blogs that haven't thought about this issue, the issues are slightly more complex.  There are generally two schools of thought, one stating that if there's no license, it's in the public domain, and the other stating that in the absence of a license, it should be assumed that all rights are reserved.  It's probably a good rule of thumb that someone releasing unlicensed code into the world does consider it public domain (this has always been my assumption, although having researched this little section, I realise it would probably be wise for me to think about licensing code snippets on my blog more carefully).  However, if you're writing code on behalf of a company with concerns about being sued, the general feeling is usually that unlicensed code isn't really worth it.&lt;/p&gt;
&lt;p&gt;This, then would be my advice, partly built on trying to abide by the complicated legal issues, and partly built on just trying to be as nice as possible to the original authors:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Always provide attributions and the source.  I don't know of any license that forbids them, and it's polite to do so.  Plus, as I said earlier, you can always blame other people.&lt;/li&gt;
&lt;li&gt;Always say if you've modified the original.  (Of course, if you were following Step 2 properly, you'll always be modifying it anyway!)&lt;/li&gt;
&lt;li&gt;If you can see a license, obey any further stipulations in that license.  Note that some "viral" licenses may affect how you license your own work.  If you can't abide by those licenses, you should not use the code.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Again, I am not in any way, shape, or form a lawyer.  This is not legal advice.  But it's my opinion, and probably some decent practical advice that might work for you.&lt;/p&gt;
&lt;h2&gt;Side note about the title:&lt;/h2&gt;
&lt;p&gt;It's based on &lt;a href="https://www.lucidchart.com/techblog/2014/12/02/definitive-guide-copying-pasting-javascript/"&gt;this&lt;/a&gt; article submitted to the &lt;a href="http://www.reddit.com/r/javascript"&gt;&lt;code&gt;/r/javascript&lt;/code&gt;&lt;/a&gt; sub on Reddit.  That article is a very interesting one about how to use the clipboard from a JavaScript application in a cross-browser way, and is very interesting, but it did confuse me for a while as I did manage to get the wrong impression from the title.  For those people like me, who are easily confused by these simple matters, I submit this blog post, which might not help.&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id="fn:pythonfailure"&gt;
&lt;p&gt;If I remember correctly, I got really irritated at that point, angrily turned the computer off, stormed off to my room, and didn't come down for the rest of the day.  My poor father who'd been trying to please my yearning to become a programmer must've been really quite worried - thankfully that didn't deter me significantly, and while I never got that code to work, I did continue learning Python.&amp;#160;&lt;a class="footnote-backref" href="#fnref:pythonfailure" rev="footnote" title="Jump back to footnote 1 in the text"&gt;[back]&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:obtuse"&gt;
&lt;p&gt;You might think this is me being obtuse.  This is a real snippet that I copied recently in Java.  I could see why it would be efficient (it doubles the length each time, rather than adding each string individually), but it took a while to connect in my head how exactly it worked, particular for cases that weren't multiples of two.  By putting comments everywhere, I started to understand very clearly what each line was doing.&amp;#160;&lt;a class="footnote-backref" href="#fnref:obtuse" rev="footnote" title="Jump back to footnote 2 in the text"&gt;[back]&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jonathan Frere</dc:creator><pubDate>Fri, 19 Dec 2014 20:54:32 +0000</pubDate><guid>tag:www.johz.me,2014-12-19:posts/2014/Dec/19/the-definitive-guide-to-copying-and-pasting-in-javascript/</guid><category>coding</category><category>javascript</category></item><item><title>I Made A Thing. Then I Learned Some More Things.</title><link>http://www.johz.me/posts/2014/Jul/16/i-made-a-thing-then-i-learned-some-more-things/</link><description>&lt;p&gt;I made a &lt;a href="http://wfe.johz.me"&gt;thing&lt;/a&gt;.  The thing is called "The WFE Thing", because I am unoriginal with names.  It is a thing for WFEs, which are World Factbook Entries, which are a part of a not-particularly-famous game called &lt;a href="http://www.nationstates.net/"&gt;NationStates&lt;/a&gt;.  The importance of WFEs is hard to understand unless you understand raiding and defending in NationStates, and even then one could very easily fail to recognise the necessity of the tool I have constructed.  Essentially, sometimes bad people delete other people's data, but this is entirely legal and acceptable in the game.  To counter this, other people come along afterwards and undo it, not because they have to as moderators or admins, but out of the fun of doing so, and out of care for the people whose data was deleted.  The WFE Thing records some (but not all) of this data from historical points so that it can be accessed easily at any time.  If this makes any sense to you at all, you're a better person than me.&lt;/p&gt;
&lt;p&gt;But enough about NationStates, let's talk about The WFE Thing, because it was fun to make and I need an excuse to write a blog post because I've been really missing it recently.&lt;/p&gt;
&lt;p&gt;The need for a historical list of WFEs (just think of this as a more regular, specific version of the &lt;a href="http://archive.org/web/"&gt;Wayback Machine&lt;/a&gt;) has produced multiple versions of The WFE Thing.  The original was created by a lovely chap named Solm, in PHP, and it generally worked really well, until at some point it stopped working.  At that point, I decided that I could make my own one.  This was around the time that I had been making this blog, and what I really like about this blog is that it is entirely static, and yet the Javascript on it gives it a lovely dynamic feel.  So I wondered if I could make a WFE thing that was entirely static except for a javascript-based frontend.&lt;/p&gt;
&lt;p&gt;The basic idea was that if pages could be static files, so could too could the API a set of static .json files in an &lt;code&gt;api/&lt;/code&gt; directory somewhere.  There's a lot of merit to this idea in many respects.  If you use traditional server software such as &lt;a href="http://www.apache.org/"&gt;Apache&lt;/a&gt; or &lt;a href="http://wiki.nginx.org/Main"&gt;Nginx&lt;/a&gt;, you've already got a system that is extremely optimised for throwing files down the right tubes to make a website.  Things go quickly, but they also go efficiently, which, when you have a site with a lot of load, means things break a lot less.  Now I didn't expect to recieve a lot of load, but the idea of high speeds without much work appealed to my naive sensibilities, and so the second WFE thing was convieved.&lt;/p&gt;
&lt;p&gt;There are, however, a lot of reasons why one would use a database over keeping data in the filesystem.  The first of these is that a database usually has a very sensible and clever query language or API to go with it.  For example, when I obtain a new piece of data, I want to attach it to the correct file.  Because in my case the data doesn't change very often, I also don't want to repeat myself.  Specifically, if the new data is the same as the older piece of data, I want to save a "null row" into the system that identifies that this row is a duplicate of a previous row.  As a result, to decide if I want to save this particular piece of data, I can execute the following query:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;myfield&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;mytable&lt;/span&gt; &lt;span class="k"&gt;WHERE&lt;/span&gt;
    &lt;span class="n"&gt;dataname&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;lt;dataname&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;AND&lt;/span&gt;
    &lt;span class="nb"&gt;date&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;lt;inputdate&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;AND&lt;/span&gt;
    &lt;span class="n"&gt;myfield&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="nb"&gt;date&lt;/span&gt; &lt;span class="k"&gt;DESC&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Here, I specify the name, and (because I don't necessarily insert data in chronological order) that the in-table data must come from before a particular date.  I also specify that the &lt;code&gt;myfield&lt;/code&gt; field isn't null, because if it is null then I know that this was a duplicate of a previous row, so I'd need to continue searching anyway.  I can also add &lt;code&gt;LIMIT 1&lt;/code&gt;, which ensures that the database query stops as soon as it's found the relevant data.  Then I can test the value of &lt;code&gt;myfield&lt;/code&gt; against the data that I have just obtained, to decide if I need to add a new one.  It's simple, pretty quick (because almost all the logic is being performed by the highly-optimised database), and it works every time.&lt;/p&gt;
&lt;p&gt;On the other hand, in a filesystem database with .json files, I need to put a lot more logic into my application to deal with this kind of query.  Here's a basic implementation in Python that attempts to do roughly the same thing.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;items&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;load&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;lt;dataname&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;items&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;date&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;date&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;lt;inputdate&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;continue&lt;/span&gt; &lt;span class="c"&gt;# We&amp;#39;re only looking at rows before inputdate&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;datavalue&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;continue&lt;/span&gt; &lt;span class="c"&gt;# We don&amp;#39;t want null values&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;myfield&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c"&gt;# Assuming this is tucked into a function somehow&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This isn't very simple, and it does a lot of unnecessary work.  For a start, I need to access the entire file, even the parts of it that I have no interest in using.  For small files, this isn't much of an issue, but it's slow.  For larger files, there's a good chance that I'm looking at a tiny fraction of the actual file, which is just wasteful.  Thankfully Python's sort functions are apparently very efficient, and the &lt;code&gt;key&lt;/code&gt; argument makes sorting by a particular field very easy.  However, I can't add conditions into my sort or selection here, so once the files have been sorted I'll also need to filter out rows that don't match my date criteria, (and at Python-speeds rather than the optimised SQL-speeds).  It's only then that I can actually return the small piece of data that I was looking for.&lt;/p&gt;
&lt;p&gt;There are other problems with this, not least the fact that this particular piece of code relies on the JSON file being an array, rather than an object, which is actually a security risk in certain cases.  But the worst crime of all is that this snippet is so much longer than the other one to do exactly the same thing but slower.  Now of course this logic has been put into a function (hence the &lt;code&gt;return&lt;/code&gt; at the end), but if I'm writing worse code to do a worse job, something's going wrong.&lt;/p&gt;
&lt;p&gt;That's not the only difference between a file-system and a database.  For a start, if I'm using JSON, I need to store the name of each field, and I need to store it in every single file on the system.  On the other hand, in a traditional SQL database I store the name of each field once (we'll ignore special cases like MongoDB and other NoSQL systems for now), and each row just needs a basic separator.  I could shorten the names of the json fields, or even convert each row to an array, but then I'd need an encoding and decoding library on both sides of the app.  I also haven't begun to talk about locking and synchronisation issues.  In this case it probably isn't so bad, as there is only ever one person putting new data into the system at a time (that's me!).  As far as I can tell, the worst possible case is that in certain circumstances a user might get outdated data, which isn't a desperately troublesome issue for The WFE Thing.  Of course, in the general case, this may not be true at all, and if I'd gone much further, I'd probably end up missing the ACIDity of most SQL databases.&lt;/p&gt;
&lt;p&gt;Despite all this, I do feel the need to point out that I can still see the case for a static API in very specific circumstances.  It's definitely more work, but it may be worth it.  There are a lot of optimisations that a clever load script could make, including ensuring the data is always pre-sorted rather than sorting it on the fly.  Indeed, I've assumed that I should try to minimise the filesize in both cases, but if I knew I had the space, I could very easily save &lt;code&gt;myfield&lt;/code&gt; every single time, even if it was repeated data.  This is actually what I server to users, so that's another optimisation to make.&lt;/p&gt;
&lt;p&gt;Why, then, did I use a &lt;a href="http://www.sqlite.org/"&gt;SQLite&lt;/a&gt; database as my primary storage mechanism in the end?  Because I was performing premature optimisations.  You can read more about why premature optimisations are the root of all evil by searching "premature optimisation is the root of all evil" anywhere.  Even Bing would be able to return some good advice.  However, you probably won't recognise the truth of the problem until you've prematurely optimised yourself.  With that in mind, allow me to elucidate the situation where a static API might be useful.&lt;/p&gt;
&lt;p&gt;The site needs to have a lot of visitors.  A hell of a lot of visitors.  Facebook-level visitors.  Enough visitors that even on the most secure and stable of servers (hell, even using NodeJS' webscaleity) you're starting to be a bit worried.  You should also have a genuine worry about such things as DDoS attacks.  Your site also sends a lot of hits (hundreds, thousands) to the backend API with each request to the mainpage.  There's probably a lot of very rapid and heavy polling involved.  Your site is probably designed badly, but for some unknown reason you are unable to change that part of it.  Additionally (and this one is very important) only the backend triggers changes, and those changes occur infrequently.  We're also not talking about Big Data - there's not enough data that you're using several servers and need to worry about routing, and you also probably don't need to sort it in complex ways to understand the patterns within the data.&lt;/p&gt;
&lt;p&gt;If you do find yourself in this situation...  Get out of there as fast as you can.  Or you could try a static API.  If that &lt;em&gt;specific&lt;/em&gt; set of circumstances were to come about.&lt;/p&gt;
&lt;p&gt;I would like to finish with a quick story that I hope suggests that I've learned my lesson about premature optimisations, and might be of some interest to Python programmers.  The backend is now written in the beautiful (if somewhat overshadowed) &lt;a href="http://bottlepy.org/docs/dev/index.html#"&gt;Bottle&lt;/a&gt; microframework, which was great fun, especially as I got to use Python 3.4 (the best Python!).  Bottle makes deployment relatively easy, at is already has basic configurations for a number of Python WSGI servers.  (Think of Bottle as your PHP scripts, and the WSGI servers as your Apache setup - it's basically like that but completely different.)  Originally I was going to use the standard mod_wsgi setup on my webfaction server, but trying to set that up with the structure I currently had wasn't going very well, so I quickly Googled what the fastest WSGI server was.  (The answer, it turns out, is probably &lt;a href="https://github.com/jonashaag/bjoern"&gt;Bjoern&lt;/a&gt;.)  However, while looking for this, I found a few reports that suggested &lt;a href="http://meinheld.org/"&gt;Meinheld&lt;/a&gt; was quite good for combining speed with stability.  So, remembering my lesson about premature optimisation, I tested everything, quite thoroughly, against some of the slower servers.  Every server came out exactly the same.&lt;/p&gt;
&lt;p&gt;The reason is quite obvious: I didn't need any async fanciness, because I wasn't going to get enough requests to merit anything so complex.  The users of this app will almost all access it between 6:00am - 1:00pm, 6:00pm - 1:am GMT.  There will be about five unique users in total, making perhaps 30-40 requests over that seven hour period on the rare busy day.  That's pretty much the entire usage I'm expecting.  I don't need to optimise the speed of my server.  What I should, however, be optimising is how quickly I can make this site instead of leaving the users to struggle with my old broken attempts.  Additionally, I need to remember to optimise the usefulness of the UI.  Speed, for me, doesn't come into this, which means I have time to optimise the things that I forgot about last time in my quest for the fastest response.  Today I finally learned that premature optimisation is the root of all evil.  And more importantly, it makes things &lt;em&gt;hard&lt;/em&gt;.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jonathan Frere</dc:creator><pubDate>Wed, 16 Jul 2014 10:35:18 +0100</pubDate><guid>tag:www.johz.me,2014-07-16:posts/2014/Jul/16/i-made-a-thing-then-i-learned-some-more-things/</guid><category>coding</category><category>python</category><category>optimisation</category></item><item><title>An Update, A Forecast, and some Waffles</title><link>http://www.johz.me/posts/2014/Feb/05/an-update-a-forecast-and-some-waffles/</link><description>&lt;p&gt;I lied about the waffles.&lt;/p&gt;
&lt;p&gt;What you're actually going to get is me waffling on for a bit.  It's almost the same thing, except not as edible, not very tasty, and it can't be smothered in chocolate sauce.  Like I said, I completely lied about the waffles, I just couldn't come up with a snappy sounding title.&lt;/p&gt;
&lt;p&gt;So an update.  Update might be the wrong word, it's more a sort of reflective moody thing, where I pretend I've regressed five years and am living in a pokey black-painted bedroom with heavy metal posters on all the walls and a general feeling of internal self-loathing.  That's right, I'm taking a second adolescence, on the principle that it works for politicians and second homes.&lt;/p&gt;
&lt;p&gt;To talk about updates, I'd like to initially introduce my housemate, who we'll call Elgar because I really wish I knew someone who was called Elgar.  Despite being about as good at programming as I am at most athletics-based sports, he has this magic ability to come in and debug my code for me, often while scarcely understanding what it is that I'm trying to do.  I like to call this the "new eyes syndrome", because I'm in a pretentious mood.  To give you an example, I spent a good hour trying to work out a where a segfault was coming from in some C++ code, when he walked in, took one look at my code, and told me that I was using the wrong input file.  It's a very helpful skill to have around as a coder, because when you get onto a particular coding path, you tend to forget the other ways of solving the problem.  Or at least that's how it works for me.&lt;/p&gt;
&lt;p&gt;Anyway, earlier this afternoon, Elgar walked in and debugged my life, which was a slightly unsettling experience.  I can't quote you the exact words he said, because I have a memory like a sieve, but it was something along the lines of "Why aren't you coding anymore?"&lt;/p&gt;
&lt;p&gt;That's a very good question, Elgar.  Why am I not coding anymore?  Also, should "anymore" be "anymore", or "any more"?&lt;/p&gt;
&lt;p&gt;With respect to the former (the latter is as of yet unsolved, please send a postcard if you think you know the answer), I think it's because I've become a consumer, rather than a producer.  Most things operate on a simple principle: One person (or group of people) will produce, while other people (or person) will consume.  Take code.  I like to believe that most of my code is for an eventual consumer, who invevitable turns out to be either myself, or the hard drive as I forget all about the project and leave it rotting.  Or more generally, television is made by a producer (quite literally in this case, although a number of other people also take part in that role), and we as consumers consume it.&lt;/p&gt;
&lt;p&gt;Once upon a time, I think I had a good grasp of the two sides of the story.  I consumed a handful of television shows, YouTube channels, comical blogs, and the Grand World of IRC, and I also enjoyed a bit of flash gaming on the side.  Yet I also wrote code and blog posts, and I actively took part in NationStates, which could be considered producing activity, but I'm really just shoehorning it in there to make this rough, overextended analogy work.  On top of this, once upon a time, I actually did work.&lt;/p&gt;
&lt;p&gt;These days, I play Minecraft and watch videos.&lt;/p&gt;
&lt;p&gt;So what is this update?  Well, this update is to say that I've started to begin to recognise this, and I'd like to get back to actually doing some producing now.  It also leads directly into the forecast.&lt;/p&gt;
&lt;p&gt;First off in my grand forecast of things to come in the next few weeks/months/years/millenia, I need to poke around with my WFE archive system, which is a NationStates thing but may or may not have some quite cool stuff in it.  Secondly, as I said, I've been playing Minecraft, and the Exciting World of Modding has appeared before my eyes, and I am very tempted to start diving in, in no small part due to the fact that I really would like to get some java experience under my belt before I leave university, even if it is akin to drowning my eyeballs in vats of sulphur.  Thirdly, I want to blog more.  I was talking to someone on IRC about this recently, and it's a really fun and helpful thing to do.  It gets you used to writing large amounts of stuff consistently.  It gets you used to thinking about things properly.  Essentially, go and get a blog.  That will solve all the world's problems.&lt;/p&gt;
&lt;p&gt;I would like to briefly say something about my own circumstances.  Next week, if all goes to plan, I shall be donating my stem cells to someone with leukemia.  It's quite scary, but it's quite exciting.  I get to go down to London, which despite being a city-boy myself, is still extremely exciting.  It won't be terribly painful, as these days most people donate via PBSC, which is essentially a prolongued blood donation, but where you get the blood back at about the same rate that you donate it.  I'd like to encourage you, my dear reader (that's a very deliberate singular, there's definitely only one of you, hello Mum!) to think about joining the registry.  Eventually, I'll write up everything that happened to me, add a page on the blog, and offer round links to the bone marrow registry, but for now, here are two sites that you ought to explore:  &lt;a href="http://www.nhsbt.nhs.uk/bonemarrow/"&gt;The UK NHS site on bone marrow donation&lt;/a&gt;, and the &lt;a href="http://www.anthonynolan.org/"&gt;Anthony Nolan Foundation homepage&lt;/a&gt;, Anthony Nolan being the organisation that I'm donating with.  I'd really recommend checking those out, because it's one of those relatively small things you can do that will drastically improve - hell, let's be blunt, the word here is &lt;em&gt;save&lt;/em&gt; - someone's life.  Anyway, that's happening Monday 'til Wednesday, depending on how everything works out, so wish me luck, and/or pray for me.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jonathan Frere</dc:creator><pubDate>Wed, 05 Feb 2014 22:02:39 +0000</pubDate><guid>tag:www.johz.me,2014-02-05:posts/2014/Feb/05/an-update-a-forecast-and-some-waffles/</guid><category>meta</category><category>working</category></item><item><title>On Special Snowflakes and Rethinking Conclusions</title><link>http://www.johz.me/posts/2014/Jan/03/on-special-snowflakes-and-rethinking-conclusions/</link><description>&lt;p&gt;My brother is a Special Snowflake.&lt;/p&gt;
&lt;p&gt;Now before you complain (especially you, dear brother), please read this whole blog.  It may well get worse later on, but it will get better eventually.  Probably, at least.&lt;/p&gt;
&lt;p&gt;The thing is, my brother has dyslexia.  How does he spell?  He doesn't.  That joke's funnier if you imagine I'm telling the one about the dog with no nose, but unfortunately still not very funny at all.  As a family, we've been aware that he's had dyslexia for a while now, and he has recieved support for it in many of his exams, but recently he's had an official assessment (a few hundred pound's worth of it, no less) and has been been given the official designation "dyslexic".  My brother is officially a Special Snowflake.&lt;/p&gt;
&lt;p&gt;I honestly didn't realise I had a problem with this until I found myself listening to the story for the hundredth time.  My brother is not a fantastic story teller (although certainly better at it than I am - I continue to feel sorry for anyone who is forced out of courtesy to be entertained by the pair of us) and the story tends to go on for a bit, which allows me some alone time with my thoughts.  (At least when I'm not interupting him to destroy the story in my own special way.)  And I think I do have a problem here.&lt;/p&gt;
&lt;p&gt;The issue is fundamentally with me (of course), and it lies in the fact that I like conformity.  I'm not a fan of special snowflakes.  There are certain limitations on this.  I mean, when it comes to opinion, I firmly disagree with everything that anyone popular says by default, because I am a grumpy old (almost 20!) man.  However, in most other things, I am very keen on everyone staying the same.  I don't go around being special, why should you?&lt;/p&gt;
&lt;p&gt;And let's face it, this kind of thinking seems harmless.  Conforming to a societal norm is something that we as social animals are good at, and something that presumably aids our survival as a species, or at least did once upon a time.  It gives us those unwritten laws like "don't urinate in public" and "hitting people isn't nice, mkay?"  The advice that our urge for conformancy offers tends to be extremely helpful.&lt;/p&gt;
&lt;p&gt;Unfortunately, it isn't always quite as helpful as we want.  Right now I am doing something that I regularly enjoy doing, which is procrastinating.  This particular piece of procrastination is about an email I need to write to my university to inform them that I need to take a few days off.  Why is this so hard for me?  Because it feels like I'm singling myself out as someone requiring different treatment.  Essentially, I would be someone who doesn't conform to societal norms - or at least the societal norms that I see around me.&lt;/p&gt;
&lt;p&gt;I will resolve this issue momentarily - I really need to sort this email out tonight, and the threat of a deadline is a surefire way to motivate me - but it's still things like it that require a surprising amount of courage.  And this is simply to send an email the main point of which is to cover certain bases.&lt;/p&gt;
&lt;p&gt;To put this in perspective, let's examine my brother's case.  He had to speak to a member of staff at his college, face-to-face, and request a ~Â£300 exam.  Based on previous, more informal tests, he was well aware that the result of his talk would be something along the lines of permanent support throughout his education at the college.  As it turned out, he has a scribe who will take down notes for him, and write down his answers in exams.  Not only did he single himself out to the Powers That Be, but he also marked himself differently amongst his peers.  And my brother did this because he knew that if he worried more about fitting in with society's mould, he would be unable to do the course he wanted to do.&lt;/p&gt;
&lt;p&gt;Of course, when there are higher stakes, we take bigger risks, but I feel like it really puts me to shame.  I worry about being the odd one out.  I struggle in conversations with friends who don't know the finer points of the etiquette of discourse.  I am "all things to all men" simply to fit in and be like everyone else.&lt;/p&gt;
&lt;p&gt;You may notice that I've stayed away from some of the real battles against society's views, in the form of various civil rights campaigns that have taken place through the ages.  I certainly agree that we should be taking heart from the courage of those people, and I don't disagree that there are many issues that we need to face as a global society.  However, I'm not very good at being inspired by famous people, because I find it so easy to classify them as "superhumans", whose very feet I am not worthy to lick, if only because they'd probably have me arrested.  (Another societal norm you should be glad we have.)  My brother, on the other hand?  I can definitely assure you that he's not a superhuman, lovely though he may be, and that makes it a lot easier to learn from him when he does something awesome.&lt;/p&gt;
&lt;p&gt;I guess the upshot of this is that I'm very proud of him.  I'd tell him this, but he'd stare at me blankly before hitting me, or stealing my seat in the car, or some other expression of the mutual bond of fraternal love and friendship that we share.  So instead, you all get to read this, which I'm sure had opened up your eyes considerably, or your money back.  And hopefully I'll be a bit bolder when it comes to doing things that don't necessarily fit in with my societal norms.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jonathan Frere</dc:creator><pubDate>Fri, 03 Jan 2014 12:59:34 +0000</pubDate><guid>tag:www.johz.me,2014-01-03:posts/2014/Jan/03/on-special-snowflakes-and-rethinking-conclusions/</guid></item><item><title>On Doctor Who and Cosmic Harmony</title><link>http://www.johz.me/posts/2013/Nov/25/on-doctor-who-and-cosmic-harmony/</link><description>&lt;p&gt;Doctor Who is 50 years old as of two days ago, and the celebrations have been going strong.  From documentaries on the life of the First Doctor, William Hartnell, to guest lectures on time travelling science by Brian Cox, and of course the grand event, the 50th Anniversary Special Episode.  All very exciting, really.&lt;/p&gt;
&lt;p&gt;And, as with any big celebration, it is natural for people to be rather profuse in their congratulations of the show.  As a vast array of celebrities from the most minor to the most major, including a worrying number of teen boy bands, queued up to express admiration for Matt Smith's hair, it was perhaps expected that some people would push the boundaries of tripe to truly unimaginable levels.&lt;/p&gt;
&lt;p&gt;As a fairly committed fan of Doctor Who, and a much, much more committed fan of my own voice, I thought I should take a quick look at some of this tripe.  After all, a lot of it was spouted by Americans, who just don't understand the British way of absolute stoicism in the face of all emotion.  When discussing such British classics as Doctor Who, any sense of feeling or passion should have been drained away a long time ago.  Really, the amount of meaning in many comments on the show would disappointment to my eyes, if disappointment were not too emotive a feeling to actually feel.&lt;/p&gt;
&lt;p&gt;However, in my attempt to overanalyse these overanalyses, I realised something worryingly deep and meaningful about myself.  Well, I didn't, I just say that.  But I did realise that Doctor Who is a damn good television show.  Sure there's some stuff that's really rather over the top.  I direct this particularly at the 12-year-old American featured on the Doctor Who Afterparty who was about to get married.  His comments were really worryingly over the top.  Ultimately, though, I think we can all forgive those who get slightly carried away.  It is after all a relatively auspicious occasion: only a month and two days until Christmas.&lt;/p&gt;
&lt;p&gt;So I'm going to ignore these transgressions, and merely present to you a proper, emotionless congratulation of this long-running show:&lt;/p&gt;
&lt;p&gt;Eh, it's done quite well to get this far.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jonathan Frere</dc:creator><pubDate>Mon, 25 Nov 2013 11:01:51 +0000</pubDate><guid>tag:www.johz.me,2013-11-25:posts/2013/Nov/25/on-doctor-who-and-cosmic-harmony/</guid><category>humour</category><category>doctor who</category></item><item><title>Building a Pure-Javascript Theme Switcher</title><link>http://www.johz.me/posts/2013/Nov/11/building-a-pure-javascript-theme-switcher/</link><description>&lt;p&gt;You might have noticed that you can change the theme of my blog.  I'm quite sure I've told you before that you can do this, but I'm going to tell you again, because I'm really proud of working out how to add this functionality, especially making it either work or fail gracefully on pretty much all browsers, and making it persist across sessions.  The exciting part for me is that this is entirely client-side, so it works on a static blog or website, which mine is.  I recognise that it's simple, easy, and my pride is entirely unwarranted, but dammit it makes me feel good.&lt;/p&gt;
&lt;p&gt;I've spent today rewriting the code that does this to make it prettier, and more reusable.  For example, if you click on &lt;a href="javascript:void(0)" onclick="themeSwitcher.setStyle(-1);"&gt;this link&lt;/a&gt;, the entire theme will change to a different one.  It's also much easier to add new themes now, as there's only one place that they're specified.&lt;/p&gt;
&lt;p&gt;So how does this all work?  Well, assuming you've already got a document and a couple of stylesheets that you want to switch between, we'll start by defining a themeSwitcher object.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themeSwitcher&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;defaultTheme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;})([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet2.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Here, we're simply creating a single object with an anonymous constructor function.  The constructor takes two arguments, the list of themes, and the default theme.  We store the list of themes directly, but instead of storing the defaultTheme as is (in a string format) we store it internally as an index.  We also need to set the currentTheme, which of course is the default theme by default.&lt;/p&gt;
&lt;p&gt;Next we need to find out if there are any stylesheets already saved.  For this we need some sort of peristent storage.  I used localStorage, but there are other storage alternatives out there.  The other big contender that you might think about using is cookie storage.  There are three big differences between the two of these, for our uses at least.&lt;/p&gt;
&lt;p&gt;Firstly, cookies are a pain to handle, whereas working with localStorage is a dream.  For me, this was the biggest reason for turning to localStorage.  Secondly, localStorage isn't entirely cross-browser.  While localStorage is available for about &lt;a href="http://caniuse.com/#feat=namevalue-storage" title="Can I Use: name-value Storage"&gt;90%&lt;/a&gt; of your users, if you think you're going to get a lot of traffic from older browsers that might be a consideration for you.  Thirdly, cookies are sent to the server.  This particular theme switcher is entirely client-side, so that's not necessary, but if you wanted to add some sort of server-side code that deals with the theme, you might want to think about using cookies.&lt;/p&gt;
&lt;p&gt;However, for me localStorage seemed to be the best answer.  Of course, if we're using localStorage, we're going to need to ensure that localStorage exists.  If you've already got &lt;a href="http://modernizr.com/" title="Modernizr - Feature detection"&gt;Modernizr&lt;/a&gt; installed, you should use that.  However, I didn't, and I didn't want to include a whole new library just to find out if I could use one feature, so I &lt;a href="https://github.com/Modernizr/Modernizr/blob/master/feature-detects/storage/localstorage.js" title="The localStorage test in Modernizr's source"&gt;used the source&lt;/a&gt;, and borrowed the test that Modernizr used.  This is what it looks like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themeSwitcher&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;lsExists&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// Assume that localStorage doesn&amp;#39;t&lt;/span&gt;
                         &lt;span class="c1"&gt;// work until proven otherwise&lt;/span&gt;

  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;defaultTheme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// Do a test&lt;/span&gt;
    &lt;span class="nx"&gt;localStorage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;localStorage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;removeItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;lsExists&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// Test failed&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;lsExists&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;})([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet2.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Beautiful.&lt;/p&gt;
&lt;p&gt;Now if localStorage exists, that still doesn't mean that there's anything saved there.  The stuff that's saved there could also be complete gobbledygook.  If you can, have a look at what localStorage saves on this site.  (On Chrome, press Ctrl-Shift-i, go to "Resources", and "Local Storage".)  Edit it to something that isn't "dark" or "lite", reload the page, and you'll see that the site automatically uses the "dark" theme.  That's because the alternative would be to load no stylesheet at all, and I really don't want that to happen.&lt;/p&gt;
&lt;p&gt;To check if the value saved is an acceptable value, the easiest thing we can do is find out if it's in the array of themes that was passed into the constructor.  The best way to do this is &lt;code&gt;Array.prototype.indexOf&lt;/code&gt;, which works on most browsers, but not all.  Unfortunately, there are browsers that implement localStorage and not indexOf, so we need to write our own indexOf function for those cases.  I based mine on the &lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf#Compatibility" title="Array.prototype - Mozilla docs"&gt;Mozilla sample implementation&lt;/a&gt;, minified it because it was useless and ugly, and added it to the top of the script.  Note that this implementation doesn't modify the Array prototype.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themeSwitcher&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nx"&gt;indexOf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;n&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;Array&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;prototype&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;Array&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;prototype&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nb"&gt;Array&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;prototype&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;call&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="nx"&gt;arguments&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))}&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;r&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;n&lt;/span&gt;&lt;span class="o"&gt;?&lt;/span&gt;&lt;span class="nx"&gt;n&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="o"&gt;===&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;Math&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;r&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="nx"&gt;r&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="nx"&gt;r&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;r&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="nx"&gt;t&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;r&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;lsExists&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;defaultTheme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;localStorage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;localStorage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;removeItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;lsExists&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;// Get the theme stylesheet, and check that it exists&lt;/span&gt;
    &lt;span class="nx"&gt;stylesheet&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;localStorage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;theme-stylesheet&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;stylesheet&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;// Note shim!&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;lsExists&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;})([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet2.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So now themeSwitcher is an object that contains a list of all possible themes, the current theme, the default theme, and a flag that tells us if localStorage exists or not.  That's all very useful, but none of it actually changes the theme.  Indeed, we haven't even installed a theme on the page.  This theme switching system still requires a bit of work.&lt;/p&gt;
&lt;p&gt;Firstly, let's add a function that writes the current theme to the document.  There are multiple ways of doing this, and some are more idiomatic and beautiful than others, but since all we're actually doing is writing a single line of HTML, I've opted for &lt;code&gt;document.write&lt;/code&gt;.  Sure, you should probably build an element, and append it somewhere to the DOM, but I'm lazy, and that feels like way too many lines of code.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themeSwitcher&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="cm"&gt;/*&lt;/span&gt;
&lt;span class="cm"&gt;  indexOf function&lt;/span&gt;
&lt;span class="cm"&gt;    ...&lt;/span&gt;
&lt;span class="cm"&gt;  constructor statements &amp;amp; test for localStorage&lt;/span&gt;
&lt;span class="cm"&gt;  */&lt;/span&gt;

  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;writeStyle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// remember that currentTheme is an index, not a theme name&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;styleName&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
    &lt;span class="c1"&gt;// Modify the html here as you please.&lt;/span&gt;
    &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;lt;link id=&amp;quot;main-theme&amp;quot; href=&amp;quot;/static/css/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;styleName&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.css&amp;quot; rel=&amp;quot;stylesheet&amp;quot; /&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;})([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet2.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;I'm creating a function to do this, because that's the way that feels most idiomatic to me.  (This is probably ironic, considering the previous paragraph.)  You could just do the &lt;code&gt;document.write&lt;/code&gt; as a statement within the constructor, but this means that later you'll have less control over when and where you place the link.&lt;/p&gt;
&lt;p&gt;The other thing that we need is a way to change the themes once the document is loaded.  After all, expecting the user to reload the page every time they change the theme is a bit much to ask, don't you think?  The way I chose to do this was by writing two private &lt;code&gt;_setStyle&lt;/code&gt; function, and then defining one of them based on whether localStorage existed.  You could use an if-statement, and test on the &lt;code&gt;lsExists&lt;/code&gt; attribute, but why bother when the try/catch statement already divides flow into two sections for you to use?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themeSwitcher&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="cm"&gt;/*&lt;/span&gt;
&lt;span class="cm"&gt;  indexOf function&lt;/span&gt;
&lt;span class="cm"&gt;    ...&lt;/span&gt;
&lt;span class="cm"&gt;  constructor statements&lt;/span&gt;
&lt;span class="cm"&gt;  */&lt;/span&gt;

  &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="cm"&gt;/* get theme stylesheet */&lt;/span&gt;

    &lt;span class="c1"&gt;// _setStyle if localStorage exists&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_setStyle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="c1"&gt;// check that the theme really does exist&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;styleName&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;styleName&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
        &lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;

      &lt;span class="c1"&gt;// Get the URL of the link, and change it to the URL&lt;/span&gt;
      &lt;span class="c1"&gt;// of the new link.  This assumes that all the css&lt;/span&gt;
      &lt;span class="c1"&gt;// sheets are sitting in the same directory.  It also&lt;/span&gt;
      &lt;span class="c1"&gt;// assumes that only one css sheet is needed to define&lt;/span&gt;
      &lt;span class="c1"&gt;// a theme.  You can modify this if that isn&amp;#39;t the case.&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;link&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;main-theme&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;splits&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;link&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;href&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="nx"&gt;splits&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;splits&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;styleName&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="nx"&gt;link&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;href&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;splits&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

      &lt;span class="c1"&gt;// Make sure we save the new theme name so that&lt;/span&gt;
      &lt;span class="c1"&gt;// the choice persists across sessions.&lt;/span&gt;
      &lt;span class="nx"&gt;localStorage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;pillbox-theme&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;styleName&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;lsExists&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;// _setStyle if localStorage does not exists&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_setStyle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="c1"&gt;// the style will always be the current theme,&lt;/span&gt;
      &lt;span class="c1"&gt;// which will always be the default theme.&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;styleName&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

      &lt;span class="c1"&gt;// Still write the new theme into the document,&lt;/span&gt;
      &lt;span class="c1"&gt;// just in case something has gone horribly wrong.&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;link&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;main-theme&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;splits&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;link&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;href&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="nx"&gt;splits&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;splits&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;styleName&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="nx"&gt;link&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;href&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;splits&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;


  &lt;span class="cm"&gt;/* writeStyle function */&lt;/span&gt;
&lt;span class="p"&gt;})([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet2.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;You can now start playing with things in your browser.  Assuming you've got all your stylesheets in the right place, and a basic HTML layout, insert this code at the top of the &lt;code&gt;&amp;lt;head&amp;gt;&lt;/code&gt; brackets.  Then open up a development console and start calling &lt;code&gt;themeSwitcher._setStyle&lt;/code&gt; with various values.  Notice that you can only use indices to specify which theme you want.  Let's change that.  When we make our public setStyle function, we want to also be able to specify the string name of the css file.  I also want there to be a way to call it without specifying the theme, and let it toggle between themes.&lt;/p&gt;
&lt;p&gt;To do this, we're going to need an algorithm that can take a string, integer, or null input, and return the index of the theme that best matches the description.  Now that sounds like a fairly useful algorithm to use, so in the interests of DRY, let's implement it as a new function, &lt;code&gt;themeSwitcher.getStyle&lt;/code&gt;, then add &lt;code&gt;themeSwitcher.setStyle&lt;/code&gt; on top of it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themeSwitcher&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="cm"&gt;/*&lt;/span&gt;
&lt;span class="cm"&gt;  indexOf function&lt;/span&gt;
&lt;span class="cm"&gt;    ...&lt;/span&gt;
&lt;span class="cm"&gt;  constructor statements&lt;/span&gt;
&lt;span class="cm"&gt;  */&lt;/span&gt;

  &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="cm"&gt;/* localStorage exists _setStyle implementation */&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="cm"&gt;/* localStorage doesn&amp;#39;t exist _setStyle implementation */&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="cm"&gt;/* writeStyle function */&lt;/span&gt;

  &lt;span class="c1"&gt;// public getStyle method&lt;/span&gt;
  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getStyle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;stylesheet&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// Firstly, check if stylesheet is undefined or null.&lt;/span&gt;
    &lt;span class="c1"&gt;// In this case we&amp;#39;ll return the current theme.&lt;/span&gt;
    &lt;span class="c1"&gt;// This allows us to use themeSwitcher.themes[themeSwitcher.getStyle()]&lt;/span&gt;
    &lt;span class="c1"&gt;// to find out the current theme.&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;typeof&lt;/span&gt; &lt;span class="nx"&gt;stylesheet&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;undefined&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="nx"&gt;stylesheet&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="c1"&gt;// Next, stylesheet could be an index.  Return either the index,&lt;/span&gt;
    &lt;span class="c1"&gt;// or if index is invalid, the current theme.&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;typeof&lt;/span&gt; &lt;span class="nx"&gt;stylesheet&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;number&amp;quot;&lt;/span&gt;
               &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;   &lt;span class="nx"&gt;stylesheet&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="nb"&gt;Math&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;floor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;stylesheet&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;stylesheet&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nx"&gt;stylesheet&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;stylesheet&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="c1"&gt;// Otherwise, assume stylesheet is the name of a style.&lt;/span&gt;
    &lt;span class="c1"&gt;// If it isn&amp;#39;t, then it won&amp;#39;t be in the list of themes,&lt;/span&gt;
    &lt;span class="c1"&gt;// so just return the current theme.&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;stylesheet&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;index&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="c1"&gt;// public setStyle method&lt;/span&gt;
  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setStyle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;stylesheet&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// get the style index using getStyle&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getStyle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;stylesheet&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="c1"&gt;// if the stylesheet is the same as the current&lt;/span&gt;
    &lt;span class="c1"&gt;// stylesheet, toggle the stylesheet to the next one&lt;/span&gt;
    &lt;span class="c1"&gt;// in the list of themes.&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="c1"&gt;// Use whichever private _setStyle function was defined&lt;/span&gt;
    &lt;span class="c1"&gt;// to set the style of the page.&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_setStyle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;})([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet2.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The main theme switching mechanism is now pretty much almost done.  Unfortunately, unless the user plays around with their development console, they're not going to be able to change much.  This is where we need to add an element on the page that actually allows the user interface to work.  I've implemented this here in the form of a &lt;code&gt;select&lt;/code&gt; drop-down choice form element, but of course you can edit and play with this code as much as you want.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themeSwitcher&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="cm"&gt;/* initialisation, writeStyle, getStyle and setStyle definitions */&lt;/span&gt;

  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;addSwitcher&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;elementID&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// Append our switcher to #elementID&lt;/span&gt;
    &lt;span class="nx"&gt;elem&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;elementID&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="c1"&gt;// We&amp;#39;re using a select element&lt;/span&gt;
    &lt;span class="nx"&gt;switcher&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;createElement&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;select&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;switcher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;theme-switcher-select&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;// Iterate through the themes, and append them as options&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;theme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
      &lt;span class="nx"&gt;option&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;createElement&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;option&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="nx"&gt;option&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;theme&lt;/span&gt;
      &lt;span class="nx"&gt;option&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;appendChild&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;createTextNode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

      &lt;span class="c1"&gt;// The current theme should be selected&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;option&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;selected&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
      &lt;span class="nx"&gt;switcher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;appendChild&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;option&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;};&lt;/span&gt;

    &lt;span class="c1"&gt;// When a new option is selected, call our setStyle function&lt;/span&gt;
    &lt;span class="nx"&gt;switcher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onchange&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;theme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;options&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;selectedIndex&lt;/span&gt;&lt;span class="p"&gt;].&lt;/span&gt;&lt;span class="nx"&gt;value&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setStyle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="c1"&gt;// Append to the document&lt;/span&gt;
    &lt;span class="nx"&gt;elem&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;appendChild&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;switcher&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;})([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet2.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And voila, a complete client-side theme switching solution.  How do you use this?  Well, the above definition should go in your &lt;code&gt;&amp;lt;head&amp;gt;&lt;/code&gt; section in a &lt;code&gt;&amp;lt;script&amp;gt;&lt;/code&gt; tag.  Then, immediately afterwards, you should call &lt;code&gt;themeSwitcher.writeStyle()&lt;/code&gt;.  Now the rest of your page can load, with the correct stylesheet enabled.  In the place where you want the theme-switching interface, create a container element with an id, then immediately below that, in script tags, call &lt;code&gt;themeSwitcher.addSwitcher(elementID)&lt;/code&gt;, where elementID is of course the id of the container element.  Check out the source code of this page to see it in action.  I've minified the function definition, but it works exactly the same.&lt;/p&gt;
&lt;p&gt;Here's the complete listing.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themeSwitcher&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nx"&gt;indexOf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;n&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;Array&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;prototype&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;Array&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;prototype&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nb"&gt;Array&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;prototype&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;call&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;arguments&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))}&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;r&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;n&lt;/span&gt;&lt;span class="o"&gt;?&lt;/span&gt;&lt;span class="nx"&gt;n&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="o"&gt;===&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;Math&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;r&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="nx"&gt;r&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="nx"&gt;r&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;r&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="nx"&gt;t&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;r&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;lsExists&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;defaultTheme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;localStorage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;localStorage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;removeItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;lsExists&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="nx"&gt;stylesheet&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;localStorage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;theme-stylesheet&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;stylesheet&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;defaultTheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_setStyle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;styleName&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;styleName&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
        &lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;

      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;link&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;main-theme&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;splits&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;link&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;href&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="nx"&gt;splits&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;splits&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;styleName&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="nx"&gt;link&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;href&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;splits&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

      &lt;span class="nx"&gt;localStorage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;pillbox-theme&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;styleName&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;lsExists&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_setStyle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;styleName&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;link&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;main-theme&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;splits&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;link&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;href&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="nx"&gt;splits&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;splits&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;styleName&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="nx"&gt;link&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;href&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;splits&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;writeStyle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;styleName&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
    &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;lt;link id=&amp;quot;main-theme&amp;quot; href=&amp;quot;/static/css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;styleName&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.css&amp;quot; rel=&amp;quot;stylesheet&amp;quot; /&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getStyle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;stylesheet&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;stylesheet&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="k"&gt;typeof&lt;/span&gt; &lt;span class="nx"&gt;stylesheet&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;undefined&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;typeof&lt;/span&gt; &lt;span class="nx"&gt;stylesheet&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;number&amp;quot;&lt;/span&gt;
                 &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;   &lt;span class="nx"&gt;stylesheet&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="nb"&gt;Math&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;floor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;stylesheet&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;stylesheet&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nx"&gt;stylesheet&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;stylesheet&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;stylesheet&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setStyle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;stylesheet&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getStyle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;stylesheet&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_setStyle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;addSwitcher&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;elementID&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;elem&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;elementID&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;switcher&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;createElement&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;select&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;switcher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;theme-switcher-select&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;theme&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;themes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
      &lt;span class="nx"&gt;option&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;createElement&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;option&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="nx"&gt;option&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;theme&lt;/span&gt;
      &lt;span class="nx"&gt;option&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;appendChild&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;createTextNode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;currentTheme&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;option&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;selected&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
      &lt;span class="nx"&gt;switcher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;appendChild&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;option&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;};&lt;/span&gt;
    &lt;span class="nx"&gt;switcher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onchange&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;e&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;options&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;selectedIndex&lt;/span&gt;&lt;span class="p"&gt;].&lt;/span&gt;&lt;span class="nx"&gt;value&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="nx"&gt;themeSwitcher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setStyle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="nx"&gt;elem&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;appendChild&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;switcher&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="p"&gt;})([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet2.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stylesheet1.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jonathan Frere</dc:creator><pubDate>Mon, 11 Nov 2013 18:16:29 +0000</pubDate><guid>tag:www.johz.me,2013-11-11:posts/2013/Nov/11/building-a-pure-javascript-theme-switcher/</guid><category>coding</category><category>javascript</category></item><item><title>Old News</title><link>http://www.johz.me/posts/2013/Nov/02/old-news/</link><description>&lt;p&gt;It has come to my attention recently that I am very much out of the loop when it comes to the news.  As someone who used to obsessively spend their lunch hour shouting excitedly about the latest national policies at anyone who would listen, and a number of people who really wished they didn't have to listen, this is all a bit weird, and I'm honestly slightly worried about it.  Even the things that should excite me beyond words have failed to catch my interest recently.  I'm vaguely aware of nuclear power coming back to the UK.  There's something weird happening to GCSEs.  I can feel some remnants of old enthusiasm stirring up in me, but if I'm honest it's not stirring up very far.&lt;/p&gt;
&lt;p&gt;So, to rectify this, I have decided to run my expert eye over some of the recent news, and really find out what's happening.  And, because my entirely uninformed commentary will almost certainly be amazingly insightful, I thought I probably ought to share it with you, because that's what good friends and narcissistic bloggers do.&lt;/p&gt;
&lt;p&gt;I started this post thinking that the &lt;a href="http://www.bbc.co.uk/news/world-us-canada-24773025"&gt;LA airport shooting&lt;/a&gt; would be the biggest piece of news for today, but on the BBC it's been relegated to first primary article in the "and in other news" section, with a bit of footage making the "Watch/Listen" section, so apparently that's not all that interesting.  After all, only one person died, and they've already caught the killer, so is it much more than just another "Only in America" story?  I mean, I could go on a bit of a rant about how terrible the gun culture is in America, but a foreigner can't tell Americans how to live their lives, even if they are living them wrong, so I guess we'll just skip this altogether.&lt;/p&gt;
&lt;p&gt;In fact, the BBC's top story is that &lt;a href="http://www.bbc.co.uk/news/world-asia-24776363"&gt;Hakimullah Mehsud has been killed by a drone&lt;/a&gt;.  That name doesn't actually ring any bells, but I will assume this is because of how out of the loop I am.  This is somewhat of an important development, as this man is apparently leader of the Pakistani Taliban, and the power vacuum may lead to the rise of a leader who will more readily submit to negotiations.  I seem to remember that my old, news-reading self would have seen this as another sign that the war on organised terror is over, and that we now need to turn to our own homes to sort out the problems of hate-crime and racial tension, rather than continually blame an "enemy out there".  Unfortunately, my new self feels rather apathetic to this sort of stuff.  After all, this is a war that America is fighting, not the UK.  And it's happening in Pakistan, which also isn't the UK.  And this "Taliban" place doesn't sound like it's in the UK either, so why are we so excited about it?&lt;/p&gt;
&lt;p&gt;The second story is about a &lt;a href="http://www.bbc.co.uk/news/uk-24779908"&gt;Mr Paul Gambaccini&lt;/a&gt;, and how he's clearly an evil paedophile like that nasty Saville bloke, and Rolf Harris, and probably Bruce Forsyth, I mean, just look at him, he must be in on it, right?  Now I recognise the name, but I'm not entirely sure where from.  I've googled for pictures of him, and the face isn't ringing any bells, although there are lots of pictures of Jimmy Saville there, proving that he must be a paedophile.  I'm guessing it's from listening to Radio Four, which is something I'm not supposed to admit to doing, but used to quite enjoy anyway.&lt;/p&gt;
&lt;p&gt;To be honest, every time this Operation Yewtree thing comes around, I feel less inclined to be outraged.  It's quite clear that there was a culture at the time in certain organisations that just ignored sexual harassment as a thing.  It's great that we're finally getting the perpetrators of these crimes to own up to the things they've done, but, apart from simply providing justice to those that deserve it, the ultimate question it raises is whether that sort of thing could happen again.  Is today's lad culture really that far removed from Saville's big-shot world, where fame and a cocky attitude could get you out of almost anything?&lt;/p&gt;
&lt;p&gt;It's at this point that I turn to the more important news stories, those contained within the science/technology/environment sections, and it turns out the news is actually genuinely exciting.  Not just one, but &lt;em&gt;two&lt;/em&gt; fusion stories!  Firstly, America's National Ignition Facility (NIF) has &lt;a href="http://www.bbc.co.uk/news/science-environment-24429621"&gt;done the impossible&lt;/a&gt;, and got more energy out of a fusion event than it has put in, for a given value of putting energy in.  NIF have been attempting to do fusion by shining lasers at pellets of hydrogen, and waiting for them to explode.  Now, or at least in late September, they've finally managed to get more energy out of the pellet than they've put into the pellet, although due to inefficiencies everywhere, this doesn't account for the energy they put into the laser.  So we're not quite there yet, but we might be in 20-30 years' time.  Maybe.&lt;/p&gt;
&lt;p&gt;The second fusion story is of course the more important one, because it involves the One True Path to fusion, the "tokamak" reactor.  Now I'm quite biased in this area, having grown up not too far from the current European experiment, known as JET.  However, as I've already described the American attempt in a pithy and unscientific manner, I feel I should do the same for tokamaks.  Essentially, the idea is to get a load of very hot hydrogen, and spin it in a circle until it does something exciting.  So what have these people been doing that's so newsworthy?  Well, they've finally got round to &lt;a href="http://www.bbc.co.uk/news/science-environment-23408073"&gt;receiving the inital components with which they can build the new ITER reactor&lt;/a&gt;.  Yes, that's right, the Europeans are almost about to start building a the outline of a new reactor, maybe.&lt;/p&gt;
&lt;p&gt;Fusion is really cool.  Well, it isn't, it requires ridiculously high temperatures and pressures, but you know what I mean.  The problem is that fusion just isn't happening any time soon.  It will work, eventually, it's just that realistically scientists aren't in a position to promise anything at any sensible timescale, so they make overconfident claims, and the phrase "twenty years" becomes synonymous with "never".  However, we really need to keep on pushing for it, because it's awesome.&lt;/p&gt;
&lt;p&gt;And finally, we come to a lovely local news story that not only includes a baby and an animal, but also manages to make you disgusted with your neighbours, and utterly amazed at the goodness of humanity.  Yes, that's right, &lt;a href="http://www.bbc.co.uk/news/uk-england-birmingham-24770596"&gt;an abandoned baby has been named after the dog owned by the walker who found her&lt;/a&gt;.  Doesn't the story feels so...  &lt;em&gt;local&lt;/em&gt;?  It's the way that a single sentence can neatly sum up almost every facet of this simple and easy-to-digest piece of news.  It's the way that this doesn't actually affect your life, or the life of the country in any significant way, but manages to brighten your day, and make you reflect on all the horrible things in the world at the same time.  It's the way there's interviews with people whose only relevant job description is "dog walker".  It's the sort of thing local news was made for.&lt;/p&gt;
&lt;p&gt;So thank you, reader, for allowing me to take this journey through the world's current state of affairs.  I've almost enjoyed it, actually.  It's nice to once again be able to pass comment in a sarcastic way, get excited about small things that don't massively make a difference to my life, and generally attempt to appear knowledgeable despite my utter absence of authority on the subject.  In fact, I might think about following the news slightly more now.  In fact, I might even shout angrily at you about it, if you'll be so kind as to let me...&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jonathan Frere</dc:creator><pubDate>Sat, 02 Nov 2013 13:32:03 +0000</pubDate><guid>tag:www.johz.me,2013-11-02:posts/2013/Nov/02/old-news/</guid><category>news</category></item><item><title>A Splash of Colour</title><link>http://www.johz.me/posts/2013/Oct/20/a-splash-of-colour/</link><description>&lt;p&gt;The aim is that this will be my last post about my blog for a while, but I just wanted to point out some of the interesting features, because I think that's what one does on technology-related blogs, and really I just want to fit in an be like the other cool guys.  Dammit, I'm a terrible person.&lt;/p&gt;
&lt;p&gt;As mentioned before, this is a &lt;a href="http://blog.getpelican.com/"&gt;Pelican&lt;/a&gt; blog.  Excuse the mild ideosyncracies of the documentation (particularly that if you click on a link, you will &lt;em&gt;never&lt;/em&gt; be able to get back to the main page), it's actually quite a nice system.  Pelican is a static-site generator, in the style of all the other static-site generators that I'm sure we could name between us, but with a few nice touches of it's own.  For example, unlike Jekyll and associated software, it only requires a directory of posts and pages, as opposed to a directory containing all the parts of a blog.  It's relatively well supported, particularly among the French-speaking community.  It's also written in Python, which, as a Pythonista first and foremost, means I can read the code and actually understand most of what it's doing.&lt;/p&gt;
&lt;p&gt;Secondly, you'll notice the theme.  The theme is custom-built.  This is amazing.  My knowledge of CSS is approximately equal to my knowledge on the dietary habits of pregnant sperm whales.  Seriously, any good impressions you have of the styling of this site are more an indication of the power and ease-of-use of &lt;a href="http://lesscss.org/"&gt;less&lt;/a&gt; than my own ability.  Some interesting and exciting things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;You can change the colour-scheme!  I know a number of people who have really strong preferences over light vs dark, so if you scroll to the bottom, you'll find a switcher that allows you to switch between light and dark.  Everything is entirely client-side, and the preference is saved in localStorage so your theme-choice will persist between sessions.  If you don't have either localStorage, or javascript in general, the page will load the dark theme by default, because dark is clearly the cooler choice.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The theme includes a random quote of the page load.  This is the second 'bubble' that appears on the main page.  The quotes are taken from the RANDOMQUOTES pelican option, and then every time the page loads, a javascript function writes out a div containing a random quote.  Obviously, if there is no javascript, the div never gets written at all, and so the page still runs beautifully.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The theme is largely XKCD/1271 compliant.  For those that don't obsessively follow the famous webcomic, &lt;a href="http://xkcd.com/1271"&gt;comic #1271&lt;/a&gt; recently described the habit of highlighting text while browsing websites, and then feeling good when the highlighted text makes a beautiful shape.  As someone who suffers from a similar compulsion (for reference, I consider option 4 of Randall's list to be the only viable option) I spent last night redesigning parts of the article layout so that when one highlights text in Chrome, there are no longer any horrible overhangs.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There are still a few things that I haven't quite sorted, that I still need to work on.  I've only really been concentrating on the index template and the pages template, so it might be that other pages look slightly more broken.  When I get comments, you can tell me about those pages.  Although first I really need to get a comments system in place.&lt;/p&gt;
&lt;p&gt;The theme is open source, obviously, and is available &lt;a href="https://github.com/MrJohz/pillbox-theme"&gt;on GitHub&lt;/a&gt; as the Pillbox theme.  Feel free to fork away.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jonathan Frere</dc:creator><pubDate>Sun, 20 Oct 2013 13:12:44 +0000</pubDate><guid>tag:www.johz.me,2013-10-20:posts/2013/Oct/20/a-splash-of-colour/</guid><category>meta</category></item><item><title>The Truth of the Matter</title><link>http://www.johz.me/posts/2013/Oct/18/the-truth-of-the-matter/</link><description>&lt;p&gt;You may have noticed something about my blog over the past few days, and that is that I have been lying.  Lying over the internet is truly one of the most heinous of crimes, and yet it has been committed right in front of your eyes.  And now I can only do the rightful thing and admit to the hideous falsity that I have constructed.&lt;/p&gt;
&lt;p&gt;This site was not built with Octopress.&lt;/p&gt;
&lt;p&gt;I can imagine your shock, but I hope you will at least grant me time to explain myself.  When I started putting together my new, exciting blog, I had originally planned for it to be a Wordpress blog.  I'd find some nice plugins, get myself a nice theme, and, hey presto, a beautiful, dynamic blog that would not only be simple to browse, but easy to edit and modify.  But then I actually got Wordpress, and somehow it didn't feel right.  There wasn't a nice syntax highlighting module, and the markdown abilities weren't the impressive beasts that I have become accustomed to.  Additionally, it just lacked the customisability I wanted.  I guess if I knew PHP I'd be able to play a lot more with it, but in the end, I said no to Wordpress.&lt;/p&gt;
&lt;p&gt;Of course, this lead me on a search through the wilderness to find Octopress, that bastion of cool, Ruby-esque hip-ness.  I got on relatively well with Octopress, despite the fact that it didn't get on very well with me.  In the end, however, I was driven away by the fact that my posts were in some oddly-named folder hidden in a directory that I didn't know or care about.  The tribulations of making an Octopress post eventually outweighed the power and cool nature of Octopress.  This, however, was the point that I left you at, the point at which I left you with the now-erroneous impression that I use Octopress.&lt;/p&gt;
&lt;p&gt;What do I use now, then?  Well, I wanted something written in a language I could understand.  Ruby was good, but Python was better.  I liked the idea of a static blog, but I didn't want to hunt down posts in odd folders, I wanted it to all look fairly obvious.  I wanted something that was simple enough that all I needed was a simple script to build, test, serve, and upload to my server, yet actually quite powerful underneath.  Thus, this blog is now hosted with &lt;a href="http://getpelican.com/"&gt;Pelican&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Pelican is quite cool.  It does most of the things that Jekyll/Octopress do, but with a very heavy emphasis on "articles" or blog posts.  Like Octopress, it provides a quickstart script that sets most of your default settings, and builds your Makefiles/Fabfiles for you.  It should be noted that, for me at least, the Fabfile is broken in ways that confuse me completely, but the Makefile has worked like a dream.  It's based on markdown &lt;em&gt;and&lt;/em&gt; reStructedText.  It comes with an array of themes and plugins.  It's generally quite impressive.&lt;/p&gt;
&lt;p&gt;Speaking of themes, you might have noticed that this blog has a new theme.  Sure, it should be obvious that getting new blogging software almost always precipitates getting a new theme, but this theme is special, because I built it.  Personally I am amazed.  I ask dearly that no-one who knows anything about web design look at the css files, as they are a hideous mess put together using less, random snippets from stackoverflow, and moments of frenzied inspiration.  I might minify them just so that people can't see how bad my CSS-fu is.&lt;/p&gt;
&lt;p&gt;However, it seems to work, both here on my laptop, and also on my all-important phone.  It's pretty much all simple css, so it should run pretty quickly.  I have a vague plan to add extra colour-schemes, and then allow the user to select different themes, and then save preferences client-side, and all sorts of exciting things like that, but apart from that I've tried to limit my excitement for overly-complex javascript scripts to the random-quote generator at the top of the main page.  (Scroll up and refresh the page to see the exciting quotes!  I spent, like, thirty seconds on them!  They're my best work!)&lt;/p&gt;
&lt;p&gt;Anyway, to conclude: Welcome to what will almost certainly hopefully maybe my new blog!  Perhaps.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jonathan Frere</dc:creator><pubDate>Fri, 18 Oct 2013 01:10:00 +0000</pubDate><guid>tag:www.johz.me,2013-10-18:posts/2013/Oct/18/the-truth-of-the-matter/</guid><category>meta</category><category>pelican</category><category>octopress</category></item><item><title>"OMG Elixir: Functional Ruby with the Power of Erlang"</title><link>http://www.johz.me/posts/2013/Oct/02/omg-elixir/</link><description>&lt;p&gt;Recently, I found Elixir.  It just appeared in front of me.  Specifically, &lt;a href="http://learnxinyminutes.com/" title="Learn X in Y Minutes"&gt;Learn X in Y Minutes&lt;/a&gt; appeared before me, and so I read.  About a quarter of the way down lay a link to a short page entitled "Elixir".  This should have been a horrible language.  It was functional, and I have always been an object-oriented programmer before.  It was based on Erlang, a language with &lt;a href="http://damienkatz.net/2008/03/what_sucks_abou.html" title="What Sucks About Erlang"&gt;syntax as bad as Lisp's, but without the redeeming powers of Lisp&lt;/a&gt;.  It had a syntax based on Ruby, which I hate&lt;sup id="fnref:1"&gt;&lt;a class="footnote-ref" href="#fn:1" rel="footnote"&gt;1&lt;/a&gt;&lt;/sup&gt;.  All in all, I should have switched off there.&lt;/p&gt;
&lt;p&gt;But I didn't.  I carried on reading.  I found a handful of blog posts.  I started to read into Erlang and the OTP.  I found Elixir at the start of a week-long camping holiday.  By the end of the week, before I had had the chance to write a single line of code, I was hooked.  Why?  Well, I still don't know, but I might as well try and explain my reasoning to you.&lt;/p&gt;
&lt;p&gt;Firstly, Elixir is functional, and this is cool.  Sure, OOP is awesome, and I love it when it's around, but functional programming has an elegence to it that just isn't matched by building up big objects.  Indeed, there are many programs where object-oriented programming just doesn't make much sense.  Take a module designed to read json.  In Python, the standard way would be to have a class, say the JSONDecoder class, and let that do all the work.  Indeed, in Python this is a remarkably sensible system.  The module's user is normally presented with simple functions for most of their needs, but they can also subclass JSONDecoder whenever they need to, and add onto it as they please.  It's how you'd do it in Python, but is it really how you do it conceptually?&lt;/p&gt;
&lt;p&gt;My mental image of decoding JSON is definitely a function.  I give it JSON string input, and it comes out with a structure I can use in my code.  This function then needs to tokenise my input, which is a job for a function.  Each set of tokens needs to be recompiled back into a native data structure.  Each step is a function, taking an input, returning an output.  Decoding JSON, along with a large number of other tasks, is a functional task.&lt;/p&gt;
&lt;p&gt;Sure, there are other tasks for which the object-oriented structure is perfect.  When I want to model a real-life object then it's natural to have an object with attributes and methods, but knowing a functional language will definitely give you the tools to use when you need a different system.&lt;/p&gt;
&lt;p&gt;Secondly, Elixir is Erlang, and this is powerful.  A brief history lesson that you should &lt;a href="http://www.erlang.org/" title="The Erlang Homepage"&gt;follow&lt;/a&gt; &lt;a href="http://learnyousomeerlang.com/" title="Learn You Some Erlang (For Great Good)"&gt;up&lt;/a&gt; &lt;a href="http://en.wikipedia.org/wiki/Erlang_(programming_language)" title="Erlang (programming language) - Wikipedia"&gt;on&lt;/a&gt; because it's so interesting:  Erlang was designed by Erricson, the Swedish telecommunications company, as a language that would be suitable for their telephony systems.  It needed to be able to fix itself when it broke, update itself without breaking, be able to handle concurrency with ease and, because programmers should be able to program efficiently, it was designed to be a functional program, on the basis that functional programming would be easier for the programmers.&lt;/p&gt;
&lt;p&gt;Erlang is an amazingly nifty language because of these things.  While benchmarks are useless, &lt;a href="https://gist.github.com/josevalim/1582864" title="Dynamo Benchmark"&gt;this one&lt;/a&gt; demonstrates one of the benefits of an Erlang background.  It's a test of various similar web frameworks, and it shows how the Elixir/Erlang-based one (Dynamo) is able to deal with concurrency straight out of the box.  As the writer&lt;sup id="fnref:2"&gt;&lt;a class="footnote-ref" href="#fn:2" rel="footnote"&gt;2&lt;/a&gt;&lt;/sup&gt; notes, the other options almost certainly support concurrency, but immediately, straight out of the box, and with such ease that it's sometimes said that processes are an Erlang developer's objects.&lt;/p&gt;
&lt;p&gt;So Elixir builds on Erlang, and in a really nice way, too.  Leaving aside the syntax, which is by-and-large friendly and intuitive to use, there's all sorts of extras.  Take the standard libraries.  Erlang libraries are useful, but woefully inconsistent.  Some use zero-indexing, others start their indexing at 1.  When performing operations on structures such as lists, some functions will put the structure as the first argument, others as the structure.  Elixir's library is designed to standardise this.  Not only that, but when you do need an Erlang library, it's as easily accessible as any Elixir library, just using a slightly different syntax.&lt;/p&gt;
&lt;p&gt;Thirdly, Elixir isn't Erlang, and this is a relief.  As I've just said, Erlang did make mistakes, but Elixir has done a brilliant job of avoiding them.  Just one small example: Elixir comes with dictionaries built-in, as a list of tuples that can be accessed using the near-univeraslly standard bracket notation.  It's not all-powerful, but it's damn useful.&lt;/p&gt;
&lt;p&gt;Or take records, which are the missing link between simple mappings and full-blown objects.  When you want to know exactly what types of data you're passing around, define yourself a record and use it.  Indeed, you can use it as if it were a built-in type by adding protocols, which allow for a very basic duck-typing system to form.  For a functional program, Elixir is very object-oriented.&lt;/p&gt;
&lt;p&gt;And then there's the most powerful part of Elixir, the fact that it is written, by-and-large, in itself, using macros.  If Erlang is as painful to write as Lisp without the benefits of using macros, then Elixir is as powerful as Lisp with all her macro-based glory, but with all of the benefits of a syntax you want to write in.  Macros are designed to be used for anything, ranging from simple domain-specific languages (imagine the &lt;code&gt;get "url/route" do&lt;/code&gt; style used in Ruby-on-Rails or the task-specification format in a Rakefile) to directly adding your own constructs into the library.  One of the popular examples is the unit-testing system that's been included.  A macro is able to examine the code that's passed into it, allowing ExUnit to look at this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;test&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;a simple assertion&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;assert&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And interpret it in such a way as to be able to respond like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;test&lt;/span&gt; &lt;span class="n"&gt;adding&lt;/span&gt; &lt;span class="n"&gt;two&lt;/span&gt; &lt;span class="n"&gt;numbers&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nc"&gt;MathTest&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;**&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nc"&gt;ExUnit.ExpectationError&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="ss"&gt;expected&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;
     &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;equal&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;
   &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;It's not desperately showy or flashy, and you'd be forgiven for wondering why this example gets mentioned so much, but it's actually a lot more involved than it seems.  The simple assertion macro is passed a length of code as a syntax tree, and it gets to evaluate it and understand it as it sees fit.  That's powerful.&lt;/p&gt;
&lt;p&gt;This has been but a brief look at Elixir, and I'd encourage you to try it out yourself sometime.  It's a language built entirely for developers, right down to the extensive build-tools that come packaged with it from the off.  A good starting point would be the &lt;a href="http://elixir-lang.org/getting_started/1.html" title="Elixir - Getting Started"&gt;getting started guide&lt;/a&gt; that you can see on the &lt;a href="http://elixir-lang.org/" title="Elixir Home"&gt;main website&lt;/a&gt;.  Of course you should always peruse the &lt;a href="http://elixir-lang.org/docs/master/" title="Elixir Docs"&gt;documentation&lt;/a&gt;.  There aren't many good tutorials on Elixir at the moment (it's not even four years' old, and hasn't currently done a 1.0 release) but I'd recommend &lt;a href="http://learnyousomeerlang.com/" title="Learn You Some Erlang (For Great Good)"&gt;Learn You Some Erlang (For Great Good)&lt;/a&gt; as a start, and, if you're willing to splash the cash, the &lt;a href="http://pragprog.com/book/elixir/programming-elixir" title="Programming Elixir - Pragmatic Programming"&gt;Pragmatic Programmers&lt;/a&gt; are putting together a book, and you can buy the beta-edition ebook and learn as it gets continually updated.&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;To be honest, I fully recognise that Ruby has some awesome things, and it's definitely a good and powerful language to know, but you know how there are some languages that, right down in your gut, you just &lt;em&gt;hate&lt;/em&gt;?  Yeah, I hate Ruby.  I love rubyists, though.  Hate the sin, love the sinner, right?&amp;#160;&lt;a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text"&gt;[back]&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;Who admittedly just happens to be JosÃ© Valim, the creator of Elixir, but shhhh, I've already mentioned that benchmarks are rubbish, I'm just demonstrating what this one actually tells us...&amp;#160;&lt;a class="footnote-backref" href="#fnref:2" rev="footnote" title="Jump back to footnote 2 in the text"&gt;[back]&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jonathan Frere</dc:creator><pubDate>Wed, 02 Oct 2013 23:49:00 +0000</pubDate><guid>tag:www.johz.me,2013-10-02:posts/2013/Oct/02/omg-elixir/</guid><category>coding</category><category>elixir</category></item><item><title>Hello, World 2.0</title><link>http://www.johz.me/posts/2013/Sep/30/hello-world-2-dot-0/</link><description>&lt;p&gt;So I got a blog.  A second blog, to be precise.  Some of you might remember the &lt;a href="http://johz.wordpress.com/" title="Johz Blog"&gt;old blog&lt;/a&gt; on &lt;a href="http://wordpress.com/" title="Wordpress Home"&gt;wordpress.com&lt;/a&gt;.  You might also have noticed that I haven't blogged from there in over a year.  I managed to tell you all that I'd arrived at University, and then I mysteriously went silent.  Well, now I'm back, back with a vengeance, and also with hosting.  Yes, hosting.&lt;/p&gt;
&lt;p&gt;At the time that I write this, I am using &lt;a href="http://www.webfaction.com" title="Web Faction Home"&gt;Web Faction&lt;/a&gt; for my hosting.  Why?  Well, it seemed to me like it was the most helpful.  There were docs on doing pretty much everything I wanted to do, with a healthy support base, and a generally hacker-oriented vision.  That appealed to me.  Then I managed to find a &lt;a href="http://slickdeals.net/f/5989592-webfaction-hosting-50-off-1yr-65-off-3yrs" title="Webfaction deals"&gt;code for 50% off hosting&lt;/a&gt;, and it suddenly seemed like the most sensible choice.  It's certainly not the cheapest provider out there, but I'm hoping it'll turn out to be a good first choice.&lt;/p&gt;
&lt;p&gt;More technical details abound.  I'm currently hosting in Europe, because Europeans are cooler and more awesome, and my internet connection is poor enough that I need all the help I can get in improving the latency of my ssh connection.  This blog is produced using &lt;a href="http://www.octopress.org" title="Octopress Home"&gt;Octopress&lt;/a&gt;, which is lovely, and allows me to use Markdown, which I just love.  I'm currently hunting down a nice theme for the blog, but I might have to end up making my own, and that would be bad.  No, seriously, it would be an affront to all your sensibilities, so if you've found an awesome theme, please tell me about it.  It could save your life, although I have yet to work out how.&lt;/p&gt;
&lt;p&gt;What sorts of things will you find on here other than a blog?  Well, as I have returned to &lt;a href="http://www.nationstates.net" title="NationStates Home"&gt;NationStates&lt;/a&gt;, expect a few NS-related apps to appear.  Additionally, I'm planning on fixing up my IRC bot, K-Eight, and running him from this server.  Finally, I'd like to get back to writing.  You might have read my old poems and prose on the WordPress blog.  If you haven't, please don't go back and look at them, they were awful.  But I've got to confess, I really enjoyed being able to write, and a success in a short-story competition recently (well, half a year ago) and a few conversations with some creative friends have inspired me to try and revisit some of my old ideas.  So look out for that, maybe, if you're masochistic enough.&lt;/p&gt;
&lt;p&gt;Anyway, for now I'm going to go back to coding and thinking up new blog posts.  Again, if you know of a good Octopress theme, contact me somehow.  I'll get comments and an email address up soon, until then I recommend telepathy, sending a message in a bottle, or simply contacting me on IRC: &lt;a href="irc://irc.esper.net/johztestingchannel" title="#johztestingchannel on Esper.net"&gt;#johztestingchannel on Esper.net&lt;/a&gt;.  Bye for now!&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jonathan Frere</dc:creator><pubDate>Mon, 30 Sep 2013 21:31:00 +0000</pubDate><guid>tag:www.johz.me,2013-09-30:posts/2013/Sep/30/hello-world-2-dot-0/</guid><category>meta</category></item></channel></rss>