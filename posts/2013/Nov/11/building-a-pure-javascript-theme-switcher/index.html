<!DOCTYPE html>
<html lang="en">

  <head>

        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />


  <script type="text/javascript">
  themes = [
    'dark',
    'light',
  ];
      themeDefault = "dark";
  </script>

  <script type="text/javascript">
    window.themeSwitcher=new function(e,t){"use strict";var n=function(e,t,n){if(Array.prototype.indexOf){return Array.prototype.indexOf.apply(e,Array.prototype.slice.call(arguments,1))}var r,i=n?n:0,s;s=e.length;if(s===0||i>=s){return-1}if(i<0){i=s-Math.abs(i)}for(r=i;r<s;r++){if(e[r]==t){return r}}return-1};var r="pillbox-theme-tester-value";var i="pillbox-theme";var s=this;s.lsExists=false;s.themes=e;s.defaultTheme=n(e,t);s.currentTheme=s.defaultTheme;try{localStorage.setItem(r,r);if(localStorage.getItem(r)===r){localStorage.removeItem(r);s.lsExists=true}}catch(o){}var u=function(e){if(e>=0&&e<s.themes.length){return{s:s.themes[e],i:e}}else{return{s:s.themes[s.currentTheme],i:s.currentTheme}}};var a;if(s.lsExists){var f=localStorage.getItem(i);s.currentTheme=n(e,f);if(s.currentTheme<0){s.currentTheme=s.defaultTheme}a=function(e){var t=u(e);var n=document.getElementById("main-theme");var r=n.href.split("/");r[r.length-1]=t.s+".min.css";n.href=r.join("/");localStorage.setItem(i,t.s);s.currentTheme=t.i}}else{a=function(e){var t=u(e);var n=document.getElementById("main-theme");var r=n.href.split("/");r[r.length-1]=t.s+".min.css";n.href=r.join("/");s.currentTheme=t.i}}s.writeStyle=function(){var e=s.themes[s.currentTheme];document.write('<link id="main-theme" href="http://johz.me/theme/css/');document.write(e+'.min.css" rel="stylesheet" />')};s.getStyle=function(e){if(e==null||typeof e==="undefined"){return s.currentTheme}else if(typeof e==="number"&&e===Math.floor(e)){return u(t).s}else{var t=n(s.themes,e);if(t>-1){return t}else{return s.currentTheme}}};s.setStyle=function(e){var t=s.getStyle(e);if(t==s.currentTheme){return}a(t)};s.cycleStyle=function(){console.log(s.currentTheme);a((s.currentTheme+1)%s.themes.length)};s.addSwitcher=function(e){var t=document.getElementById(e);var n=document.createElement("select");n.id="theme-switcher-select";for(var r=0;r<s.themes.length;r++){var i=s.themes[r];var o=document.createElement("option");o.value=i;o.appendChild(document.createTextNode(i));if(r==s.currentTheme){o.selected=true}n.appendChild(o)}n.onchange=function(){var e=this.options[this.selectedIndex].value;themeSwitcher.setStyle(e)};t.appendChild(n)};s.addCycleButtons=function(){var e=document.querySelectorAll("a[href='#cycle-themes']");for(var t=0;t<e.length;t++){var n=e[t];n.addEventListener("click",function(e){e.preventDefault();s.cycleStyle()})}}}(themes,themeDefault)

    themeSwitcher.writeStyle();
  </script>
  <noscript>
    <link id="main-theme" href="http://johz.me/theme/css/dark.min.css" rel="stylesheet" />
  </noscript>

      <title>Johz</title>

  <link href="http://johz.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Johz Full Atom Feed" />
  <link href="http://johz.me/feeds/misc.atom.xml" type="application/atom+xml" rel="alternate" title="Johz Categories Atom Feed" />





    <meta name="tags" contents="coding" />
    <meta name="tags" contents="javascript" />

  </head>

  <body>
    <header id="header">
      <h1 id="header-title"><a class="no-hilite" href="http://johz.me/">
        <div id="sitename">Johz</div>
      </a></h1>
    </header>

      <nav id="menu"><ul>


          <li><a href="#cycle-themes">Change Theme</a></li>

            <li  ><a href="http://johz.me/pages/about-me.html">About&nbsp;Me</a></li>



      </ul></nav>


<section id="content">
  <article class="article blog-article">
    <header class="article-header">
      <h2 class="entry-title">
        <a href="http://johz.me/posts/2013/Nov/11/building-a-pure-javascript-theme-switcher/" class="no-hilite" rel="bookmark" title="Permalink to Building a Pure-Javascript ThemeÂ Switcher">
          Building a Pure-Javascript Theme&nbsp;Switcher
        </a>
      </h2>
    </header>
    <footer class="article-footer">
        Published <abbr class="published" title="2013-11-11T18:16:29+00:00"> Mon 11 November 2013 </abbr>
          by <a href="http://johz.me/author/johz.html">Johz</a>
      </footer>
    <div class="article-text">
      <p>You might have noticed that you can change the theme of my blog.  I&#8217;m quite sure I&#8217;ve told you before that you can do this, but I&#8217;m going to tell you again, because I&#8217;m really proud of working out how to add this functionality, especially making it either work or fail gracefully on pretty much all browsers, and making it persist across sessions.  The exciting part for me is that this is entirely client-side, so it works on a static blog or website, which mine is.  I recognise that it&#8217;s simple, easy, and my pride is entirely unwarranted, but dammit it makes me feel&nbsp;good.</p>
<p>I&#8217;ve spent today rewriting the code that does this to make it prettier, and more reusable.  For example, if you click on <a href="javascript:void(0)" onclick="themeSwitcher.setStyle(-1);">this link</a>, the entire theme will change to a different one.  It&#8217;s also much easier to add new themes now, as there&#8217;s only one place that they&#8217;re&nbsp;specified.</p>
<p>So how does this all work?  Well, assuming you&#8217;ve already got a document and a couple of stylesheets that you want to switch between, we&#8217;ll start by defining a themeSwitcher&nbsp;object.</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">themes</span> <span class="o">=</span> <span class="nx">themes</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span><span class="p">;</span>
<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">)</span>
</pre></div>


<p>Here, we&#8217;re simply creating a single object with an anonymous constructor function.  The constructor takes two arguments, the list of themes, and the default theme.  We store the list of themes directly, but instead of storing the defaultTheme as is (in a string format) we store it internally as an index.  We also need to set the currentTheme, which of course is the default theme by&nbsp;default.</p>
<p>Next we need to find out if there are any stylesheets already saved.  For this we need some sort of peristent storage.  I used localStorage, but there are other storage alternatives out there.  The other big contender that you might think about using is cookie storage.  There are three big differences between the two of these, for our uses at&nbsp;least.</p>
<p>Firstly, cookies are a pain to handle, whereas working with localStorage is a dream.  For me, this was the biggest reason for turning to localStorage.  Secondly, localStorage isn&#8217;t entirely cross-browser.  While localStorage is available for about <a href="http://caniuse.com/#feat=namevalue-storage" title="Can I Use: name-value Storage">90%</a> of your users, if you think you&#8217;re going to get a lot of traffic from older browsers that might be a consideration for you.  Thirdly, cookies are sent to the server.  This particular theme switcher is entirely client-side, so that&#8217;s not necessary, but if you wanted to add some sort of server-side code that deals with the theme, you might want to think about using&nbsp;cookies.</p>
<p>However, for me localStorage seemed to be the best answer.  Of course, if we&#8217;re using localStorage, we&#8217;re going to need to ensure that localStorage exists.  If you&#8217;ve already got <a href="http://modernizr.com/" title="Modernizr - Feature detection">Modernizr</a> installed, you should use that.  However, I didn&#8217;t, and I didn&#8217;t want to include a whole new library just to find out if I could use one feature, so I <a href="https://github.com/Modernizr/Modernizr/blob/master/feature-detects/storage/localstorage.js" title="The localStorage test in Modernizr's source">used the source</a>, and borrowed the test that Modernizr used.  This is what it looks&nbsp;like:</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// Assume that localStorage doesn&#39;t</span>
                         <span class="c1">// work until proven otherwise</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">themes</span> <span class="o">=</span> <span class="nx">themes</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Do a test</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">);</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Test failed</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">)</span>
</pre></div>


<p>Beautiful.</p>
<p>Now if localStorage exists, that still doesn&#8217;t mean that there&#8217;s anything saved there.  The stuff that&#8217;s saved there could also be complete gobbledygook.  If you can, have a look at what localStorage saves on this site.  (On Chrome, press Ctrl-Shift-i, go to &#8220;Resources&#8221;, and &#8220;Local Storage&#8221;.)  Edit it to something that isn&#8217;t &#8220;dark&#8221; or &#8220;lite&#8221;, reload the page, and you&#8217;ll see that the site automatically uses the &#8220;dark&#8221; theme.  That&#8217;s because the alternative would be to load no stylesheet at all, and I really don&#8217;t want that to&nbsp;happen.</p>
<p>To check if the value saved is an acceptable value, the easiest thing we can do is find out if it&#8217;s in the array of themes that was passed into the constructor.  The best way to do this is <code>Array.prototype.indexOf</code>, which works on most browsers, but not all.  Unfortunately, there are browsers that implement localStorage and not indexOf, so we need to write our own indexOf function for those cases.  I based mine on the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf#Compatibility" title="Array.prototype - Mozilla docs">Mozilla sample implementation</a>, minified it because it was useless and ugly, and added it to the top of the script.  Note that this implementation doesn&#8217;t modify the Array&nbsp;prototype.</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">indexOf</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">n</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">){</span>
    <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
    <span class="nx">arguments</span><span class="p">,</span><span class="mi">1</span><span class="p">))}</span><span class="kd">var</span> <span class="nx">r</span><span class="p">,</span><span class="nx">i</span><span class="o">=</span><span class="nx">n</span><span class="o">?</span><span class="nx">n</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">s</span><span class="p">;</span><span class="nx">s</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">s</span><span class="o">===</span><span class="mi">0</span><span class="o">||</span><span class="nx">i</span><span class="o">&gt;=</span><span class="nx">s</span><span class="p">){</span><span class="k">return</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">){</span><span class="nx">i</span><span class="o">=</span><span class="nx">s</span><span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">i</span><span class="p">)}</span><span class="k">for</span><span class="p">(</span><span class="nx">r</span><span class="o">=</span><span class="nx">i</span><span class="p">;</span><span class="nx">r</span><span class="o">&lt;</span><span class="nx">s</span><span class="p">;</span><span class="nx">r</span><span class="o">++</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">==</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="nx">r</span><span class="p">}}</span>
    <span class="k">return</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">themes</span> <span class="o">=</span> <span class="nx">themes</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">);</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="c1">// Get the theme stylesheet, and check that it exists</span>
    <span class="nx">stylesheet</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;theme-stylesheet&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">stylesheet</span><span class="p">);</span> <span class="c1">// Note shim!</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">)</span>
</pre></div>


<p>So now themeSwitcher is an object that contains a list of all possible themes, the current theme, the default theme, and a flag that tells us if localStorage exists or not.  That&#8217;s all very useful, but none of it actually changes the theme.  Indeed, we haven&#8217;t even installed a theme on the page.  This theme switching system still requires a bit of&nbsp;work.</p>
<p>Firstly, let&#8217;s add a function that writes the current theme to the document.  There are multiple ways of doing this, and some are more idiomatic and beautiful than others, but since all we&#8217;re actually doing is writing a single line of <span class="caps">HTML</span>, I&#8217;ve opted for <code>document.write</code>.  Sure, you should probably build an element, and append it somewhere to the <span class="caps">DOM</span>, but I&#8217;m lazy, and that feels like way too many lines of&nbsp;code.</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*</span>
<span class="cm">  indexOf function</span>
<span class="cm">    ...</span>
<span class="cm">  constructor statements &amp; test for localStorage</span>
<span class="cm">  */</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">writeStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// remember that currentTheme is an index, not a theme name</span>
    <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">];</span>
    <span class="c1">// Modify the html here as you please.</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;link id=&quot;main-theme&quot; href=&quot;/static/css/&#39;</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">styleName</span> <span class="o">+</span> <span class="s1">&#39;.css&quot; rel=&quot;stylesheet&quot; /&gt;&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">)</span>
</pre></div>


<p>I&#8217;m creating a function to do this, because that&#8217;s the way that feels most idiomatic to me.  (This is probably ironic, considering the previous paragraph.)  You could just do the <code>document.write</code> as a statement within the constructor, but this means that later you&#8217;ll have less control over when and where you place the&nbsp;link.</p>
<p>The other thing that we need is a way to change the themes once the document is loaded.  After all, expecting the user to reload the page every time they change the theme is a bit much to ask, don&#8217;t you think?  The way I chose to do this was by writing two private <code>_setStyle</code> function, and then defining one of them based on whether localStorage existed.  You could use an if-statement, and test on the <code>lsExists</code> attribute, but why bother when the try/catch statement already divides flow into two sections for you to&nbsp;use?</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*</span>
<span class="cm">  indexOf function</span>
<span class="cm">    ...</span>
<span class="cm">  constructor statements</span>
<span class="cm">  */</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="cm">/* get theme stylesheet */</span>

    <span class="c1">// _setStyle if localStorage exists</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// check that the theme really does exist</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">];</span>
        <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// Get the URL of the link, and change it to the URL</span>
      <span class="c1">// of the new link.  This assumes that all the css</span>
      <span class="c1">// sheets are sitting in the same directory.  It also</span>
      <span class="c1">// assumes that only one css sheet is needed to define</span>
      <span class="c1">// a theme.  You can modify this if that isn&#39;t the case.</span>
      <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;main-theme&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">splits</span> <span class="o">=</span> <span class="nx">link</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
      <span class="nx">splits</span><span class="p">[</span><span class="nx">splits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">styleName</span> <span class="o">+</span> <span class="s1">&#39;.css&#39;</span><span class="p">;</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">splits</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

      <span class="c1">// Make sure we save the new theme name so that</span>
      <span class="c1">// the choice persists across sessions.</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;pillbox-theme&#39;</span><span class="p">,</span> <span class="nx">styleName</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="c1">// _setStyle if localStorage does not exists</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// the style will always be the current theme,</span>
      <span class="c1">// which will always be the default theme.</span>
      <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">];</span>

      <span class="c1">// Still write the new theme into the document,</span>
      <span class="c1">// just in case something has gone horribly wrong.</span>
      <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;main-theme&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">splits</span> <span class="o">=</span> <span class="nx">link</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
      <span class="nx">splits</span><span class="p">[</span><span class="nx">splits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">styleName</span> <span class="o">+</span> <span class="s1">&#39;.css&#39;</span><span class="p">;</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">splits</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>


  <span class="cm">/* writeStyle function */</span>
<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">)</span>
</pre></div>


<p>You can now start playing with things in your browser.  Assuming you&#8217;ve got all your stylesheets in the right place, and a basic <span class="caps">HTML</span> layout, insert this code at the top of the <code>&lt;head&gt;</code> brackets.  Then open up a development console and start calling <code>themeSwitcher._setStyle</code> with various values.  Notice that you can only use indices to specify which theme you want.  Let&#8217;s change that.  When we make our public setStyle function, we want to also be able to specify the string name of the css file.  I also want there to be a way to call it without specifying the theme, and let it toggle between&nbsp;themes.</p>
<p>To do this, we&#8217;re going to need an algorithm that can take a string, integer, or null input, and return the index of the theme that best matches the description.  Now that sounds like a fairly useful algorithm to use, so in the interests of <span class="caps">DRY</span>, let&#8217;s implement it as a new function, <code>themeSwitcher.getStyle</code>, then add <code>themeSwitcher.setStyle</code> on top of&nbsp;it.</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*</span>
<span class="cm">  indexOf function</span>
<span class="cm">    ...</span>
<span class="cm">  constructor statements</span>
<span class="cm">  */</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="cm">/* localStorage exists _setStyle implementation */</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* localStorage doesn&#39;t exist _setStyle implementation */</span>
  <span class="p">}</span>

  <span class="cm">/* writeStyle function */</span>

  <span class="c1">// public getStyle method</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Firstly, check if stylesheet is undefined or null.</span>
    <span class="c1">// In this case we&#39;ll return the current theme.</span>
    <span class="c1">// This allows us to use themeSwitcher.themes[themeSwitcher.getStyle()]</span>
    <span class="c1">// to find out the current theme.</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">stylesheet</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="nx">stylesheet</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Next, stylesheet could be an index.  Return either the index,</span>
    <span class="c1">// or if index is invalid, the current theme.</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">stylesheet</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span>
               <span class="o">&amp;&amp;</span>   <span class="nx">stylesheet</span> <span class="o">===</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">stylesheet</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">stylesheet</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">stylesheet</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Otherwise, assume stylesheet is the name of a style.</span>
    <span class="c1">// If it isn&#39;t, then it won&#39;t be in the list of themes,</span>
    <span class="c1">// so just return the current theme.</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">stylesheet</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">index</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// public setStyle method</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// get the style index using getStyle</span>
    <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">);</span>

    <span class="c1">// if the stylesheet is the same as the current</span>
    <span class="c1">// stylesheet, toggle the stylesheet to the next one</span>
    <span class="c1">// in the list of themes.</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">index</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Use whichever private _setStyle function was defined</span>
    <span class="c1">// to set the style of the page.</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setStyle</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">)</span>
</pre></div>


<p>The main theme switching mechanism is now pretty much almost done.  Unfortunately, unless the user plays around with their development console, they&#8217;re not going to be able to change much.  This is where we need to add an element on the page that actually allows the user interface to work.  I&#8217;ve implemented this here in the form of a <code>select</code> drop-down choice form element, but of course you can edit and play with this code as much as you&nbsp;want.</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* initialisation, writeStyle, getStyle and setStyle definitions */</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">addSwitcher</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elementID</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Append our switcher to #elementID</span>
    <span class="nx">elem</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">elementID</span><span class="p">);</span>

    <span class="c1">// We&#39;re using a select element</span>
    <span class="nx">switcher</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
    <span class="nx">switcher</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s2">&quot;theme-switcher-select&quot;</span><span class="p">;</span>

    <span class="c1">// Iterate through the themes, and append them as options</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">theme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="nx">option</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">);</span>
      <span class="nx">option</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">theme</span>
      <span class="nx">option</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">theme</span><span class="p">))</span>

      <span class="c1">// The current theme should be selected</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">option</span><span class="p">.</span><span class="nx">selected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">switcher</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">option</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="c1">// When a new option is selected, call our setStyle function</span>
    <span class="nx">switcher</span><span class="p">.</span><span class="nx">onchange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">theme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="nx">theme</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Append to the document</span>
    <span class="nx">elem</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">switcher</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">)</span>
</pre></div>


<p>And voila, a complete client-side theme switching solution.  How do you use this?  Well, the above definition should go in your <code>&lt;head&gt;</code> section in a <code>&lt;script&gt;</code> tag.  Then, immediately afterwards, you should call <code>themeSwitcher.writeStyle()</code>.  Now the rest of your page can load, with the correct stylesheet enabled.  In the place where you want the theme-switching interface, create a container element with an id, then immediately below that, in script tags, call <code>themeSwitcher.addSwitcher(elementID)</code>, where elementID is of course the id of the container element.  Check out the source code of this page to see it in action.  I&#8217;ve minified the function definition, but it works exactly the&nbsp;same.</p>
<p>Here&#8217;s the complete&nbsp;listing.</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">indexOf</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">n</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">){</span><span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span><span class="mi">1</span><span class="p">))}</span><span class="kd">var</span> <span class="nx">r</span><span class="p">,</span><span class="nx">i</span><span class="o">=</span><span class="nx">n</span><span class="o">?</span><span class="nx">n</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">s</span><span class="p">;</span><span class="nx">s</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">s</span><span class="o">===</span><span class="mi">0</span><span class="o">||</span><span class="nx">i</span><span class="o">&gt;=</span><span class="nx">s</span><span class="p">){</span><span class="k">return</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">){</span><span class="nx">i</span><span class="o">=</span><span class="nx">s</span><span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">i</span><span class="p">)}</span><span class="k">for</span><span class="p">(</span><span class="nx">r</span><span class="o">=</span><span class="nx">i</span><span class="p">;</span><span class="nx">r</span><span class="o">&lt;</span><span class="nx">s</span><span class="p">;</span><span class="nx">r</span><span class="o">++</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">==</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="nx">r</span><span class="p">}}</span><span class="k">return</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">themes</span> <span class="o">=</span> <span class="nx">themes</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">);</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="nx">stylesheet</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;theme-stylesheet&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">stylesheet</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_setStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">];</span>
        <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;main-theme&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">splits</span> <span class="o">=</span> <span class="nx">link</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
      <span class="nx">splits</span><span class="p">[</span><span class="nx">splits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">styleName</span> <span class="o">+</span> <span class="s1">&#39;.css&#39;</span><span class="p">;</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">splits</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;pillbox-theme&#39;</span><span class="p">,</span> <span class="nx">styleName</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_setStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;main-theme&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">splits</span> <span class="o">=</span> <span class="nx">link</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
      <span class="nx">splits</span><span class="p">[</span><span class="nx">splits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">styleName</span> <span class="o">+</span> <span class="s1">&#39;.css&#39;</span><span class="p">;</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">splits</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">writeStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">];</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;link id=&quot;main-theme&quot; href=&quot;/static/css&#39;</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">styleName</span> <span class="o">+</span> <span class="s1">&#39;.css&quot; rel=&quot;stylesheet&quot; /&gt;&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">getStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">stylesheet</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">stylesheet</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">stylesheet</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span>
                 <span class="o">&amp;&amp;</span>   <span class="nx">stylesheet</span> <span class="o">===</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">stylesheet</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">stylesheet</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">stylesheet</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">stylesheet</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">index</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">index</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setStyle</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">addSwitcher</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elementID</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">elem</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">elementID</span><span class="p">);</span>
    <span class="nx">switcher</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
    <span class="nx">switcher</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s2">&quot;theme-switcher-select&quot;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">theme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="nx">option</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">);</span>
      <span class="nx">option</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">theme</span>
      <span class="nx">option</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">theme</span><span class="p">))</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">option</span><span class="p">.</span><span class="nx">selected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">switcher</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">option</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">switcher</span><span class="p">.</span><span class="nx">onchange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
      <span class="nx">themeSwitcher</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">elem</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">switcher</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">);</span>
</pre></div>
    </div>
  </article>

  <p class="paginator">
      <a href="http://johz.me/posts/2013/Nov/25/on-doctor-who-and-cosmic-harmony/">&laquo;</a>
    Building a Pure-Javascript Theme&nbsp;Switcher
      <a href="http://johz.me/posts/2013/Nov/02/old-news/">&raquo;</a>
  </p>

  <div id="disqus-comments-container"></div>
</section>


      <div id="theme-switcher">
        Change Theme <br />
      </div>
      <script>
        themeSwitcher.addSwitcher('theme-switcher');
        themeSwitcher.addCycleButtons();
      </script>

    <footer id="footer">
      <p>This blog is built using <a href="http://getpelican.com">Pelican</a>, <a href="http://python.org">Python</a>, and the Pillbox theme.</p>
      <p>
<a rel="license" href="http://creativecommons.org/publicdomain/zero/1.0/" class="no-hilite">
    <img src="http://i.creativecommons.org/p/zero/1.0/88x31.png" style="border-style: none;" alt="CC0" />
</a>
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/" class="no-hilite">
    <img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
</a><br />
Unless otherwise specified, content on this blog is available under the
<a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons
Attribution 4.0 International License</a>.  Likewise, unless otherwise
specified, code samples are in the
<a href="http://creativecommons.org/publicdomain/zero/1.0/">public domain</a>.
The blog's theme (pillbox) is available under the MIT license on
<a href="https://github.com/MrJohz/pillbox-theme">Github</a>.
</p>
    </footer>



  </body>

</html>