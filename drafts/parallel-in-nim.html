<!DOCTYPE html>
<html lang="en">

  <head>

        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />


  <script type="text/javascript">
  themes = [
    'dark',
    'light',
  ];
      themeDefault = "dark";
  </script>

  <script type="text/javascript">
    window.themeSwitcher=new function(e,t){"use strict";var n=function(e,t,n){if(Array.prototype.indexOf){return Array.prototype.indexOf.apply(e,Array.prototype.slice.call(arguments,1))}var r,i=n?n:0,s;s=e.length;if(s===0||i>=s){return-1}if(i<0){i=s-Math.abs(i)}for(r=i;r<s;r++){if(e[r]==t){return r}}return-1};var r="pillbox-theme-tester-value";var i="pillbox-theme";var s=this;s.lsExists=false;s.themes=e;s.defaultTheme=n(e,t);s.currentTheme=s.defaultTheme;try{localStorage.setItem(r,r);if(localStorage.getItem(r)===r){localStorage.removeItem(r);s.lsExists=true}}catch(o){}var u=function(e){if(e>=0&&e<s.themes.length){return{s:s.themes[e],i:e}}else{return{s:s.themes[s.currentTheme],i:s.currentTheme}}};var a;if(s.lsExists){var f=localStorage.getItem(i);s.currentTheme=n(e,f);if(s.currentTheme<0){s.currentTheme=s.defaultTheme}a=function(e){var t=u(e);var n=document.getElementById("main-theme");var r=n.href.split("/");r[r.length-1]=t.s+".min.css";n.href=r.join("/");localStorage.setItem(i,t.s);s.currentTheme=t.i}}else{a=function(e){var t=u(e);var n=document.getElementById("main-theme");var r=n.href.split("/");r[r.length-1]=t.s+".min.css";n.href=r.join("/");s.currentTheme=t.i}}s.writeStyle=function(){var e=s.themes[s.currentTheme];document.write('<link id="main-theme" href="https://mrjohz.github.io/theme/css/');document.write(e+'.min.css" rel="stylesheet" />')};s.getStyle=function(e){if(e==null||typeof e==="undefined"){return s.currentTheme}else if(typeof e==="number"&&e===Math.floor(e)){return u(t).s}else{var t=n(s.themes,e);if(t>-1){return t}else{return s.currentTheme}}};s.setStyle=function(e){var t=s.getStyle(e);if(t==s.currentTheme){return}a(t)};s.cycleStyle=function(){console.log(s.currentTheme);a((s.currentTheme+1)%s.themes.length)};s.addSwitcher=function(e){var t=document.getElementById(e);var n=document.createElement("select");n.id="theme-switcher-select";for(var r=0;r<s.themes.length;r++){var i=s.themes[r];var o=document.createElement("option");o.value=i;o.appendChild(document.createTextNode(i));if(r==s.currentTheme){o.selected=true}n.appendChild(o)}n.onchange=function(){var e=this.options[this.selectedIndex].value;themeSwitcher.setStyle(e)};t.appendChild(n)};s.addCycleButtons=function(){var e=document.querySelectorAll("a[href='#cycle-themes']");for(var t=0;t<e.length;t++){var n=e[t];n.addEventListener("click",function(e){e.preventDefault();s.cycleStyle()})}}}(themes,themeDefault)

    themeSwitcher.writeStyle();
  </script>
  <noscript>
    <link id="main-theme" href="https://mrjohz.github.io/theme/css/dark.min.css" rel="stylesheet" />
  </noscript>

      <title>Johz</title>

  <link href="https://mrjohz.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Johz Full Atom Feed" />
  <link href="https://mrjohz.github.io/feeds/misc.atom.xml" type="application/atom+xml" rel="alternate" title="Johz Categories Atom Feed" />





    <meta name="tags" contents="nim" />
    <meta name="tags" contents="coding" />

  </head>

  <body>
    <header id="header">
      <h1 id="header-title"><a class="no-hilite" href="https://mrjohz.github.io/">
        <div id="sitename">Johz</div>
      </a></h1>
    </header>

      <nav id="menu"><ul>


          <li><a href="#cycle-themes">Change Theme</a></li>

            <li  ><a href="https://mrjohz.github.io/pages/about-me.html">About&nbsp;Me</a></li>



      </ul></nav>


<section id="content">
  <article class="article blog-article">
    <header class="article-header">
      <h2 class="entry-title">
        <a href="https://mrjohz.github.io/drafts/parallel-in-nim.html" class="no-hilite" rel="bookmark" title="Permalink to Getting Parallel inÂ Nim">
          Getting Parallel in&nbsp;Nim
        </a>
      </h2>
    </header>
    <footer class="article-footer">
        Published <abbr class="published" title="2015-01-10T14:20:31+00:00"> Sat 10 January 2015 </abbr>
          by <a href="https://mrjohz.github.io/author/johz.html">Johz</a>
      </footer>
    <div class="article-text">
      <p>Nim has recently got two new syntaxes for doing parallel programming.  That sounds like a good excuse to take my latest favourite language out for a test drive,&nbsp;right?</p>
<p>Parallel programming is a fairly simple concept that is remarkably difficult to get right.  Most computers these days have multiple cores, and therefore can do more than one thing at a time.  Parallel programming is about enabling that, whilst also ensuring that things don&#8217;t get lost whilst doing so.  It&#8217;s harder than it sounds - if two operations running at the same time try to operate on the same piece of data, it becomes very difficult to reason through the logic of the code.  For this reason, there have been many attempts to &#8220;solve&#8221; parallel programming, with varying degrees of&nbsp;success.</p>
<p>Nim has two ways of doing parallel programming.  One is fairly low-level, and simply spawns procedures, allowing the user to determine how and when to collect the results back together, whilst the other is more complex, proving at compile-time whether certain operations may create race-conditions.  I&#8217;ll create a program that uses the first format, then show how the second format can make writing the same code simpler and&nbsp;safer.</p>
<p>The first thing that any parallel operation needs is an operation.  Let&#8217;s start with something fairly simple - we just want to print out every letter of a name, all at the same&nbsp;time.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="n">threadpool</span>
<span class="kn">import</span> <span class="n">os</span>

<span class="k">proc </span><span class="nf">printLetter</span><span class="p">(</span><span class="n">letter</span><span class="p">:</span> <span class="kt">char</span><span class="p">)</span> <span class="o">=</span>
  <span class="n">echo</span> <span class="n">letter</span>

<span class="k">proc </span><span class="nf">main</span><span class="p">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">name</span> <span class="o">=</span> <span class="n">paramStr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

  <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
    <span class="n">spawn</span> <span class="n">printLetter</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>
  <span class="n">sync</span><span class="p">()</span>

<span class="k">when</span> <span class="n">isMainModule</span><span class="p">:</span>
  <span class="n">main</span><span class="p">()</span>
</pre></div>


<p>This needs to be compiled with the <code>--threads:on</code> switch.</p>
<div class="highlight"><pre><span class="gp">$</span> ./attempt1 johz
<span class="go">j</span>
<span class="go">o</span>
<span class="go">h</span>
<span class="go">z</span>
<span class="gp">$</span> ./attempt1 <span class="s2">&quot;st montgomery the first&quot;</span>
<span class="go">s</span>

<span class="go">t</span>
<span class="go">m</span>
<span class="go">n</span>
<span class="go">o</span>
<span class="go">...</span>
</pre></div>


<p>Note that the second time our script mixed up some of the letters.  Clearly, printing things out to the console is not a good way of producing output - what would work a lot better is a way to get the result of a spawned procedure.  The other thing to note is that each letter needs to be printed one at a time anyway.  We executed all the print statements in parallel, only for the computer to only give each one access to the console one at a time, meaning most of our time there was entirely&nbsp;wasted.</p>
<p>Threads</p>
    </div>
  </article>

  <p class="paginator">
    Getting Parallel in&nbsp;Nim
  </p>

  <div id="disqus-comments-container"></div>
</section>


      <div id="theme-switcher">
        Change Theme <br />
      </div>
      <script>
        themeSwitcher.addSwitcher('theme-switcher');
        themeSwitcher.addCycleButtons();
      </script>

    <footer id="footer">
      <p>This blog is built using <a href="http://getpelican.com">Pelican</a>, <a href="http://python.org">Python</a>, and the Pillbox theme.</p>
      <p>
<a rel="license" href="http://creativecommons.org/publicdomain/zero/1.0/" class="no-hilite">
    <img src="http://i.creativecommons.org/p/zero/1.0/88x31.png" style="border-style: none;" alt="CC0" />
</a>
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/" class="no-hilite">
    <img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
</a><br />
Unless otherwise specified, content on this blog is available under the
<a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons
Attribution 4.0 International License</a>.  Likewise, unless otherwise
specified, code samples are in the
<a href="http://creativecommons.org/publicdomain/zero/1.0/">public domain</a>.
The blog's theme (pillbox) is available under the MIT license on
<a href="https://github.com/MrJohz/pillbox-theme">Github</a>.
</p>
    </footer>



  </body>

</html>