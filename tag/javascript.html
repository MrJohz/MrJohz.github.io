<!DOCTYPE html>
<html lang="en">

  <head>
      <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />


  <script type="text/javascript">
  themes = [
    'dark',
    'light',
  ];
      themeDefault = "dark";
  </script>

  <script type="text/javascript">
    window.themeSwitcher=new function(e,t){"use strict";var n=function(e,t,n){if(Array.prototype.indexOf){return Array.prototype.indexOf.apply(e,Array.prototype.slice.call(arguments,1))}var r,i=n?n:0,s;s=e.length;if(s===0||i>=s){return-1}if(i<0){i=s-Math.abs(i)}for(r=i;r<s;r++){if(e[r]==t){return r}}return-1};var r="pillbox-theme-tester-value";var i="pillbox-theme";var s=this;s.lsExists=false;s.themes=e;s.defaultTheme=n(e,t);s.currentTheme=s.defaultTheme;try{localStorage.setItem(r,r);if(localStorage.getItem(r)===r){localStorage.removeItem(r);s.lsExists=true}}catch(o){}var u=function(e){if(e>=0&&e<s.themes.length){return{s:s.themes[e],i:e}}else{return{s:s.themes[s.currentTheme],i:s.currentTheme}}};var a;if(s.lsExists){var f=localStorage.getItem(i);s.currentTheme=n(e,f);if(s.currentTheme<0){s.currentTheme=s.defaultTheme}a=function(e){var t=u(e);var n=document.getElementById("main-theme");var r=n.href.split("/");r[r.length-1]=t.s+".min.css";n.href=r.join("/");localStorage.setItem(i,t.s);s.currentTheme=t.i}}else{a=function(e){var t=u(e);var n=document.getElementById("main-theme");var r=n.href.split("/");r[r.length-1]=t.s+".min.css";n.href=r.join("/");s.currentTheme=t.i}}s.writeStyle=function(){var e=s.themes[s.currentTheme];document.write('<link id="main-theme" href="https://mrjohz.github.io/theme/css/');document.write(e+'.min.css" rel="stylesheet" />')};s.getStyle=function(e){if(e==null||typeof e==="undefined"){return s.currentTheme}else if(typeof e==="number"&&e===Math.floor(e)){return u(t).s}else{var t=n(s.themes,e);if(t>-1){return t}else{return s.currentTheme}}};s.setStyle=function(e){var t=s.getStyle(e);if(t==s.currentTheme){return}a(t)};s.cycleStyle=function(){console.log(s.currentTheme);a((s.currentTheme+1)%s.themes.length)};s.addSwitcher=function(e){var t=document.getElementById(e);var n=document.createElement("select");n.id="theme-switcher-select";for(var r=0;r<s.themes.length;r++){var i=s.themes[r];var o=document.createElement("option");o.value=i;o.appendChild(document.createTextNode(i));if(r==s.currentTheme){o.selected=true}n.appendChild(o)}n.onchange=function(){var e=this.options[this.selectedIndex].value;themeSwitcher.setStyle(e)};t.appendChild(n)};s.addCycleButtons=function(){var e=document.querySelectorAll("a[href='#cycle-themes']");for(var t=0;t<e.length;t++){var n=e[t];n.addEventListener("click",function(e){e.preventDefault();s.cycleStyle()})}}}(themes,themeDefault)

    themeSwitcher.writeStyle();
  </script>
  <noscript>
    <link id="main-theme" href="https://mrjohz.github.io/theme/css/dark.min.css" rel="stylesheet" />
  </noscript>

      <title>  Johz - javascript
</title>

  <link href="https://mrjohz.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Johz Full Atom Feed" />

  </head>

  <body>
    <header id="header">
      <h1 id="header-title"><a class="no-hilite" href="https://mrjohz.github.io/">
        <div id="sitename">Johz</div>
      </a></h1>
    </header>

      <nav id="menu"><ul>


          <li><a href="#cycle-themes">Change Theme</a></li>

            <li  ><a href="https://mrjohz.github.io/pages/about-me.html">About&nbsp;Me</a></li>



      </ul></nav>


<!-- Random quote on index page -->
  <script>
    quotes = [
        "The blog that's always right, for an entirely arbitrary value of 'right'.",
        "Disclaimer: I have no idea what I'm doing']&lt;&amp;#47;div&gt;); DROP TABLE *;",
        "Currently working towards being 100% <a href='http://xkcd.com/1271'>XKCD/1271</a> compliant.",
        "More than just a blog, it's a way of life.",
        "- zen -",
        "This div container is left deliberately blank.",
        "<a href='https://github.com/MrJohz'>Fork me on GitHub!</a>  Fix an issue with Johz today!",
        "Proud Fenda Scum",
        "Try this site in a <a href='#theme-switcher'>different theme</a>.",
        "Built with the three 'P's, <a href='http://getpelican.com/'>Pelican</a>, <a href='http://python.org/'>Python</a>, and <a href='https://github.com/MrJohz/pillbox-theme'>Pillbox</a>.",
    ]

    index = Math.floor(Math.random() * quotes.length);
    document.writeln("<div id='quote'>")
    document.writeln("    " + quotes[index])
    document.writeln("</div>")
  </script>

<section id="content">
  <h2 id="content-title">Articles with the javascript tag</h2>
    <article class="blog-article">

      <header class="article-header">
        <h2 class="entry-title">
          <a href="https://mrjohz.github.io/posts/2014/Dec/19/the-definitive-guide-to-copying-and-pasting-in-javascript/" class="no-hilite" rel="bookmark" title="Permalink to The Definitive Guide to Copying and Pasting in JavaScript (the other kind…)">
            The Definitive Guide to Copying and Pasting in JavaScript (the other&nbsp;kind&#8230;)
          </a>
        </h2>
      </header>
      <footer class="article-footer">
        Published <abbr class="published" title="2014-12-19T20:54:32+00:00"> Fri 19 December 2014 </abbr>
          by <a href="https://mrjohz.github.io/author/johz.html">Johz</a>
      </footer>

      <div class="article-text">
        <h2>Step 1:&nbsp;Don&#8217;t.</h2>
<p>Stop.  You don&#8217;t want flashing lights.  You don&#8217;t want snowflake all over your page.  You don&#8217;t want a trail of happy faces that will follow your cursor all around your page.  We left these things in decades past for a reason, dammit!  Keep them there, for all our sakes.  No copy and paste!  Ever!  No, no, no, no,&nbsp;no!</p>
<p><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/></p>
<p>Well, yes, sometimes there is a reason to copy and paste text from the internet, particularly if you&#8217;re learning.  Sometimes you&#8217;re looking for a bit of advice on the perfect way to memoize some functions, or a quick and easy method to merge two objects, or even just a couple of basic string functions that you really wish had appeared in earlier EMCAScript specs.  In these cases, finding a quick &#8220;cookbook recipe&#8221; on the internet can be a great convenience.  Often, it&#8217;s a really good way for newer developers to expand their understanding of some of the language shortcuts.  The question then is &#8220;how should I best learn from this recipe?&#8221;  For you, then, comes step&nbsp;two.</p>
<h2>Step 2: Do it&nbsp;well.</h2>
<h3>Never copy-and-paste, always&nbsp;rewrite.</h3>
<p>I remember a book I once got given called <em>&#8220;Hello, World!&#8221;</em>, written by Sande <span class="amp">&amp;</span> Sande (a father and son duo).  It was a Python programming introduction for &#8220;Kids and other beginners&#8221;.  Fairly near the start, they gave a listing for a program that was certainly larger than anything that I&#8217;d seen up until that point that would let you play the classic skiing game where you have to ski down the mountain without hitting into things.  Of course, this being the technical age, they also provided a download for all the programs featured in the book, but this one came with a special&nbsp;note.</p>
<blockquote>
<p>The code for listing 10.1 is in the <code>\examples\skier</code> folder, so if you get stuck or just don&#8217;t want to type it all in, you can use that file.  But believe it or not, you&#8217;ll learn more by typing it in than by just opening and looking at the&nbsp;listing.</p>
</blockquote>
<p>So of course I typed the whole file in, and it came up with an error, because I wasn&#8217;t very good at coding, and didn&#8217;t understand what most of it actually did or meant<sup id="fnref:pythonfailure"><a class="footnote-ref" href="#fn:pythonfailure" rel="footnote">1</a></sup>.  However, I did start to piece together what the thing was actually meant to do.  I could read the names and the comments in the sidebar, and together I could get a feel for what sort of magic a line like <code>pygame.image.load(image_file)</code> might actually do.  (For the unitiated: it loads an image from an image file.  It&#8217;s part of the pygame system.  This is not hard stuff, but when you&#8217;re beginning it feels&nbsp;amazing&#8230;)</p>
<p>What <em>&#8220;Hello, World!&#8221;</em> had taught me in that small example was how to read code.  The way you read code is to go through each line individually.  This is probably not surprising for most well-practised developers, but in my various experiences of learning programming, reading code (and the sister-skill of thinking like a computer whilst doing so) are extremely&nbsp;under-taught.</p>
<p>This is the same when you are trying to use that useful function from the internet.  You <em>could</em> just copy and paste it.  That will work, and get you developing quickly, and you can go home, have a delicious dinner, watch some superb television, have the most beautiful dream, and then wake up next morning with everything going wrong because you didn&#8217;t quite understand that function you used, and it turns out it&#8217;s caught on an edge case that - as the case may be - is actually quite common in your&nbsp;circumstances.</p>
<p>Of course, that&#8217;s probably a rare example.  A lot of the functions that you paste are probably quite good, and will work quite well.  After all, StackOverflow is known for never ever being wrong ever.  However, it should always be on your mind that if you don&#8217;t understand the code you&#8217;re writing, it will always run the risk of jumping back at you and biting you.  When you write the function out, line-by-line, you&#8217;ll quickly start to understand what cases this will deal with, and what cases this won&#8217;t cope with.  You&#8217;ll be able to see what guards exist, what format the function will return, and whatever other features the original creator put in but didn&#8217;t&nbsp;document.</p>
<h3>Always change at least one&nbsp;thing.</h3>
<p>For me, this idea followed on quite easily from the previous piece of advice.  When you write out a piece of code, I find it relatively easy to just find little things that I want to change.  With JavaScript it&#8217;s usually something as simple as turning snippets that extend an object&#8217;s prototype into normal functions, as per <a href="http://www.nczonline.net/blog/2010/03/02/maintainable-javascript-dont-modify-objects-you-down-own/">best practice</a>.  With other languages, it might be something more complex, such as generalising a function designed for one case into a function designed for many cases.  You might dislike the specific formatting style that the example uses - change it.  Think you can use better variable names?  Use them.  Hell, if you&#8217;re just copying in an algorithm that you&#8217;re not entirely sure you grasp, try covering it in comments until you can see exactly what each line is there for.  (Admittedly, overuse of this particular example is probably a particularly bad idea, so if you find yourself doing this a lot, try finding less complex algorithms to do the same thing.  Alternatively, this might be the time you start looking for a well-maintained third-party library where someone else is doing all the&nbsp;legwork.)</p>
<p>Take for example, this beautiful JavaScript function that returns a repeated&nbsp;string:</p>
<div class="highlight"><pre><span class="c1">// This version will actually work thanks to</span>
<span class="c1">// http://www.reddit.com/r/javascript/comments/2pwz7l/the_definitive_guide_to_copying_and_pasting_in/cn0z7lm</span>
<span class="c1">// Modified from http://stackoverflow.com/questions/1235179/simple-way-to-repeat-a-string-in-java</span>
<span class="kd">function</span> <span class="p">(</span><span class="nx">times</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">times</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">times</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="k">this</span> <span class="o">+</span> <span class="k">this</span><span class="p">).</span><span class="nx">repeat</span><span class="p">(</span><span class="nx">times</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">return</span> <span class="k">this</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span> <span class="o">+</span> <span class="k">this</span><span class="p">).</span><span class="nx">repeat</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">times</span> <span class="o">/</span> <span class="mi">2</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>


<p>Some things I can easily do.  For example, this is using prototypes, and it isn&#8217;t even using them well.  It&#8217;s also using the fact that <code>if</code> can take a statement rather than a brace of statements.  Personally, I don&#8217;t like that, except for rare cases, and I&#8217;m not of the opinion that this is a rare enough case.  If I want to make it a stand-alone function, I&#8217;ll also need to change the name to make it clear that this is repeating a string.  Let&#8217;s see what it looks like&nbsp;now:</p>
<div class="highlight"><pre><span class="kd">function</span> <span class="nx">repeatStr</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">times</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">times</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">times</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">repeatStr</span><span class="p">(</span><span class="nx">str</span> <span class="o">+</span> <span class="nx">str</span><span class="p">,</span> <span class="nx">times</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span> <span class="o">+</span> <span class="nx">repeatStr</span><span class="p">(</span><span class="k">this</span> <span class="o">+</span> <span class="k">this</span><span class="p">,</span> <span class="nx">times</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>To me, that looks a bit better.  But I&#8217;m still not sure what this function actually does.  I know it repeats strings, but what sort of magic is there under the hood?<sup id="fnref:obtuse"><a class="footnote-ref" href="#fn:obtuse" rel="footnote">2</a></sup>  This is the best time to start adding comments in.  Let&#8217;s smother that function.  We&#8217;ll also re-add the most important part of any copy-and-paste code: the attribution.  This is partly because your source clearly deserves the recognition, but mainly because - as with the rest of your code - you&#8217;ll probably come back later and wonder why you were so stupid as to write that.  At least when you can attribute parts of your code to others, it&#8217;s not your fault.  (We&#8217;ll discuss attribution slightly more properly a bit later&nbsp;on.)</p>
<div class="highlight"><pre><span class="c1">// Modified from http://stackoverflow.com/questions/1235179/simple-way-to-repeat-a-string-in-java</span>
<span class="kd">function</span> <span class="nx">repeatStr</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">times</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">times</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// if no times needed</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>     <span class="c1">// return empty string</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">times</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>                 <span class="c1">// if times is even</span>
        <span class="k">return</span> <span class="nx">repeatStr</span><span class="p">(</span><span class="nx">str</span> <span class="o">+</span> <span class="nx">str</span><span class="p">,</span> <span class="nx">times</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>  <span class="c1">// divide time by two, double str</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>                                                          <span class="c1">// if times is odd</span>
        <span class="k">return</span> <span class="k">this</span> <span class="o">+</span> <span class="nx">repeatStr</span><span class="p">(</span><span class="k">this</span> <span class="o">+</span> <span class="k">this</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">times</span> <span class="o">/</span> <span class="mi">2</span><span class="p">));</span>  <span class="c1">// divide time by two, double str, add str for remainder</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Do you begin to understand how it works a bit&nbsp;now?</p>
<h3>Always find an&nbsp;alternative.</h3>
<p>StackOverflow is a beautiful thing.  However, it is also a relatively fractured thing, and the sum of knowledge within it is built from many different parts, with opinions that can often appear to contradict each other.  This is the wonder of any system where opinions are crowd-sourced, and is why you should never trust the word of random blogs posted on link aggregation sites that claim to have all the answers.  There are always&nbsp;alternatives.</p>
<p>This is a good thing, because it means you&#8217;ve got to think for a bit.  Say you find a function on the internet that claims to repeat a string.  Say you find two, or three, or many functions.  At some point you&#8217;re going to need to decide between them.  And at that point you&#8217;re going to need to understand how they work, and more specifically, why they may or may not be appropriate to&nbsp;you.</p>
<p>The best example here is probably a for loop, not because it&#8217;s something that people regularly need to copy into their code, but because it&#8217;s something that&#8217;s so ubiquitous when it comes to optimization.  The standard mantra is that reverse for loops are the fastest loops, because back when programming required intimate knowledge of how a computer would spend each clock cycle, it was possible to implement a number of tricks in the computer hardware that could decrease the number of instructions used in each loop.  When you&#8217;re writing code that requires every last drop of performance from the <span class="caps">CPU</span>, and touching the bones of the computer to do so, each extra clock cycle can be a beautiful and valuable&nbsp;gift.</p>
<p>Of course, none of this applies to JavaScript.  Despite this, there are a plethora of ways of looping available to budding web developers, each claiming to be the best, the fastest, the most optimised, and each providing their own set of benchmarks to back this up.  The question then becomes how to choose between them - which in turn becomes a question of what you&#8217;re actually looking for in your for&nbsp;loops.</p>
<p>Of course, this will depend on what you need your for loop for.  Most of the time it will be fairly simple.  Perhaps you don&#8217;t need absolute blazing speed, but you do need the code to look clear and concise.  In that case, your solution might be a <code>for x in xs</code> loop, or perhaps <code>xs.forEach</code>.  Or perhaps you need backwards compatibility across all browsers currently in use, and all browsers not in use that your boss still demands compatibility for.  In that case, the humble <code>for (...) { }</code> loop is probably your best bet, and may god have mercy on your soul.  Maybe you&#8217;re developing an application that demands absolute blazing speed of a kind never before seen in an interpreted scripting language.  In that case, I have no idea what the perfect solution is, but it&#8217;s probably the sort of thing you&#8217;ll find out after a long time spent with a huge number of benchmarking&nbsp;suites.</p>
<p>This in turn has parallels for finding recipes on the internet.  You want to use the best tool for the job, and to do that you need to understand what jobs any snippets you find are.  In my experience the best way to do that is to find alternatives, and to compare and contrast.  You won&#8217;t be able to tell why snippet <em>a</em> is so good unless you know about its direct competitor <em>b</em>.  This way you&#8217;ll be able to expand your knowledge, and understand more easily what the text you&#8217;re copying into your code will actually&nbsp;do.</p>
<h2>Step 3:&nbsp;&#8230;Profit?</h2>
<p>Of course, all this advice is given with the aim of learning how to be a better programmer.  Over time, if you are repeatedly copying the same pieces of code into your project, that there&#8217;s probably a greater issue somewhere.  In some languages it might well be that you&#8217;re using the wrong idioms (creating a map where an enum-type would be more helpful, or complex case statements where a map would be more useful).  In other languages where the problem is more the lack of a standard library, the solution might be to find a third-party library that you can use consistently.  With JavaScript, the latter case is often true, and it may well be that learning how to effectively use tools such as <a href="https://lodash.com/">lodash</a> and <a href="http://underscorejs.org/">underscore</a> will help you a lot.  However, for those who are taking early steps in a language, I&#8217;d argue that copying and pasting is not wrong - as long as you do it&nbsp;properly.</p>
<h2>Step 4 and Step 0:&nbsp;Attributions!</h2>
<p><a href="http://www.reddit.com/user/jimschubert">/u/jimschubert</a> reminded me in the discussion on this post on Reddit that one important thing to do that I didn&#8217;t properly emphasise is to attribute your stuff properly (and even determine if you&#8217;re allowed to use it).  I did briefly mention when I talked about changing the code that it&#8217;s always good to put a comment saying where you got the code from, but proper attribution is an interesting legal issue.  For many things (particularly in web-development and Java applications), you&#8217;ll probably find your snippets from Stack Overflow.  Stack Overflow puts everything it hosts under the Creative Commons <a href="http://creativecommons.org/licenses/by-sa/3.0/"><span class="caps">CC</span> <span class="caps">BY</span>-<span class="caps">SA</span> 3.0</a> license.  Generally, this allows you to do with the content what you like, as long as you give &#8220;appropriate credit&#8221; (indicating if you changed it), and distribute any modifications under the same (or a compatible)&nbsp;license.</p>
<p>The other big source of snippets is blog posts and technical articles.  If the article is an &#8220;official source&#8221; (for example examples on the Mozilla <span class="caps">JS</span> docs), or a large enough software organisation they will probably have a note at the bottom of the page that gives you the official state of licensing for any information on that site.  (In the case of the <span class="caps">MDN</span> pages, code samples are either under the <span class="caps">MIT</span> license, or in public domain, while the rest of the text is under the <span class="caps">CC</span> <span class="caps">BY</span>-<span class="caps">SA</span> 2.5 license.)  For smaller blogs that haven&#8217;t thought about this issue, the issues are slightly more complex.  There are generally two schools of thought, one stating that if there&#8217;s no license, it&#8217;s in the public domain, and the other stating that in the absence of a license, it should be assumed that all rights are reserved.  It&#8217;s probably a good rule of thumb that someone releasing unlicensed code into the world does consider it public domain (this has always been my assumption, although having researched this little section, I realise it would probably be wise for me to think about licensing code snippets on my blog more carefully).  However, if you&#8217;re writing code on behalf of a company with concerns about being sued, the general feeling is usually that unlicensed code isn&#8217;t really worth&nbsp;it.</p>
<p>This, then would be my advice, partly built on trying to abide by the complicated legal issues, and partly built on just trying to be as nice as possible to the original&nbsp;authors:</p>
<ul>
<li>Always provide attributions and the source.  I don&#8217;t know of any license that forbids them, and it&#8217;s polite to do so.  Plus, as I said earlier, you can always blame other&nbsp;people.</li>
<li>Always say if you&#8217;ve modified the original.  (Of course, if you were following Step 2 properly, you&#8217;ll always be modifying it&nbsp;anyway!)</li>
<li>If you can see a license, obey any further stipulations in that license.  Note that some &#8220;viral&#8221; licenses may affect how you license your own work.  If you can&#8217;t abide by those licenses, you should not use the&nbsp;code.</li>
</ul>
<p>Again, I am not in any way, shape, or form a lawyer.  This is not legal advice.  But it&#8217;s my opinion, and probably some decent practical advice that might work for&nbsp;you.</p>
<h2>Side note about the&nbsp;title:</h2>
<p>It&#8217;s based on <a href="https://www.lucidchart.com/techblog/2014/12/02/definitive-guide-copying-pasting-javascript/">this</a> article submitted to the <a href="http://www.reddit.com/r/javascript"><code>/r/javascript</code></a> sub on Reddit.  That article is a very interesting one about how to use the clipboard from a JavaScript application in a cross-browser way, and is very interesting, but it did confuse me for a while as I did manage to get the wrong impression from the title.  For those people like me, who are easily confused by these simple matters, I submit this blog post, which might not&nbsp;help.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:pythonfailure">
<p>If I remember correctly, I got really irritated at that point, angrily turned the computer off, stormed off to my room, and didn&#8217;t come down for the rest of the day.  My poor father who&#8217;d been trying to please my yearning to become a programmer must&#8217;ve been really quite worried - thankfully that didn&#8217;t deter me significantly, and while I never got that code to work, I did continue learning Python.&#160;<a class="footnote-backref" href="#fnref:pythonfailure" rev="footnote" title="Jump back to footnote 1 in the text">[back]</a></p>
</li>
<li id="fn:obtuse">
<p>You might think this is me being obtuse.  This is a real snippet that I copied recently in Java.  I could see why it would be efficient (it doubles the length each time, rather than adding each string individually), but it took a while to connect in my head how exactly it worked, particular for cases that weren&#8217;t multiples of two.  By putting comments everywhere, I started to understand very clearly what each line was doing.&#160;<a class="footnote-backref" href="#fnref:obtuse" rev="footnote" title="Jump back to footnote 2 in the text">[back]</a></p>
</li>
</ol>
</div>
      </div>

        <hr class="article-divider">

    </article>
    <article class="blog-article">

      <header class="article-header">
        <h2 class="entry-title">
          <a href="https://mrjohz.github.io/posts/2013/Nov/11/building-a-pure-javascript-theme-switcher/" class="no-hilite" rel="bookmark" title="Permalink to Building a Pure-Javascript Theme Switcher">
            Building a Pure-Javascript Theme&nbsp;Switcher
          </a>
        </h2>
      </header>
      <footer class="article-footer">
        Published <abbr class="published" title="2013-11-11T18:16:29+00:00"> Mon 11 November 2013 </abbr>
          by <a href="https://mrjohz.github.io/author/johz.html">Johz</a>
      </footer>

      <div class="article-text">
        <p>You might have noticed that you can change the theme of my blog.  I&#8217;m quite sure I&#8217;ve told you before that you can do this, but I&#8217;m going to tell you again, because I&#8217;m really proud of working out how to add this functionality, especially making it either work or fail gracefully on pretty much all browsers, and making it persist across sessions.  The exciting part for me is that this is entirely client-side, so it works on a static blog or website, which mine is.  I recognise that it&#8217;s simple, easy, and my pride is entirely unwarranted, but dammit it makes me feel&nbsp;good.</p>
<p>I&#8217;ve spent today rewriting the code that does this to make it prettier, and more reusable.  For example, if you click on <a href="javascript:void(0)" onclick="themeSwitcher.setStyle(-1);">this link</a>, the entire theme will change to a different one.  It&#8217;s also much easier to add new themes now, as there&#8217;s only one place that they&#8217;re&nbsp;specified.</p>
<p>So how does this all work?  Well, assuming you&#8217;ve already got a document and a couple of stylesheets that you want to switch between, we&#8217;ll start by defining a themeSwitcher&nbsp;object.</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">themes</span> <span class="o">=</span> <span class="nx">themes</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span><span class="p">;</span>
<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">)</span>
</pre></div>


<p>Here, we&#8217;re simply creating a single object with an anonymous constructor function.  The constructor takes two arguments, the list of themes, and the default theme.  We store the list of themes directly, but instead of storing the defaultTheme as is (in a string format) we store it internally as an index.  We also need to set the currentTheme, which of course is the default theme by&nbsp;default.</p>
<p>Next we need to find out if there are any stylesheets already saved.  For this we need some sort of peristent storage.  I used localStorage, but there are other storage alternatives out there.  The other big contender that you might think about using is cookie storage.  There are three big differences between the two of these, for our uses at&nbsp;least.</p>
<p>Firstly, cookies are a pain to handle, whereas working with localStorage is a dream.  For me, this was the biggest reason for turning to localStorage.  Secondly, localStorage isn&#8217;t entirely cross-browser.  While localStorage is available for about <a href="http://caniuse.com/#feat=namevalue-storage" title="Can I Use: name-value Storage">90%</a> of your users, if you think you&#8217;re going to get a lot of traffic from older browsers that might be a consideration for you.  Thirdly, cookies are sent to the server.  This particular theme switcher is entirely client-side, so that&#8217;s not necessary, but if you wanted to add some sort of server-side code that deals with the theme, you might want to think about using&nbsp;cookies.</p>
<p>However, for me localStorage seemed to be the best answer.  Of course, if we&#8217;re using localStorage, we&#8217;re going to need to ensure that localStorage exists.  If you&#8217;ve already got <a href="http://modernizr.com/" title="Modernizr - Feature detection">Modernizr</a> installed, you should use that.  However, I didn&#8217;t, and I didn&#8217;t want to include a whole new library just to find out if I could use one feature, so I <a href="https://github.com/Modernizr/Modernizr/blob/master/feature-detects/storage/localstorage.js" title="The localStorage test in Modernizr's source">used the source</a>, and borrowed the test that Modernizr used.  This is what it looks&nbsp;like:</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// Assume that localStorage doesn&#39;t</span>
                         <span class="c1">// work until proven otherwise</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">themes</span> <span class="o">=</span> <span class="nx">themes</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Do a test</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">);</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Test failed</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">)</span>
</pre></div>


<p>Beautiful.</p>
<p>Now if localStorage exists, that still doesn&#8217;t mean that there&#8217;s anything saved there.  The stuff that&#8217;s saved there could also be complete gobbledygook.  If you can, have a look at what localStorage saves on this site.  (On Chrome, press Ctrl-Shift-i, go to &#8220;Resources&#8221;, and &#8220;Local Storage&#8221;.)  Edit it to something that isn&#8217;t &#8220;dark&#8221; or &#8220;lite&#8221;, reload the page, and you&#8217;ll see that the site automatically uses the &#8220;dark&#8221; theme.  That&#8217;s because the alternative would be to load no stylesheet at all, and I really don&#8217;t want that to&nbsp;happen.</p>
<p>To check if the value saved is an acceptable value, the easiest thing we can do is find out if it&#8217;s in the array of themes that was passed into the constructor.  The best way to do this is <code>Array.prototype.indexOf</code>, which works on most browsers, but not all.  Unfortunately, there are browsers that implement localStorage and not indexOf, so we need to write our own indexOf function for those cases.  I based mine on the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf#Compatibility" title="Array.prototype - Mozilla docs">Mozilla sample implementation</a>, minified it because it was useless and ugly, and added it to the top of the script.  Note that this implementation doesn&#8217;t modify the Array&nbsp;prototype.</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">indexOf</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">n</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">){</span>
    <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
    <span class="nx">arguments</span><span class="p">,</span><span class="mi">1</span><span class="p">))}</span><span class="kd">var</span> <span class="nx">r</span><span class="p">,</span><span class="nx">i</span><span class="o">=</span><span class="nx">n</span><span class="o">?</span><span class="nx">n</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">s</span><span class="p">;</span><span class="nx">s</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">s</span><span class="o">===</span><span class="mi">0</span><span class="o">||</span><span class="nx">i</span><span class="o">&gt;=</span><span class="nx">s</span><span class="p">){</span><span class="k">return</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">){</span><span class="nx">i</span><span class="o">=</span><span class="nx">s</span><span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">i</span><span class="p">)}</span><span class="k">for</span><span class="p">(</span><span class="nx">r</span><span class="o">=</span><span class="nx">i</span><span class="p">;</span><span class="nx">r</span><span class="o">&lt;</span><span class="nx">s</span><span class="p">;</span><span class="nx">r</span><span class="o">++</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">==</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="nx">r</span><span class="p">}}</span>
    <span class="k">return</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">themes</span> <span class="o">=</span> <span class="nx">themes</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">);</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="c1">// Get the theme stylesheet, and check that it exists</span>
    <span class="nx">stylesheet</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;theme-stylesheet&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">stylesheet</span><span class="p">);</span> <span class="c1">// Note shim!</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">)</span>
</pre></div>


<p>So now themeSwitcher is an object that contains a list of all possible themes, the current theme, the default theme, and a flag that tells us if localStorage exists or not.  That&#8217;s all very useful, but none of it actually changes the theme.  Indeed, we haven&#8217;t even installed a theme on the page.  This theme switching system still requires a bit of&nbsp;work.</p>
<p>Firstly, let&#8217;s add a function that writes the current theme to the document.  There are multiple ways of doing this, and some are more idiomatic and beautiful than others, but since all we&#8217;re actually doing is writing a single line of <span class="caps">HTML</span>, I&#8217;ve opted for <code>document.write</code>.  Sure, you should probably build an element, and append it somewhere to the <span class="caps">DOM</span>, but I&#8217;m lazy, and that feels like way too many lines of&nbsp;code.</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*</span>
<span class="cm">  indexOf function</span>
<span class="cm">    ...</span>
<span class="cm">  constructor statements &amp; test for localStorage</span>
<span class="cm">  */</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">writeStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// remember that currentTheme is an index, not a theme name</span>
    <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">];</span>
    <span class="c1">// Modify the html here as you please.</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;link id=&quot;main-theme&quot; href=&quot;/static/css/&#39;</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">styleName</span> <span class="o">+</span> <span class="s1">&#39;.css&quot; rel=&quot;stylesheet&quot; /&gt;&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">)</span>
</pre></div>


<p>I&#8217;m creating a function to do this, because that&#8217;s the way that feels most idiomatic to me.  (This is probably ironic, considering the previous paragraph.)  You could just do the <code>document.write</code> as a statement within the constructor, but this means that later you&#8217;ll have less control over when and where you place the&nbsp;link.</p>
<p>The other thing that we need is a way to change the themes once the document is loaded.  After all, expecting the user to reload the page every time they change the theme is a bit much to ask, don&#8217;t you think?  The way I chose to do this was by writing two private <code>_setStyle</code> function, and then defining one of them based on whether localStorage existed.  You could use an if-statement, and test on the <code>lsExists</code> attribute, but why bother when the try/catch statement already divides flow into two sections for you to&nbsp;use?</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*</span>
<span class="cm">  indexOf function</span>
<span class="cm">    ...</span>
<span class="cm">  constructor statements</span>
<span class="cm">  */</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="cm">/* get theme stylesheet */</span>

    <span class="c1">// _setStyle if localStorage exists</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// check that the theme really does exist</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">];</span>
        <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// Get the URL of the link, and change it to the URL</span>
      <span class="c1">// of the new link.  This assumes that all the css</span>
      <span class="c1">// sheets are sitting in the same directory.  It also</span>
      <span class="c1">// assumes that only one css sheet is needed to define</span>
      <span class="c1">// a theme.  You can modify this if that isn&#39;t the case.</span>
      <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;main-theme&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">splits</span> <span class="o">=</span> <span class="nx">link</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
      <span class="nx">splits</span><span class="p">[</span><span class="nx">splits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">styleName</span> <span class="o">+</span> <span class="s1">&#39;.css&#39;</span><span class="p">;</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">splits</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

      <span class="c1">// Make sure we save the new theme name so that</span>
      <span class="c1">// the choice persists across sessions.</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;pillbox-theme&#39;</span><span class="p">,</span> <span class="nx">styleName</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="c1">// _setStyle if localStorage does not exists</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// the style will always be the current theme,</span>
      <span class="c1">// which will always be the default theme.</span>
      <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">];</span>

      <span class="c1">// Still write the new theme into the document,</span>
      <span class="c1">// just in case something has gone horribly wrong.</span>
      <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;main-theme&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">splits</span> <span class="o">=</span> <span class="nx">link</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
      <span class="nx">splits</span><span class="p">[</span><span class="nx">splits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">styleName</span> <span class="o">+</span> <span class="s1">&#39;.css&#39;</span><span class="p">;</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">splits</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>


  <span class="cm">/* writeStyle function */</span>
<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">)</span>
</pre></div>


<p>You can now start playing with things in your browser.  Assuming you&#8217;ve got all your stylesheets in the right place, and a basic <span class="caps">HTML</span> layout, insert this code at the top of the <code>&lt;head&gt;</code> brackets.  Then open up a development console and start calling <code>themeSwitcher._setStyle</code> with various values.  Notice that you can only use indices to specify which theme you want.  Let&#8217;s change that.  When we make our public setStyle function, we want to also be able to specify the string name of the css file.  I also want there to be a way to call it without specifying the theme, and let it toggle between&nbsp;themes.</p>
<p>To do this, we&#8217;re going to need an algorithm that can take a string, integer, or null input, and return the index of the theme that best matches the description.  Now that sounds like a fairly useful algorithm to use, so in the interests of <span class="caps">DRY</span>, let&#8217;s implement it as a new function, <code>themeSwitcher.getStyle</code>, then add <code>themeSwitcher.setStyle</code> on top of&nbsp;it.</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*</span>
<span class="cm">  indexOf function</span>
<span class="cm">    ...</span>
<span class="cm">  constructor statements</span>
<span class="cm">  */</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="cm">/* localStorage exists _setStyle implementation */</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* localStorage doesn&#39;t exist _setStyle implementation */</span>
  <span class="p">}</span>

  <span class="cm">/* writeStyle function */</span>

  <span class="c1">// public getStyle method</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Firstly, check if stylesheet is undefined or null.</span>
    <span class="c1">// In this case we&#39;ll return the current theme.</span>
    <span class="c1">// This allows us to use themeSwitcher.themes[themeSwitcher.getStyle()]</span>
    <span class="c1">// to find out the current theme.</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">stylesheet</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="nx">stylesheet</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Next, stylesheet could be an index.  Return either the index,</span>
    <span class="c1">// or if index is invalid, the current theme.</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">stylesheet</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span>
               <span class="o">&amp;&amp;</span>   <span class="nx">stylesheet</span> <span class="o">===</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">stylesheet</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">stylesheet</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">stylesheet</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Otherwise, assume stylesheet is the name of a style.</span>
    <span class="c1">// If it isn&#39;t, then it won&#39;t be in the list of themes,</span>
    <span class="c1">// so just return the current theme.</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">stylesheet</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">index</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// public setStyle method</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// get the style index using getStyle</span>
    <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">);</span>

    <span class="c1">// if the stylesheet is the same as the current</span>
    <span class="c1">// stylesheet, toggle the stylesheet to the next one</span>
    <span class="c1">// in the list of themes.</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">index</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Use whichever private _setStyle function was defined</span>
    <span class="c1">// to set the style of the page.</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setStyle</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">)</span>
</pre></div>


<p>The main theme switching mechanism is now pretty much almost done.  Unfortunately, unless the user plays around with their development console, they&#8217;re not going to be able to change much.  This is where we need to add an element on the page that actually allows the user interface to work.  I&#8217;ve implemented this here in the form of a <code>select</code> drop-down choice form element, but of course you can edit and play with this code as much as you&nbsp;want.</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* initialisation, writeStyle, getStyle and setStyle definitions */</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">addSwitcher</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elementID</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Append our switcher to #elementID</span>
    <span class="nx">elem</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">elementID</span><span class="p">);</span>

    <span class="c1">// We&#39;re using a select element</span>
    <span class="nx">switcher</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
    <span class="nx">switcher</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s2">&quot;theme-switcher-select&quot;</span><span class="p">;</span>

    <span class="c1">// Iterate through the themes, and append them as options</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">theme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="nx">option</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">);</span>
      <span class="nx">option</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">theme</span>
      <span class="nx">option</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">theme</span><span class="p">))</span>

      <span class="c1">// The current theme should be selected</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">option</span><span class="p">.</span><span class="nx">selected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">switcher</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">option</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="c1">// When a new option is selected, call our setStyle function</span>
    <span class="nx">switcher</span><span class="p">.</span><span class="nx">onchange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">theme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="nx">theme</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Append to the document</span>
    <span class="nx">elem</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">switcher</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">)</span>
</pre></div>


<p>And voila, a complete client-side theme switching solution.  How do you use this?  Well, the above definition should go in your <code>&lt;head&gt;</code> section in a <code>&lt;script&gt;</code> tag.  Then, immediately afterwards, you should call <code>themeSwitcher.writeStyle()</code>.  Now the rest of your page can load, with the correct stylesheet enabled.  In the place where you want the theme-switching interface, create a container element with an id, then immediately below that, in script tags, call <code>themeSwitcher.addSwitcher(elementID)</code>, where elementID is of course the id of the container element.  Check out the source code of this page to see it in action.  I&#8217;ve minified the function definition, but it works exactly the&nbsp;same.</p>
<p>Here&#8217;s the complete&nbsp;listing.</p>
<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">themeSwitcher</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">indexOf</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">n</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">){</span><span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span><span class="mi">1</span><span class="p">))}</span><span class="kd">var</span> <span class="nx">r</span><span class="p">,</span><span class="nx">i</span><span class="o">=</span><span class="nx">n</span><span class="o">?</span><span class="nx">n</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">s</span><span class="p">;</span><span class="nx">s</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">s</span><span class="o">===</span><span class="mi">0</span><span class="o">||</span><span class="nx">i</span><span class="o">&gt;=</span><span class="nx">s</span><span class="p">){</span><span class="k">return</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">){</span><span class="nx">i</span><span class="o">=</span><span class="nx">s</span><span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">i</span><span class="p">)}</span><span class="k">for</span><span class="p">(</span><span class="nx">r</span><span class="o">=</span><span class="nx">i</span><span class="p">;</span><span class="nx">r</span><span class="o">&lt;</span><span class="nx">s</span><span class="p">;</span><span class="nx">r</span><span class="o">++</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">==</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="nx">r</span><span class="p">}}</span><span class="k">return</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">themes</span> <span class="o">=</span> <span class="nx">themes</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">defaultTheme</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">);</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="nx">stylesheet</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;theme-stylesheet&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">stylesheet</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultTheme</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_setStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">];</span>
        <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;main-theme&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">splits</span> <span class="o">=</span> <span class="nx">link</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
      <span class="nx">splits</span><span class="p">[</span><span class="nx">splits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">styleName</span> <span class="o">+</span> <span class="s1">&#39;.css&#39;</span><span class="p">;</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">splits</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;pillbox-theme&#39;</span><span class="p">,</span> <span class="nx">styleName</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lsExists</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_setStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;main-theme&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">splits</span> <span class="o">=</span> <span class="nx">link</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
      <span class="nx">splits</span><span class="p">[</span><span class="nx">splits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">styleName</span> <span class="o">+</span> <span class="s1">&#39;.css&#39;</span><span class="p">;</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">splits</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">writeStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">styleName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">];</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;link id=&quot;main-theme&quot; href=&quot;/static/css&#39;</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">styleName</span> <span class="o">+</span> <span class="s1">&#39;.css&quot; rel=&quot;stylesheet&quot; /&gt;&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">getStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">stylesheet</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">stylesheet</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">stylesheet</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span>
                 <span class="o">&amp;&amp;</span>   <span class="nx">stylesheet</span> <span class="o">===</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">stylesheet</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">stylesheet</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">stylesheet</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">,</span> <span class="nx">stylesheet</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">index</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">index</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setStyle</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">addSwitcher</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elementID</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">elem</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">elementID</span><span class="p">);</span>
    <span class="nx">switcher</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
    <span class="nx">switcher</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s2">&quot;theme-switcher-select&quot;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">theme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">themes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="nx">option</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">);</span>
      <span class="nx">option</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">theme</span>
      <span class="nx">option</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">theme</span><span class="p">))</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentTheme</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">option</span><span class="p">.</span><span class="nx">selected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">switcher</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">option</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">switcher</span><span class="p">.</span><span class="nx">onchange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
      <span class="nx">themeSwitcher</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">elem</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">switcher</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">})([</span><span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet2.css&#39;</span><span class="p">],</span> <span class="s1">&#39;stylesheet1.css&#39;</span><span class="p">);</span>
</pre></div>
      </div>


    </article>

    <p class="paginator">
            &laquo;
        Page 1 / 1
            &raquo;
    </p>
</section>


      <div id="theme-switcher">
        Change Theme <br />
      </div>
      <script>
        themeSwitcher.addSwitcher('theme-switcher');
        themeSwitcher.addCycleButtons();
      </script>

    <footer id="footer">
      <p>This blog is built using <a href="http://getpelican.com">Pelican</a>, <a href="http://python.org">Python</a>, and the Pillbox theme.</p>
      <p>
<a rel="license" href="http://creativecommons.org/publicdomain/zero/1.0/" class="no-hilite">
    <img src="http://i.creativecommons.org/p/zero/1.0/88x31.png" style="border-style: none;" alt="CC0" />
</a>
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/" class="no-hilite">
    <img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
</a><br />
Unless otherwise specified, content on this blog is available under the
<a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons
Attribution 4.0 International License</a>.  Likewise, unless otherwise
specified, code samples are in the
<a href="http://creativecommons.org/publicdomain/zero/1.0/">public domain</a>.
The blog's theme (pillbox) is available under the MIT license on
<a href="https://github.com/MrJohz/pillbox-theme">Github</a>.
</p>
    </footer>



  </body>

</html>